	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			
<p class=A3Topic>SHOPCART_UDF.A5W</p>



<p class=A5>Purpose</p>



<p>The SHOPCART_UDF.A5W page provides functions for the shopping cart.</p>



<p class=A5>Description</p>



<p>The SHOPCART_UDF.A5W contains user functions for the shopping cart.</p>



<ul style="list-style: disc;"
	type=disc>
	
	<li class=kadov-p-CBullet1><p class=Bullet1><a href="SHOPCART_UDF.A5W.html#shopcart_parm_confirm__" title="SHOPCART_UDF.A5W" class="wiki">Shopcart_Parm_Confirm(</a>) 
 checks if the proper parameters have been passed to a shop cart function.</p>

</li>
	
	<li class=kadov-p-CBullet1><p class=Bullet1><a href="SHOPCART_UDF.A5W.html#shopcart_chk__" title="SHOPCART_UDF.A5W" class="wiki">Shopcart_CHK(</a>) 
 checks if a shopping cart exists.</p>

</li>
	
	<li class=kadov-p-CBullet1><p class=Bullet1><a href="SHOPCART_UDF.A5W.html#shopcart_add__" title="SHOPCART_UDF.A5W" class="wiki">Shopcart_Add(</a>) 
 adds a selected item to the shopping cart.</p>

</li>
	
	<li class=kadov-p-CBullet1><p class=Bullet1><a href="SHOPCART_UDF.A5W.html#error_msg__" title="SHOPCART_UDF.A5W" class="wiki">Error_Msg(</a>) 
 displays an error message if one exists.</p>

</li>
</ul>

<p class=Note><span class=Note><img src="images/icon_warning.gif"
									x-maintain-ratio=TRUE
									style="border: none;
											width: 37px;
											height: 33px;
											float: none;
											border-style: none;
											border-style: none;"
									width=37
									height=33
									border=0>Note</span> : Do not open 
 this page in the <span class=Screen>WYSIWYG</span> tab of the <span class=Screen>HTML 
 Editor</span> and then save it. This will result in the loss of Xbasic 
 code, which the underlying <span class=Screen>Microsoft ActiveX</span> 
 control does not properly support.</p>



<p class=A5>Links</p>



<p>The <a href="../Orphans/CHECKOUTCART.A5W.html" title="CHECKOUTCART.A5W" class="wiki">CHECKOUTCART.A5W</a>, <a href="SHOPCART.A5W.html" title="SHOPCART.A5W" class="wiki">SHOPCART.A5W</a> 
 and <a href="SHOPCART_ADD.A5W.html" title="SHOPCART_ADD.A5W" class="wiki">SHOPCART_ADD.A5W</a> pages include 
 the SHOPCART_UDF.A5W page.</p>



<p class=A5><a name=shopcart_chk__>Shopcart_CHK()</a></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>FUNCTION shopcart_chk&nbsp;as&nbsp;p (parms&nbsp;as&nbsp;P 
 )</p>


<p class=Code>shopcart_chk.html = ""</p>


<p class=Code>on error goto error_chk</p>


<p class=Code>shopcart_chk = shopcart_parm_confirm(parms)</p>


<p class=Code>if shopcart_chk.html <> ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.RedirectURL 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function</p>


<p class=Code>end if</p>


<p class=Code>shopcart_chk.RedirectURL = ""</p>


<p class=Code>html_exit = <<%html%</p>


<p class=Code><table id="add_cart" border="0" cellspacing="0" 
 cellpadding="0" align="center"></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 height="5"></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 height="25" align="center" class="[style]ColumnTD"><strong>Shopping 
 Cart</strong></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 align="center" class="[style]DataTD"><br><span 
 class="[style]ErrorDataTD"><strong>[msg]</strong></span></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 height="5"></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code></table></p>


<p class=Code>%html%</p>


<p class=Code>with parms</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;'test 
 if parms passed</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if session.<strong>protected</strong>pUser.type = "I" ' internal user -	html to show shop cart option not available for internal users</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.html 
 = stritran(html_exit, "[style]", style_name)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.html 
 = stritran(shopcart_chk.html, "[msg]", "&nbsp;Internal 
 Users are not authorized for Shopping Carts<br><br>Please 
 log in with a Customer UserID&nbsp;")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;cart_old 
 = "" ' empty list</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;' 
 ignore any items already in current cart id</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;' 
 Test if any items exist for customer</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;
  if 
 session.<strong>protected</strong>pUser.ulink = ""  ' no one logged in, use current session id to 
 check for old cart</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cart_old 
 = table.external_record_content_get(DBF.table_name, "item_id","item_id", 
 "owner_id=\"\" .and. session_id = \"" + session.sessionid 
 + "\" .and. cart_id <> \"" + request.variables.cart_id 
 + "\"")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;
  elseif 
 session.<strong>protected</strong>pUser.ulink <> "" .and. session.<strong>protected</strong>pUser.type <>  "I"' valid 
 user id found, ok see if records exist for current&nbsp;customer 
 - not current cart_id</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cart_old 
 = table.external_record_content_get(DBF.table_name, "item_id", 
 "item_id", "owner_id=\"" + session.<strong>protected</strong>pUser.ulink + "\" 
 .and. cart_id <> \"" + request.variables.cart_id + "\"")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;' 
 no old items, do nothing unless 'emptycart_message' is .T. Then test for 
 empty cart</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if 
 line_count(cart_old) = 0</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 emptycart_message = .T. ' test for empty cart</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cart_new 
 = table.external_record_content_get(DBF.table_name, "item_id", 
 "item_id", "cart_id = \"" + request.variables.cart_id 
 + "\" .and. Quantity > 0")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 cart_new = "" 'no current cart records</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.html 
 = stritran(html_exit, "[style]", style_name)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.html 
 = stritran(shopcart_chk.html,"[msg]","&nbsp;There are 
 No Items in Your Shopping Cart&nbsp;")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function ' ' No HTML Output</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;'NOTE: 
 all submits will not show this page html</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if 
 eval_valid("request.variables.cart_test_submit") ' submit button 
 pushed</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 eval_valid("request.variables.cart_option") = .F.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 ' no value passed</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 
 request.variables.cart_option = "add" ' change values to current 
 session, current cart, current user if logged on.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.filter 
 = ".T."</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.order 
 = "item_id"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl 
 = table.open(DBF.table_name)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qdx 
 = tbl.query_create()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 qdx.records_get()> 0</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dim 
 findkey&nbsp;as&nbsp;c</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for 
 each foo in cart_old</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;findkey 
 = foo</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 tbl.fetch_find(findkey) > 0 'record found</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.change_begin()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.Session_id 
 = session.sessionid</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.Cart_id 
 = request.variables.cart_id</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.owner_id 
 = session.<strong>protected</strong>pUser.ulink</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.change_end()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.close()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function ' No HTML Output</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 
 request.variables.cart_option = "replace" ' empty values in 
 records for deletion later</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.filter 
 = ".T."</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.order 
 = "item_id"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl 
 = table.open(DBF.table_name)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qdx 
 = tbl.query_create()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 qdx.records_get()> 0</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dim 
 findkey&nbsp;as&nbsp;c</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for 
 each foo in cart_old</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;findkey 
 = foo</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 tbl.fetch_find(findkey) > 0 'record found</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.change_begin()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.Session_id 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.Cart_id 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.owner_id 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.change_end()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.close()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function ' No HTML Output</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 
 request.variables.cart_option = "view"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 popup = 1 ' popup, must return message - no redirect</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.html 
 = stritran(html_exit,"[style]",style_name)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.html 
 = stritran(shopcart_chk.html, "[msg]", "&nbsp;This 
 would show the existing cart items in a small grid<br><br>The 
 page would have a button to select next action&nbsp;")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.RedirectURL 
 = RedirectURL 'go to previous page</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 
 request.variables.cart_option = "exit"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 popup = 1 ' popup, must return message - no redirect</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.html 
 = stritran(html_exit,"[style]",style_name)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.html 
 = stritran(shopcart_chk.html,"[msg]","&nbsp;Add to 
 Cart - Action Cancelled&nbsp;")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.RedirectURL 
 = RedirectURL 'go to previous page</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 select</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>'-------- Set html for previous records ------</p>


<p class=Code>html_prev = <<%html%</p>


<p class=Code><form name="form1" method="post" action=""></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<table 
 width="450" border="0" cellpadding="0" cellspacing="0" 
 align="center"></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 height="5"></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<th 
 height="25" colspan="2" class="[style]ColumnTD" 
 >Shopping Cart </th></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 ></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 height="5" ></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 colspan="2" align="center" class="[style]DataTD">You 
 already have a Shopping Cart from a previous visit. Do you want to </td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 colspan="2" class="[style]DataTD">&nbsp;</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 width="65" class="[style]DataTD">&nbsp;</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 class="[style]DataTD">&nbsp;&nbsp;<input name="cart_option" 
 type="radio" value="add" checked >&nbsp;&nbsp;Add 
 previous items to current Shopping Cart?</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 class="[style]DataTD">&nbsp;</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 class="[style]DataTD">&nbsp;&nbsp;<input name="cart_option" 
 type="radio" value="replace">&nbsp;&nbsp;Only 
 use the current Shopping Cart?</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 class="[style]DataTD">&nbsp;</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 class="[style]DataTD">&nbsp;&nbsp;<input name="cart_option" 
 type="radio" value="view">&nbsp;&nbsp;View 
 the previously selected items?</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 class="[style]DataTD">&nbsp;</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 class="[style]DataTD">&nbsp;&nbsp;<input name="cart_option" 
 type="radio" value="exit">&nbsp;&nbsp;Cancel 
 action?</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 colspan="2" class="[style]DataTD">&nbsp;</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 colspan="2" align="center" class="[style]ErrorDataTD"><strong>Using 
 the current Shopping Cart only will delete the previous selections</strong></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 colspan="2" align="center" class="[style]ErrorDataTD">&nbsp;</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 colspan="2" align="center" class="[style]ErrorDataTD"><input 
 name="cart_test_submit" id="cart_test_submit" type="submit" 
 class="[style]Button" value="Continue"></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</table></p>


<p class=Code></form></p>


<p class=Code>%html%</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;shopcart_chk.html 
 = stritran(html_prev,"[style]",style_name)</p>


<p class=Code>end with</p>


<p class=Code>end</p>


<p class=Code>exit function</p>


<p class=Code>error_chk:</p>


<p class=Code>shopcart_chk.html = error_msg("",parms.popup)</p>


<p class=Code>exit function</p>


<p class=Code>END FUNCTION</td></tr>
</table>

<p class=A5><a name=shopcart_add__>Shopcart_Add()</a></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>FUNCTION shopcart_add&nbsp;as&nbsp;P (parms&nbsp;as&nbsp;P 
 )</p>


<p class=Code>' Function MUST return some html</p>


<p class=Code>shopcart_add.html = ""</p>


<p class=Code>shopcart_add.RedirectURL = ""</p>


<p class=Code>on error goto error_add</p>


<p class=Code>shopcart_add = shopcart_parm_confirm(parms)</p>


<p class=Code>if shopcart_add.html <> ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;shopcart_add.RedirectURL 
 = RedirectURL</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function</p>


<p class=Code>end if</p>


<p class=Code>shopcart_add.RedirectURL = "" ' always will show 
 a message</p>


<p class=Code>html_add = <<%html%</p>


<p class=Code><table id="add_cart" border="0" cellspacing="0" cellpadding="0" align="center"></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td height="5"></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td height="25" align="center" class="[style]ColumnTD"><strong>Shopping Cart</strong></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td align="center" class="[style]DataTD"><br>[message]</td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td height="5"></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code></table></p>


<p class=Code>%html%</p>


<p class=Code>with parms</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;html_add = stritran(html_add, "[style]", style_name)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if input_value_missing <> "" ' some required input parameter missing</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_add.html = stritran(html_add, "[message]", "<span class=\"" + style_name+"ErrorDataTD\"><strong>&nbsp;Error- No [value] Specified&nbsp;</strong></span>")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_add.html = stritran(shopcart_add.html, "[value]", input_value_missing)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end  if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;prod_desc = table.external_record_content_get(product_table, product_table_display_fld,"",  "alltrim(" + product_table_id_fld + ")=\""+product_id + "\"")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;' Test if item exists for current session</p>



<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;filter = "prod_id=\""+product_id+"\".and.session_id=\""+session.sessionid+"\".and.unique_key_value()"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;order = "quantity"</p>



<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;exist_val = &nbsp;&nbsp;table.external_record_content_get(DBF.table_name,
 "quantity", "quantity", order, filter)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if exist_val <> ""'change quantity to new if changed</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if val(exist_val) = quantity</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = prod_desc + "<br><br>Quan&nbsp;" + exist_id  + "&nbsp;Already in Shopping Cart"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_add.html = stritran(html_add, "[message]",message)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit  function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.filter = filter</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.order = order</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl = table.open(DBF.table_name)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qdx = tbl.query_create()	</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if qdx.records_get() = 1</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.change_begin()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.Quantity = quantity</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.Open = .T.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.Cart_id = request.variables.cart_id</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.ord_date = date()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.Ord_time = time()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.change_end()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = prod_desc +"<br><br>Quan in Shopping Cart changed to&nbsp;"+alltrim( str(tbl.Quantity) )</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.close()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_add.html = stritran(html_add,"[message]",message)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else	</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.close()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;message = prod_desc +"<br><br>Quan&nbsp;"+exist_val+"&nbsp;Already in Shopping Cart"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_add.html = stritran(html_add,"[message]",message)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end if</p>

 
<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl = table.open(DBF.table_name)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.enter_begin()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;
  if session.<strong>protected</strong>pUser.ulink <> ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  tbl.Owner_id = session.<strong>protected</strong>pUser.ulink</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.Session_id = session.SessionID</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.Cart_id = request.variables.cart_id</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.Quantity = quantity </p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.Open = .T.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.prod_id = product_id</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.ord_date = date()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.Ord_time  = time()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.enter_end()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;message = prod_desc + "<br><br>Quan&nbsp;" + alltrim( str(tbl.Quantity) ) + "&nbsp;Added  to Shopping Cart"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.close()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;shopcart_add.html = stritran(html_add,"[message]",message)</p>


<p class=Code>end with</p>


<p class=Code>end</p>


<p class=Code>exit function</p>


<p class=Code>error_add:</p>


<p class=Code>shopcart_add.html = error_msg("",parms.popup)</p>


<p class=Code>exit function</p>


<p class=Code>END FUNCTION</td></tr>
</table>

<p class=A5><a name=shopcart_parm_confirm__>Shopcart_Parm_Confirm()</a></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>FUNCTION shopcart_parm_confirm&nbsp;as&nbsp;p (parms&nbsp;as&nbsp;P)</p>


<p class=Code>shopcart_parm_confirm.html = ""</p>


<p class=Code>'-------------------------------------------------------</p>


<p class=Code>' Parameters include</p>


<p class=Code>' style_name</p>


<p class=Code>' owner_Id</p>


<p class=Code>' user_type</p>


<p class=Code>' session</p>


<p class=Code>' session.<strong>protected</strong>pUser.type</p>


<p class=Code>' session.<strong>protected</strong>pUser.ulink</p>



<p class=Code>' request</p>


<p class=Code>' request.variables.cart_id</p>


<p class=Code>' DBF.table_name</p>


<p class=Code>' product_table</p>


<p class=Code>' product_table_display_fld</p>


<p class=Code>' product_table_id_fld</p>


<p class=Code>' product_id</p>


<p class=Code>' popup - 0 - reg page, 1 opened by popup, return html required</p>


<p class=Code>' emptycart_message .T. or .F. - True will show a message 
 is the current cart is empty</p>


<p class=Code>' quantity</p>


<p class=Code>'-------------------------------------------------------</p>


<p class=Code>' Set required parameters</p>


<p class=Code>parmlist = <<%text%</p>


<p class=Code>style_name</p>


<p class=Code>owner_Id</p>


<p class=Code>user_type</p>


<p class=Code>session</p>


<p class=Code>session.<strong>protected</strong>pUser.type</p>


<p class=Code>session.<strong>protected</strong>pUser.ulink</p>



<p class=Code>request</p>


<p class=Code>request.variables.cart_id</p>


<p class=Code>DBF.table_name</p>


<p class=Code>product_table</p>


<p class=Code>product_table_display_fld</p>


<p class=Code>product_table_id_fld</p>


<p class=Code>product_id</p>


<p class=Code>popup</p>


<p class=Code>input_value_missing</p>


<p class=Code>emptycart_message</p>


<p class=Code>quantity</p>


<p class=Code>%text%</p>


<p class=Code>with parms</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;'test 
 if parms passed</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;for 
 each foo in parmlist</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 eval_valid(foo) = .F.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shopcart_parm_confirm.html 
 = error_msg(w_upper( lower(foo) )+ " Parameter Missing",popup)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;next</p>


<p class=Code>end with</p>


<p class=Code>END FUNCTION</td></tr>
</table>

<p class=A5><a name=error_msg__>Error_Msg()</a></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>FUNCTION error_msg&nbsp;as&nbsp;C(msg_text = "", 
 prevmsg=0)</p>


<p class=Code>error_msg = ""</p>


<p class=Code>error_html = <<%html%</p>


<p class=Code><table width="200" border="0" cellspacing="0" 
 cellpadding="0" align="center"></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 height="5"></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<th 
 style="font-family: Arial, Helvetica, sans-serif; font-size: medium; 
 color: #FFFFFF; background-color: #FF0000;">Error</th></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;<tr></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<td 
 style=" font-family: Arial, Helvetica, sans-serif; font-size: x-small; 
 text-align: center; font-weight: bold; padding: 10px; "><p>A 
 Required Value is Not Available</p><p>Error:&nbsp;<strong>err</strong></p></td></p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;</tr></p>


<p class=Code></table></p>


<p class=Code>[prevpage]</p>


<p class=Code>%html%</p>


<p class=Code>if prevmsg = 1</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;error_html 
 = stritran(error_html,"[prevpage]","")</p>


<p class=Code>else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;error_html 
 = stritran(error_html,"[prevpage]","<p>&nbsp;&nbsp;<a 
 href="\"#\"" on<x>click=\"ja<x>vascript:history.go(-1)\">Previous 
 Page</a></p>")</p>


<p class=Code>end if</p>


<p class=Code>if msg_text = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;error_msg 
 = stritran(error_html,"<strong>err</strong>",error_text_get( error_code_get() )+" 
 on line "+alltrim( str( error_line_number_get() ) ) )</p>


<p class=Code>else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;error_msg 
 = stritran(error_html,"<strong>err</strong>",msg_text)</p>


<p class=Code>end if</p>


<p class=Code>END FUNCTION</td></tr>
</table>

<p class=A5>Page Security Information</p>



<p>Always Allowed</p>



<p class=A5>See Also</p>



<p><a href="../Tutorials/AlphaSportsWeb Explained (Non-Ajax Web)/AlphaSportsWeb Web Pages.html" title="AlphaSportsWeb Web Pages" class="wiki">Web Pages</a></p>



	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:SHOPCART_UDF.A5W">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 --></body></html>