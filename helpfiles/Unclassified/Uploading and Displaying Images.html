	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<p class=A3Topic>Uploading and Displaying Images</p>

<p>A common web application requirement is to allow users to upload and view images. This example provides a simple model that you can start with.</p>

<p class=A5>The Database Design</p>

<p>The <span class=Code1>ImageDB</span> database has 4 fields.</p>

 <table style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; border-spacing: 0px; border-spacing: 0px;" cellspacing="0"> <col> <col> <col> <tr style="x-cell-content-align: top;" valign="top"> <td class="TableHeader" style="x-cell-content-align: top;" valign="top"><p class=TableHead>Name</td> <td class="TableHeader" style="x-cell-content-align: top;" valign="top"><p class=TableHead>Type</td> <td class="TableHeader" style="x-cell-content-align: top;" valign="top"><p class=TableHead>Purpose</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>ID</td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Character,8 auto-increment</td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Provides a unique ID for each record</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Name</td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Character,50</td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Saves the image name</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Image</td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Image File Reference</td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Saves the path and filename of the image.</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Uploaddate</td> <td class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Time field</td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Saves the date and time the image was uploaded.</td></tr> </table><p>The image files are stored in a folder named "Images" under the folder containing the database files.</p>

<p class=A5>Publishing Profiles</p>

<p>The Local Webroot profile contains the following information.</p>

 <table style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; border-spacing: 0px; border-spacing: 0px;" cellspacing="0"> <col> <col> <tr style="x-cell-content-align: top;" valign="top"> <td class="TableHeader" style="x-cell-content-align: top;" valign="top"><p class=TableHead>Property</td> <td class="TableHeader" style="x-cell-content-align: top;" valign="top"><p class=TableHead>Description</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>General > Aliases</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Code1>[PathAlias.ADB_Path] = a5.get_path()</span></td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>Folder in Webroot > Target folder</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>ImageDB</td></tr> </table><p>The Server profile contains the following information.</p>

 <table style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; border-spacing: 0px; border-spacing: 0px;" cellspacing="0"> <col> <col> <tr style="x-cell-content-align: top;" valign="top"> <td class="TableHeader" style="x-cell-content-align: top;" valign="top"><p class=TableHead>Property</td> <td class="TableHeader" style="x-cell-content-align: top;" valign="top"><p class=TableHead>Description</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>General > Publishing Type</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Publish on LAN</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>General > Aliases</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Code1>[PathAlias.ADB_Path] = c:\data\imagedb</span></td> </tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>Publish to LAN > Webroot</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Code1>\\doc\c\a5webroot</span></td> </tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>Publish to LAN > Target folder</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>ImageDB (which means that the pages will be stored in <span class=Code1>\\doc\c\a5webroot\ImageDB</span> )</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>Publish&nbsp;Database&nbsp;Files&nbsp;> Publish data files</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>TRUE (checked)</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>Publish Database Files > Files to publish</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Code1>ImageDB.dbf</span> in the database folder and <span class=Code1>junk.jpg</span> in the Images sub-folder</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>Publish Database Files > Folder</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Code1>\\Doc\C\Data\ImageDB</span></td> </tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>Open Page after Publish > Base URL</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>http://doc</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>Open Page after Publish > Server Port</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>80</td></tr> <tr style="x-cell-content-align: top;" valign="top"> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft><span class=Button>Open Page after Publish > Default Page</span></td> <td colspan="1" rowspan="1" class="TableCell" style="x-cell-content-align: top;" valign="top"><p class=TableLeft>Main.a5w</td></tr> </table><p class=A5>The Grid Component</p>

<p>The grid (named <span class=Code1>Main</span> ) is based on the <span class=Code1>ImageDB</span> table. The <span class=Control>Order</span> expression is <span class=Code1>invertUploaddate<a href="tiki-editpage.php?page=Uploaddate" title="Create page: Uploaddate" class="wiki wikinew ctime">?</a></span>, which causes the newest images to be shown first.</p>

<p>The grid component displays all 4 fields in the database. The <span class=Code1>Name</span> field is displayed in a TextBox. The <span class=Code1>ID</span> and <span class=Code1>Uploaddate</span> fields are displayed in labels. the <span class=Code1>Name</span> column contains a free form template that displays the values of the <span class=Code1>Name</span> and <span class=Code1>Uploaddate</span> fields. The <span class=Code1>Uploaddate</span> column is hidden.</p>

<p>The <span class=Code1>Image</span> field is displayed in an Image control, which has the following <span class=Button>Image Properties > Image path</span> property: <span class=Code1>[PathAlias.ADB_Path]\images</span>, which evaluates to <span class=Code1>\\Doc\C\Data\ImageDB\Images</span> on the server.</p>

<p class=A5>The A5W Page</p>

<p>The A5W page (named <span class=Code1>Main</span> ) contains the <span class=Code1>Main</span> grid component, HTML text, a standard HTML form with a textbox and 2 buttons, and an Xbasic script.</p>

<p>The form appears just above the grid on the body of the page and looks like this. </p>

<p class=Pix><img src="images/WPT_Image_Upload_Form.gif" x-maintain-ratio=TRUE style="border: none; width: 448px; height: 43px; float: none; border-style: none; border-style: none;" width=448 height=43 border=0></p>

<p>The code that generates this form is below. The <span class=Code1>&lt%a5 ? request.script_name %></span> action causes the page to reload when the user clicks either of the buttons. The <span class=HTML1>&ltinput type="file" name="FileToUpload" ></span> code generates the <span class=Button>Browse...</span> button and allows the user to navigate to and select a file. The <span class=HTML1>&ltinput type="submit" name="cmd" value="Upload File"></span> code creates a variable named <span class=Code1>cmd</span> when the user clicks the <span class=Button>Upload File</span> button.</p>

 <table class="htmlTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code><span class=HTML1>&ltform action="</span> &lt%a5 ? request.script_name %> <span class=HTML1>" method="post" enctype="multipart/form-data"></span></p>

<p class=Code><span class=HTML1>&ltinput type="file" name="FileToUpload" ></span></p>

<p class=Code><span class=HTML1>&ltinput type="submit" name="cmd" value="Upload File"></span></p>

<p class=Code><span class=HTML1>&lt/form></span></td> </tr> </table><p>The Xbasic script is located inside the <span class=HTML1>&lthead> ... &lt/head></span> tags of the page. The first thing the script does is test to see if the <span class=Code1>cmd</span> variable exists, which is doesn't until the user clicks the <span class=Button>Upload File</span> button.</p>

 <table class="htmlTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>&lt%a5</p>

<p class=Code>dim msg&nbsp;as&nbsp;c = ""</p>

<p class=Code>if eval_valid("cmd")</td></tr> </table><p>After the user clicks <span class=Button>Upload File</span>, the if <span class=Code1>eval_valid("cmd")</span> statement returns TRUE, and the rest of the code executes. The script gets the filename selected by the user from <span class=Code1>FileToUpload.filename</span>, prefixes the appropriate path information ( <span class=Code1>[PathAlias.ADB_Path]\images\\</span> ), and saves the result in <span class=Code1>fn</span>.</p>

 <table class="htmlTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code></p>

<p class=Code>dim fn&nbsp;as&nbsp;C</p>

<p class=Code></p>

<p class=Code>fn = "[PathAlias.ADB_Path]\images\\" + FileToUpload.filename</td></tr> </table><p>Next, the script loads the file's contents into the variable <span class=Code1>FileToUpload.data</span> and generates a message indicating that the file was successfully uploaded. (A more rigorous script would include error handling to deal with the possibility that the user selected a non-JPEG file.) The code to display the message ( <span class=Code1>&lt%a5 ? msg %></span> ) is just below the <span class=HTML1>&ltbody></span> tag.</p>

 <table class="htmlTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code></p>

<p class=Code>file.from_blob(fn, FileToUpload.data)</p>

<p class=Code></p>

<p class=Code>msg = "&lta href=\"/" + FileToUpload.filename + "\" target=\"_blank\">" + FileToUpload.filename + "&lt/a> was uploaded&ltbr />&ltbr />"</td></tr> </table><p>Finally, the script opens the <span class=Code1>ImageDB</span> table and writes a new record.</p>

 <table class="htmlTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code></p>

<p class=Code>tbl = table.open("[PathAlias.ADB_Path]\ImageDB.dbf")</p>

<p class=Code></p>

<p class=Code>tbl.enter_begin()</p>

<p class=Code></p>

<p class=Code>tbl.Image = fn</p>

<p class=Code></p>

<p class=Code>tbl.Name = FileToUpload.filename</p>

<p class=Code></p>

<p class=Code>tbl.Uploaddate = now()</p>

<p class=Code></p>

<p class=Code>tbl.enter_end(.t.)</p>

<p class=Code></p>

<p class=Code>tbl.close()</p>

<p class=Code>end if</p>

<p class=Code>%></td></tr> </table><p>The page looks like the following. </p>

<p class=Pix><img src="images/WPT_Uploading_Images.gif" x-maintain-ratio=TRUE style="border: none; width: 800px; height: 425px; float: none; border-style: none; border-style: none;" width=800 height=425 border=0></p>

<p class=A5>See Also</p>

<p><a href="../Orphans/Contents - Web Publishing Tutorial.html" title="Contents - Web Publishing Tutorial" class="wiki">Contents</a></p>

	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:Uploading+and+Displaying+Images">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA: {"group":"/Guides","status":"pending"} --->
</body></html>