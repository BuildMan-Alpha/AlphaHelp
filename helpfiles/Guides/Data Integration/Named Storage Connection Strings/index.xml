<page>
    <shortlink>named storage connection strings</shortlink>
    <topic>Storage Connections</topic>
    <description>
        <p>Storage is an Alpha Anywhere abstraction for dealing with different types of storage using a standard interface. Currently, three types of storage are supported - Amazon S3, Azure and Disk storage.</p>
    </description>
    <discussion>
        <p>Storage is used for storing files.</p>
        <p>To work with Storage you will need a storage connection string to 'connect' to the storage object.</p>
        <p>Named connection strings are typically used (in much the same way that named AlphaDAO connection strings are used when you connect to a SQL database).</p>
        <p>To create a named storage connection string, select the Tools, Storage Connection strings menu item from the Tools menu when the Web Control Panel has focus.</p>
    </discussion>
    <sections>
        <section>
            <figure>
                <link>images/TOOLSMENU_STORAGE.jpg</link>
            </figure>
        </section>
        <section>
            <description>
                <p>This will open a dialog where you can create as many named storage connection strings as you want.</p>
                <p>When you create or edit a named storage connection string, the Connection String dialog is shown:</p>
            </description>
            <figure>
                <link>images/storageconnectionstringdialog.jpg</link>
            </figure>
        </section>
        <section>
            <description>
                <p>Named storage connection strings are published in the a5_application.a5i file when you publish your application.</p>
            </description>
        </section>
        <section>
            <title>Named Storage Connection String Builder Settings</title>
            <description>
                <p>The *[ui:Named Storage Connection String Builder]* is used to build a named connection string to a storage container stored in Amazon S3, Azure, or on disk. A description of general settings and settings for each storage type are listed below.</p>
            </description>
            <cases>
                <case>
                    <title nested="2">General Storage Connection Settings</title>
                    <description>These are general settings that apply to all storage types.</description>
                    <list>
                        <item>
                            <name-title>Property</name-title>
                            <description-title>Description</description-title>
                        </item>
                        <item>
                            <name>Storage Provider</name>
                            <description>Where the files are stored. Files can be stored on *[ui:Amazon S3]*, *[ui:Azure]* or on *[ui:Disk]* on the server hosting the Alpha Anywhere Application Server.</description>
                        </item>
                        <item>
                            <name>Triple-DES Object Encryption Key (optional)</name>
                            <description>If specified, used to encrypt the data in transit and at rest in the data container. Encryption takes place in the Alpha Anywhere Application Server. Click *[ui:Generate a New Key]* to generate a random encryption key.</description>
                        </item>
                        <item>
                            <name>Encrypt Connection String</name>
                            <description>If checked, storage connection string will be encrypted using the specified passphrase.</description>
                        </item>
                        <item>
                            <name>Encryption Passphrase</name>
                            <description>The passphrase used to encrypt the connection string.</description>
                        </item>
                        <item>
                            <name>Container Must Exist</name>
                            <description>Check if the specified container must exist.</description>
                        </item>
                        <item>
                            <name>Request Timeout (milliseconds)</name>
                            <description>The timeout length specified as milliseconds. Used when connecting to or communicating with the storage container. If no response is received after the specified timeout, the operation is cancelled.</description>
                        </item>
                    </list>
                </case>
                <case>
                    <title nested="2">Amazon S3 Storage Connection Settings</title>
                    <description>When configuring a storage connection string for Amazon S3, you will have access to the settings below:</description>
                    <list>
                        <item>
                            <name-title>Property</name-title>
                            <description-title>Description</description-title>
                        </item>
                        <item>
                            <name>Region</name>
                            <description>The region where the Amazon S3 bucket is located.</description>
                        </item>
                        <item>
                            <name>Access Key</name>
                            <description>Your Amazon S3 access key.</description>
                        </item>
                        <item>
                            <name>Secret Key</name>
                            <description>The secret key for your Amazon S3 account.</description>
                        </item>
                        <item>
                            <name>Show Secret Key</name>
                            <description>If checked, shows the secret key in plaintext.</description>
                        </item>
                        <item>
                            <name>Container Name</name>
                            <description>The name of the Amazon S3 or Azure container where files are stored.</description>
                        </item>
                    </list>
                </case>
                <case>
                    <title nested="2">Azure Storage Connection Settings</title>
                    <description>These settings are for configuring an Azure storage connection.</description>
                    <list>
                        <item>
                            <name-title>Property</name-title>
                            <description-title>Description</description-title>
                        </item>
                        <item>
                            <name>Use Test Storage</name>
                            <description>If checked, uses the test storage container for Azure. Test Storage does not require an Account or Access Key.</description>
                        </item>
                        <item>
                            <name>Account</name>
                            <description>Your Azure account name.</description>
                        </item>
                        <item>
                            <name>Access Key</name>
                            <description>Your access key for your Azure account.</description>
                        </item>
                        <item>
                            <name>Show Access Key</name>
                            <description>If checked, shows the access key in plaintext.</description>
                        </item>
                        <item>
                            <name>Container Name</name>
                            <description>The name of the Amazon S3 or Azure container where files are stored.</description>
                        </item>
                    </list>
                </case>
                <case>
                    <title nested="2">Disk Storage Connection Settings</title>
                    <description>
                        <p>A "Disk" storage connection can be used to store files outside the webroot on the server running the Alpha Anywhere Application Sever. Using a storage connection is preferred to accessing directories directly using the FILE object in Xbasic, especially if you are using the Application Server for IIS.</p>
                    </description>
                    <list>
                        <item>
                            <name-title>Property</name-title>
                            <description-title>Description</description-title>
                        </item>
                        <item>
                            <name>User Name</name>
                            <description>The user name for accessing a network share.
	                            For deployed web applications, grant the machine and account access to the share instead of putting a user name and password into a connection string.  
						This will simplify management and reduce the chance of someone gaining access to the user name and password.
						</description>
                        </item>
                        <item>
                            <name>Password</name>
                            <description>The password for your user name.</description>
                        </item>
                        <item>
                            <name>Show Password</name>
                            <description>If checked, shows the password in plaintext.</description>
                        </item>
                        <item>
                            <name>Parent Path</name>
                            <description>The base path on the server to the directory where files are stored.</description>
                        </item>
                    </list>
                </case>
            </cases>
        </section>
        <section>
            <title>Xbasic Functions for Working with Storage</title>
            <description>
                <p>Several Xbasic helper functions make it easy to work with the storage. These helper functions are written on top of the low level storage objects are listed below.</p>
            </description>
            <list>
                <item>
                    <name-title>Function</name-title>
                    <description-title>Description</description-title>
                </item>
                <item>
                    <name>[a5Storage_saveFile()]</name>
                    <description>saves a file in storage</description>
                </item>
                <item>
                    <name>[a5Storage_saveData()]</name>
                    <description>saves binary data in storage</description>
                </item>
                <item>
                    <name>[a5Storage_getItemProperties()]</name>
                    <description>gets information about a file in storage</description>
                </item>
                <item>
                    <name>[a5Storage_getItem_as_blob()]</name>
                    <description>retrieves an item from storage to a variable</description>
                </item>
                <item>
                    <name>[a5Storage_getItem_as_file()]</name>
                    <description>retrieves an item from storage and stores it as a local file</description>
                </item>
                <item>
                    <name>[a5Storage_listItems()]</name>
                    <description>create a CRLF delimited list of items in storage</description>
                </item>
                <item>
                    <name>[a5Storage_deleteItem()]</name>
                    <description>deletes an item from storage</description>
                </item>
            </list>
        </section>
        <section>
            <title>Setting Permissions for Storage</title>
            <description>
                <p>Each type of storage has a mechanism for securing the objects stored.</p>
            </description>
            <list>
                <item>
                    <name-title>Storage Type</name-title>
                    <description-title>Securing Containers and Items</description-title>
                </item>
                <item>
                    <name>Disk</name>
                    <description><p>For Disk storages containers and items are called folders and files.
							  Folders and files are secured using Access Control Lists.</p>
					<p>Folders and files can be managed through the Windows user interface.</p>
				</description>
                </item>
                <item>
                    <name>Azure</name>
                    <description><p>For Azure storage, containers and items are called containers and blobs. Containers and blobs can have permissions set on them as well.</p>
					<p>See <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-manage-access-to-resources>Microsoft Azure Container and Blob Permissions</a>for more information on security Azure storage.</p>
				</description>
                </item>
                <item>
                    <name>Amazon Simple Storage Service (S3)</name>
                    <description><p>For Amazon S3 storage, containers and items are called buckets and objects.
						Buckets and objects can be authorized by user as well as having public permissions set on them.</p>
				<p>Below are some examples of permissions you may need to set to manage objects in a bucket.<br/>
				<ul>
					<li>To verify a storage connection string in the connection string dialog, you will need to set the "s3:GetBucketLocation" permission.</li>
					<li>To read objects, you may need some combination of s3:ListObjects, s3:GetObject, and s3:GetObjectVersion.</li>
					<li>To delete objects, you will need s3:DeleteObject.</li>
					<li>To store new objects, you will need s3:PubObject.</li>
					</ul>
				</p>
				
				<p>There are many other permissions that you can grant for buckets and objects.
				See <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/set-permissions.html">Amazon S3 Permissions</a> for more information on security Amazon S3 storage.
				</p>
				</description>
                </item>
            </list>
        </section>
        <section>
            <description>
                <p></p>
            </description>
        </section>
    </sections>
    <links>
        <link link="api a5 storage save file function">a5Storage_saveFile()</link>
        <link link="api a5 storage save data function">a5Storage_saveData()</link>
        <link link="a5storage_getitemproperties function">a5Storage_getItemProperties()</link>
        <link link="api a5storage getitem as blob function">a5Storage_getItem_as_blob()</link>
        <link link="api a5storage getitem as file function source">a5Storage_getItem_as_file()</link>
        <link link="api a5 storage list items function">a5Storage_listItems()</link>
        <link link="api a5 storage delete item function">a5Storage_deleteItem()</link>
    </links>
</page>