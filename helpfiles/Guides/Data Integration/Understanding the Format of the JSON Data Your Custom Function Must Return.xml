<page>
  <topic>Understanding the Format of the JSON Data Your Custom Function Must Return
</topic>
 <description>The JSON data that your function returns can be Simple or Complex.
</description> 
 <sections>
   <section>
  <title>Simple JSON</title>
  <description>For Simple JSON, the string that you return is just an array of JSON objects, For example:
</description>
 <example><![CDATA[function myjson as c(e as p)
myjson = <<%json%
[
	{"Firstname" : "Fred", "Lastname" : "Smith"},
	{"Firstname" : "Harry", "Lastname" : "Jones"}
]
%json%
end function ]]></example> 
  
   </section>
    <section>

  <description>In this case since no schema is supplied the data are all considered to be character type of length 1024 characters. While the advantage of this format is that is extremely simple, it does mean that you will need to adjust the size of each field you place on your report because its default size will likely be too large.
</description>
 
   </section>
      <section>
  <title>Complex JSON
</title>
  <description>For Complex JSON, the string that you return is an object with two properties, schema and data. The schema object defines the schema of the data (for example, field type, size, etc.) and the data property is an array of JSON objects that define the data for the report. For example:
</description>
 <example><![CDATA[function myjson as c(e as p)
myjson = <<%json%
{
	"schema" : { "firstname" : { "type" : "C" , "width": 30 } 
	           , "lastname" : { "type" : "C"  , "width": 30} 
	           , "company" : { "type" : "C"  , "width": 30} 
	           , "age" : { "type" : "N" , "width" : 3, "decimal" : 0 }
	},
	"data": 
		[
			{"firstname":"Fred", "lastname":"Smith", "company" : "Alpha Software", "age" : 30},
			{"firstname":"John", "lastname":"Jones", "company" : "Beta Software", "age" : 23}
		]
}
%json%
end function ]]></example> 
  
   </section>
    <section>

  <description>In the above example, we have specified the size and type of each field in the data array. Notice that we have also specified the number of decimal places for the numeric field.
The data types supported in the schema are: 
</description>
 <cases>
   <case>
     <description>C - Character (you must also specify a "width" property for this type)
</description>
   </case>
    <case>
     <description>N - Numeric (you must also specify a "width" and "decimal" property for this type)
</description>
   </case>
    <case>
     <description>L - logical
</description>
   </case>
    <case>
     <description>M - memo
</description>
   </case>
    <case>
     <description>D - date
</description>
   </case>
    <case>
     <description>T - date/time
</description>
   </case>
    <case>
     <description>Y - short time
</description>
   </case>
    <case>
     <description>E - exponent numeric
</description>
   </case>
    <case>
     <description>K - guid
</description>
   </case>
    <case>
     <description>JPEG - Jpeg field (data in the JSON data property is expected to be base64 encoded)
</description>
   </case>
    <case>
     <description>PNG - PNG (data in the JSON data property is expected to be base64 encoded)
</description>
   </case>
    <case>
     <description>BMP - BMP (data in the JSON data property is expected to be base64 encoded)
</description>
   </case>
    <case>
     <description>I - Image Reference Field (data in the data property is a image file name but the report will treat the data as an image).
</description>
   </case>
   
 </cases>
 <note>If you specify that a field uses the Date (D), Date/Time (T) or Short time (Y) format in the schema, the data in the data array must be a string in UTC date format. For example: 2014-10-27T23:06:50.361Z. The date part format is yyyy-mm-dd and the time part uses GMT. In the case of a Short time field, the date portion of the UTC date string is ignored.</note>
   </section>
      <section>

  <description>The schema also allows you to extract data from objects within each row and to map property names in the data array to different names. For example in the data shown below, the address property is an object with two sub-properties. 
</description>
 <example><![CDATA[{
   "name": "Fred Smith",
   "company" : "XYZ Corp",
   "address": {
       "street": "Main Street",
       "number": 23
    }
}]]></example> 
  
   </section>
   <section>
     <description>Shown below is how the function would be defined to return the JSON data. Notice that the JSON object has both a schema and a data property. The schema indicates what fields will be available to the report. The list of fields specified by the schema are: name, companyName, street and number. 
</description>
   </section>
      <section>

  <description>Notice that the data array does not have a property called companyName. It has a property called company. So the schema property for the companyName field indicates that the source of this field is the company property in the data array. Similarly, the street field in the schema is mapped to the address.street property in the data array.
If the definition for a field in the schema omits the source property, then the source is the same as the item name. For example the definition for the name field in the schema shown below does not have a source property, therefore this field is mapped to the name property in the data array.
</description>
 <example><![CDATA[function myjson as c(e as p)
myjson = <<%json%
{
    "schema": {
        "name": {
            "type": "c",
            "width": 30
        },
        "companyName: {
        	"source": "company",
        	"type" : "c",
        	"width" : 30
        },
        
        "street": {
            "source": "address.street",
            "type": "c",
            "width": 40
        },
        "number": {
            "source": "address.number",
            "type": "n",
            "width": 5,
            "decimal": 0
        }
    },
    "data": [
        {
            "name": "Fred Smith",
            "company" : "XYZ Corp",
            "address": {
                "street": "Main Street",
                "number": 23
            }
        },
        {
            "name": "John Jones",
            "company" : "ABC Corp",
            "address": {
                "street": "Corner Road",
                "number": 3
            }
        }
    ]
}
%json%
end function ]]></example> 
  
   </section>
      <section>

  <description>In the next example, we show how the JSON object that you specify can include image data. The binary data for the image are encoded as base64 strings. The example shows the complete function definition. Notice that the schema indicates that the image field will be stored as a PNG. Notice also that in the first record, the base64 encoded data in the image property does not include the MIME type at the start of the base64 encoded data. This data is therefore presumed to be a PNG image since the schema indicates that the image is a PNG type. Notice however, that the second row of data in the data array has a MIME type prefix on the base64 encoded image data. The data for the image is for a BMP image. The image will therefore be converted from BMP to PNG automatically.
</description>
 <example><![CDATA[function myjson as c(e as p)
myjson = <<%json%
{
   "schema" : {
      "name" : { "type" : "C" , "width": 30 }, 
      "image" : { "type" : "Png" }
	},
	"data": 
       [
          {"name":"John Smith", "image" : "iVBORw...(data truncated for readability)....AAAElFTkSuQmCC" },
          {"name":"Jane Smith", "image" : "data:image/bmp;base64,Qk02AwAAA...(data truncated for readability)....AAAADYAAAAAA=="}
       ]
}
%json%	
end function]]></example> 
  
   </section>
   
   
 </sections> 
  
</page>