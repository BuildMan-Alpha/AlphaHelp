<page>
    <shortlink>ux data controls calendar property displaying events on a calendar control</shortlink>
    <topic>Displaying Events on a Calendar Control</topic>
    <description>You can customize the calendar control to display events drawn from an SQL 
      database. 
    </description>
  <sections>
     
      <section>
          <description>One way to accomplish this is through an ajax callback. The ajax callback is executed everytime a 
            user navigates to a new month and contains a 
            query against the 'Orders' table in the 'Northwind' database. This query gets 
            a list of the orders that occurred on each day in each month. In order to display the results of this 
            query on the calendar
            
            The boxes for each day can also be enlarged so that this data can be displayed on the 
      calendar on the day that the event occurred.
            
            
            For a visual explanation on how to do this watch this seven part video: [Part 1]
              [Part 2], [Part 3], [Part 4], [Part 5], [Part 6], [Part 7],  or read the guide below.
          </description>
          
      </section>
      
       <section>
        <title>Set the UX Properties</title>
        <steps>
          <step>
            <description>In the UX Builder's UX Properties page scroll down to the 'CSS/SVG' section. 
              Click the [...] button next to the 'Local CSS definitions' property.
            </description>
            <figure><link>images/de25.png</link></figure>
          </step>
      <step>
        <description>In the 'CSS Editor - []' open the 'Code' tab at the bottom of the editor.</description>
         <figure><link>images/de26.png</link></figure>
      </step>
       <step>
        <description>Add the following definition for a 'hiddenItems' css class and click OK.</description>
        <example><![CDATA[.hiddenItem {display: none;}]]></example>
         <figure><link>images/de27.png</link></figure>
      </step>
      
      
      
      
          <step>
           <description>Scroll down to the 'Other' section on the Properties list. 
             Find the 'Date format' property and set it to be 'MM/dd/yyyy'.
            </description>
               <figure><link>images/de2.png</link></figure>
          </step>
          
          
        </steps>
        
      </section>
      <section>
          <title>Customize the Layout of the Calendar.</title>
          <steps>
              <step>
                  <description>In the UX Builder on the UX Controls page open the 'Data Controls' menu. Click 
                      on the [Calendar] option to add a calendar control to the component. Give the calendar the name 
                      'dt1'.
                  </description>
                  <figure><link>images/de3.png</link></figure>
              </step>
              <step>
                  <description>Highlight the calendar control in the controls tree. In the properties list on the right 
                    go to the 'Field Properties' section and set the 'Default value' property to '8/1/1994'. Most of the events 
                    listed in the northwinds SQL table that will be used for this example are from 1994.
                  </description>
                  <figure><link>images/de4.png</link></figure>
              </step>
              <step>
                <description>Go to the 'Date/Time Picker Properties' section. Check the 'Draw boxes around dates' 
                      checkbox property.</description>
                <figure><link>images/de5.png</link></figure>
              </step>
              <step>
                  <description>Set the 'Date item hover class name' property to be 'None' by writing 
                      'None' next to the property.
                  </description>
                  <figure><link>images/de6.png</link></figure>
              </step>
              <step>
                  <description>Set the 'Date item selected calss name' property to be 'None' by writing 
                      'None' next to this property as well.</description>
                  <figure><link>images/de7.png</link></figure>
              </step>
              <step>
                  <description>Set the 'Date item out of range class name' property to be 'hiddenItem'.</description>
                  <figure><link>images/de8.png</link></figure>
              </step>
              <step>
                  <description>Click the [...] button next to the 'Date item style' property.</description>
                  <figure><link>images/de9.png</link></figure>
              </step>
              <step>
                  <description>Scroll down to the 'Positioning and Size' section of the Style Editor. Set the 'Width' 
                      and 'Height' properties to be "1.5in". Click OK.
                  </description>
                  <figure><link>images/de10.png</link></figure>
              </step>
              <step>
                  <description>In the calendar's 'Date/Time Picker Properties' section check 
                      the 'Has events' property </description>
                  <figure><link>images/de11.png</link></figure>
              </step>
               <step>
                  <description>Click the '+' button next to the 'Has events' property 
                      to expand the events list. Next to the onItemDraw event write 'calendarDrawItem'.</description>
                  <figure><link>images/de12.png</link></figure>
              </step>
               <step>
                  <description>Next to the 'onMonthNavigate' event write 'calendarMonthNavigate'.</description>
                  <figure><link>images/de13.png</link></figure>
              </step>
              <step>
                  <description>Expand the 'Events' menu and click on the 'Client-side' events page. In the 'Client-Side Events' 
                    list highlight the 'onRenderComplete' event.
                  </description>
                  <figure><link>images/de14.png</link></figure>
              </step>
               <step>
                  <description>Add the following function call to the 'onRenderComplete' event.</description>
                  <example><![CDATA[calendarMonthNavigate();]]></example>
                  <figure><link>images/de15.png</link></figure>
              </step>
              
              
          </steps>
          
          
      </section>
     <section>
       <title>Create a Connection to the AADemo-Northwind database</title>
       <steps>
         <step>
           <description>In the main toolbar click on the 'SQL' button and select the 'AlphaDAO Connection Strings' 
             option.
           </description>
           <figure><link>images/de21.png</link></figure>
         </step>
          <step>
           <description>Click the "Create 'AADemo-Northwind' demo connection string" hyperlink.</description>
           <figure><link>images/de22.png</link></figure>
         </step>
          <step>
           <description>Select the 'Microsoft Access Database Engine' radio button option at the bottom 
             of the page. Click the "OK - Create a named connection string called 'AADemo-Northwind'" option. 
             Click OK again.
           </description>
           <figure><link>images/de23.png</link></figure>
         </step>
          <step>
           <description>Click 'Close'.</description>
           <figure><link>images/de24.png</link></figure>
         </step>
         
         
       </steps>
       
     </section>
      
       <section>
          <title>Add Javascript Definitions</title>
          <steps>
            <step>
              <description>In the UX Builder's main menu on the left expand the 'Code' menu. Click to 
                open the "Javascript functions" page</description>
               <figure><link>images/de16.png</link></figure>
            </step>
              <step>
                  <description>Add the following javascript function definitions to the 'Javascript functions' page.</description>
                  <example><![CDATA[function calendarDrawItem(ele,date,type) {
	var curObj = {dialog.object}.getControl('DT1');
	var calData = curObj._data;
	
	if(typeof curObj._menuItems == 'undefined') {
		curObj._menuItems = {};
	}
	if(type == 'date') {
		if(typeof calData != 'undefined') {
			var dateStr = date.getFullYear() + '-' +(date.getMonth() + 1) + '-' + date.getDate();
			if(typeof calData[dateStr] != 'undefined') {
				var tempData = calData[dateStr];
				var maxItemsToShow = 1
				if(tempData.length > maxItemsToShow ) {
					var windowContent = '';
					var menuItems = [];
					for(var i = 0; i < tempData.length; i++) {
						menuItems.push({
							html: '<span title="'+tempData[i].detail+'">' + tempData[i].name + '</span>',
							onClick: Function('editEvent(\'' + tempData[i].id + '\')')
						});
					}	
					curObj._menuItems[dateStr] = menuItems;
					ele.innerHTML = ele.innerHTML + '<br><span onmouseover="showEventList(this,\''+dateStr+'\');">Multiple... (' + tempData.length + ')</span>';
				} else {
					for(var i = 0; i < tempData.length; i++) {
						ele.innerHTML = ele.innerHTML + '<br>' + '<a class="{dialog.style}Link" href="#" title="'+tempData[i].detail+'" onclick="editEvent(\''+tempData[i].id+'\');$e.stopEvent(event); return false;">' +tempData[i].name +'</a>' ;
					}		
				}
			}
		}
	}
}

function calendarMonthNavigate(date) {
	var calObj = {dialog.object}.getControl('DT1');

	delete calObj._menuItems;
	var menuName = '_CalendarDetailsMenu';
	if(typeof calObj[menuName] != 'undefined') {	
		calObj[menuName].hide();
	}
	var data = '_month=' + (calObj._dp._month+1) + '&_year=' +  calObj._dp._year;
	{grid.Object}.ajaxCallback('G','','getEvents','',data);
}

function editEvent(id) {
	alert('Display Order:' + id );
}

function showEventList(objEle, dateStr) {
	var menuName = '_CalendarDetailsMenu';
	var curObj = {dialog.object}.getControl('DT1');
	if(typeof curObj[menuName] == 'undefined') {
		curObj[menuName] = new A5.Menu([],{
			theme: '{dialog.style}',
			iconColumn: {show: false}
		});
	}
	
	curObj[menuName].populate(curObj._menuItems[dateStr]);
	curObj[menuName].show('popup',objEle);
}
]]></example>
                  <figure><link>images/de17.png</link></figure>
              </step>
              
          </steps>
          
          
      </section>
       <section>
          <title>Add Xbasic Definitions</title>
          <steps>
            <step>
              <description>In the 'Code' menu click to open the 'Xbasic functions' page.</description>
              <figure><link>images/de18.png</link></figure>
            </step>
              <step>
                  <description>In the Xbasic functions page add the following Xbasic function definitions.</description>
                  <example><![CDATA[function getEvents as c (e as p)
dim month as c 
dim year as c 
dim startDate as d 
dim endDate as d 

startDate = date_value(val(e._year),val(e._month),1)
if val(e._month) < 12 then 
	endDate = date_value(val(e._year),val(e._month)+1,1) -1
else
	endDate = date_value(val(e._year)+1,1,1) -1
end if 

dim jsonData as c 
dim def as p
dim defn as p
defn.type = "sql"
defn.connectionString = "::Name::AADemo-Northwind"
defn.tableName = <<%sql%
SELECT Orders.OrderID as OrderId, 
	concatenate(orders.orderid,': ', customers.companyname) as eventName, 
	Orders.OrderDate as orderDate, 
	concatenate('Order: ', orders.orderid, ': ', customers.contactname, ' ', customers.companyname)  AS eventdescription 
FROM Orders Orders
	 INNER JOIN Customers Customers
		 ON  Orders.CustomerID = Customers.CustomerID
%sql%

defn.startDate = year(startDate) + "-" + month(startDate) + "-" + day(startDate)
defn.endDate = year(endDate) + "-" + month(endDate) + "-" + day(endDate)
defn.eventDate = "orderDate"
defn.eventId = "orderId"
defn.eventName = "eventName"
defn.eventDescription = "eventdescription"  

jsonData = a5_GetCalendarEventDataJSON(defn)
dim js as c  = ""

js = js + "var _cal = {dialog.object}.getControl('DT1');" + crlf()
js = js + "_cal._data = " + jsonData + ";" + crlf()
js = js + "_cal.refresh();" 
getEvents = js 

end function ]]></example>
                  <figure><link>images/de19.png</link></figure>
                 
              </step>
              
          </steps>
          
          
      </section>
      <section>
        <title>Run the Component</title>
     
            <description>Run the component in Live Preview. The events from the SQL Table should be displayed 
              in the calendar on the day when they occurred.
            </description>
            <figure><link>images/de20.png</link></figure>
         
      </section>
      
      
      
      
       <section>
           <title>Line by Line Javascript Explanation</title>
       
         
          
          
      </section>
      <section>
        <description>*[Handling Days in the Calendar with More than One Event]*</description>
         
          
      </section>
        <section>
          <description>*[Creating the Pop-up Window to Display Each Event]*</description>
         
          
          
      </section>
        <section>
          <description>*[The GetCalendarEventDataJSON() Function]*</description>
         
          
      </section>
  
  </sections>

<links>
     <link href="http://www.ajaxvideotutorials.com/V11Videos/DialogCalendar_DisplayingEvents1.swf">Part 1</link>
    <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_1.swf">Part 2</link>
    <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_2.swf">Part 3</link>
    <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_3.swf">Part 4</link>
    <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_4.swf">Part 5</link>
      <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_5.swf">Part 6</link>
        <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_6.swf">Part 7</link>
  
    <link link="UX Properties Other Properties">Other Properties</link>
    <link link="ux properties date format">Date format</link>
    
</links>
</page>