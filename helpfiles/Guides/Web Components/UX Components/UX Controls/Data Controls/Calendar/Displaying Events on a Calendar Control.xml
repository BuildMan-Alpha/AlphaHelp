<page>
    <shortlink>ux data controls calendar property displaying events on a calendar control</shortlink>
    <topic>Displaying Events on a Calendar Control</topic>
    <description>You can customize the calendar control to display events drawn from an SQL 
      database. 
    </description>
  <sections>
     
      <section>
          <description>One way to accomplish this is through an ajax callback. The ajax callback is executed everytime a 
            user navigates to a new month and contains a 
            query against the 'Orders' table in the 'Northwind' database. This query gets 
            a list of the orders that occurred on each day in each month. In order to display the results of this 
            query on the calendar some adjustments to the default calendar settings must also be changed. 
            The boxes for each day need to be enlarged so that this data can be displayed on the 
      calendar on the day that the event occurred. 
            
            
            For a visual explanation on how to do this watch this seven part video: [Part 1]
              [Part 2], [Part 3], [Part 4], [Part 5], [Part 6], [Part 7],  or read the guide below.
          </description>
          
      </section>
      
       <section>
        <title>Set the UX Properties</title>
        <steps>
          <step>
            <description>In the UX Builder's UX Properties page scroll down to the 'CSS/SVG' section. 
              Click the [...] button next to the 'Local CSS definitions' property.
            </description>
            <figure><link>images/de25.png</link></figure>
          </step>
      <step>
        <description>In the 'CSS Editor - []' open the 'Code' tab at the bottom of the editor.</description>
         <figure><link>images/de26.png</link></figure>
      </step>
       <step>
        <description>Add the following definition for a 'hiddenItems' css class and click OK.</description>
        <example><![CDATA[.hiddenItem {display: none;}]]></example>
         <figure><link>images/de27.png</link></figure>
         <note>This css class prevents the dates from previous or later months being displayed on the calendar. 
           For example, if you were looking at the month of August, then the last day of July and the first 
           day of September would not be displayed. This is different from the default setting, 
           which is to number the days of other months but have them appear disabled; using the disabled css class. 
           The .hiddenItem class is called in the calendar's 'Date item out of range class name' property. 
         </note>
      </step>
      
      
      
      
          <step>
           <description>Scroll down to the 'Other' section on the Properties list. 
             Find the 'Date format' property and set it to be 'MM/dd/yyyy'.
            </description>
               <figure><link>images/de2.png</link></figure>
          </step>
          
          
        </steps>
        
      </section>
      <section>
          <title>Customize the Layout of the Calendar.</title>
          <steps>
              <step>
                  <description>In the UX Builder on the UX Controls page open the 'Data Controls' menu. Click 
                      on the [Calendar] option to add a calendar control to the component. Give the calendar the name 
                      'dt1'.
                  </description>
                  <figure><link>images/de3.png</link></figure>
              </step>
              <step>
                  <description>Highlight the calendar control in the controls tree. In the properties list on the right 
                    go to the 'Field Properties' section and set the 'Default value' property to '8/1/1994'. Most of the events 
                    listed in the northwinds SQL table that will be used for this example are from 1994.
                  </description>
                  <figure><link>images/de4.png</link></figure>
              </step>
              <step>
                <description>Go to the 'Date/Time Picker Properties' section. Check the 'Draw boxes around dates' 
                      checkbox property.</description>
                <figure><link>images/de5.png</link></figure>
              </step>
              <step>
                  <description>Set the 'Date item hover class name' property to be 'None' by writing 
                      'None' next to the property.
                  </description>
                  <figure><link>images/de6.png</link></figure>
                  <note>This prevents a highlight from appearing when a user hovers over a date.</note>
              </step>
              <step>
                  <description>Set the 'Date item selected class name' property to be 'None' by writing 
                      'None' next to this property as well.</description>
                  <figure><link>images/de7.png</link></figure>
                  <note>This prevents a highlight from occuring when a user selects a date.</note>
              </step>
              <step>
                  <description>Set the 'Date item out of range class name' property to be 'hiddenItem'.</description>
                  <figure><link>images/de8.png</link></figure>
              </step>
              <step>
                  <description>Click the [...] button next to the 'Date item style' property.</description>
                  <figure><link>images/de9.png</link></figure>
              </step>
              <step>
                  <description>Scroll down to the 'Positioning and Size' section of the Style Editor. Set the 'Width' 
                      and 'Height' properties to be "1.5in". Click OK.
                  </description>
                  <figure><link>images/de10.png</link></figure>
                  <note>This setting increases the size of each day's box inside the calendar.</note>
              </step>
              <step>
                  <description>In the calendar's 'Date/Time Picker Properties' section check 
                      the 'Has events' property </description>
                  <figure><link>images/de11.png</link></figure>
              </step>
               <step>
                  <description>Click the '+' button next to the 'Has events' property 
                      to expand the events list. Next to the onItemDraw event write 'calendarDrawItem'.</description>
                  <figure><link>images/de12.png</link></figure>
                  <note>Every time an item is drawn this javascript function is called. An 'item' here refers 
                    to a given day in a month.
                  </note>
              </step>
               <step>
                  <description>Next to the 'onMonthNavigate' event write 'calendarMonthNavigate'.</description>
                  <figure><link>images/de13.png</link></figure>
                  <note>This calls a javascript function that draws the events everytime you navigate to a new month.</note>
              </step>
              <step>
                  <description>Expand the 'Events' menu and click on the 'Client-side' events page. In the 'Client-Side Events' 
                    list highlight the 'onRenderComplete' event.
                  </description>
                  <figure><link>images/de14.png</link></figure>
              </step>
               <step>
                  <description>Add the following function call to the 'onRenderComplete' event.</description>
                  <example><![CDATA[calendarMonthNavigate();]]></example>
                  <figure><link>images/de15.png</link></figure>
              </step>
              
              
          </steps>
          
          
      </section>
     <section>
       <title>Create a Connection to the AADemo-Northwind database</title>
       <steps>
         <step>
           <description>In the main toolbar click on the 'SQL' button and select the 'AlphaDAO Connection Strings' 
             option.
           </description>
           <figure><link>images/de21.png</link></figure>
         </step>
          <step>
           <description>Click the "Create 'AADemo-Northwind' demo connection string" hyperlink.</description>
           <figure><link>images/de22.png</link></figure>
         </step>
          <step>
           <description>Select the 'Microsoft Access Database Engine' radio button option at the bottom 
             of the page. Click the "OK - Create a named connection string called 'AADemo-Northwind'" option. 
             Click OK again.
           </description>
           <figure><link>images/de23.png</link></figure>
         </step>
          <step>
           <description>Click 'Close'.</description>
           <figure><link>images/de24.png</link></figure>
         </step>
         
         
       </steps>
       
     </section>
      
       <section>
          <title>Add Javascript Definitions</title>
          <steps>
            <step>
              <description>In the UX Builder's main menu on the left expand the 'Code' menu. Click to 
                open the "Javascript functions" page</description>
               <figure><link>images/de16.png</link></figure>
            </step>
              <step>
                  <description>Add the following javascript function definitions to the 'Javascript functions' page.</description>
                  <example><![CDATA[function calendarDrawItem(ele,date,type) {
	var curObj = {dialog.object}.getControl('DT1');
	var calData = curObj._data;
	
	if(typeof curObj._menuItems == 'undefined') {
		curObj._menuItems = {};
	}
	if(type == 'date') {
		if(typeof calData != 'undefined') {
			var dateStr = date.getFullYear() + '-' +(date.getMonth() + 1) + '-' + date.getDate();
			if(typeof calData[dateStr] != 'undefined') {
				var tempData = calData[dateStr];
				var maxItemsToShow = 1
				if(tempData.length > maxItemsToShow ) {
					var windowContent = '';
					var menuItems = [];
					for(var i = 0; i < tempData.length; i++) {
						menuItems.push({
							html: '<span title="'+tempData[i].detail+'">' + tempData[i].name + '</span>',
							onClick: Function('editEvent(\'' + tempData[i].id + '\')')
						});
					}	
					curObj._menuItems[dateStr] = menuItems;
					ele.innerHTML = ele.innerHTML + '<br><span onmouseover="showEventList(this,\''+dateStr+'\');">Multiple... (' + tempData.length + ')</span>';
				} else {
					for(var i = 0; i < tempData.length; i++) {
						ele.innerHTML = ele.innerHTML + '<br>' + '<a class="{dialog.style}Link" href="#" title="'+tempData[i].detail+'" onclick="editEvent(\''+tempData[i].id+'\');$e.stopEvent(event); return false;">' +tempData[i].name +'</a>' ;
					}		
				}
			}
		}
	}
}

function calendarMonthNavigate(date) {
	var calObj = {dialog.object}.getControl('DT1');

	delete calObj._menuItems;
	var menuName = '_CalendarDetailsMenu';
	if(typeof calObj[menuName] != 'undefined') {	
		calObj[menuName].hide();
	}
	var data = '_month=' + (calObj._dp._month+1) + '&_year=' +  calObj._dp._year;
	{grid.Object}.ajaxCallback('G','','getEvents','',data);
}

function editEvent(id) {
	alert('Display Order:' + id );
}

function showEventList(objEle, dateStr) {
	var menuName = '_CalendarDetailsMenu';
	var curObj = {dialog.object}.getControl('DT1');
	if(typeof curObj[menuName] == 'undefined') {
		curObj[menuName] = new A5.Menu([],{
			theme: '{dialog.style}',
			iconColumn: {show: false}
		});
	}
	
	curObj[menuName].populate(curObj._menuItems[dateStr]);
	curObj[menuName].show('popup',objEle);
}
]]></example>
                  <figure><link>images/de17.png</link></figure>
              </step>
              
          </steps>
          
          
      </section>
       <section>
          <title>Add Xbasic Definitions</title>
          <steps>
            <step>
              <description>In the 'Code' menu click to open the 'Xbasic functions' page.</description>
              <figure><link>images/de18.png</link></figure>
            </step>
              <step>
                  <description>In the Xbasic functions page add the following Xbasic function definitions.</description>
                  <example><![CDATA[function getEvents as c (e as p)
dim month as c 
dim year as c 
dim startDate as d 
dim endDate as d 

startDate = date_value(val(e._year),val(e._month),1)
if val(e._month) < 12 then 
	endDate = date_value(val(e._year),val(e._month)+1,1) -1
else
	endDate = date_value(val(e._year)+1,1,1) -1
end if 

dim jsonData as c 
dim def as p
dim defn as p
defn.type = "sql"
defn.connectionString = "::Name::AADemo-Northwind"
defn.tableName = <<%sql%
SELECT Orders.OrderID as OrderId, 
	concatenate(orders.orderid,': ', customers.companyname) as eventName, 
	Orders.OrderDate as orderDate, 
	concatenate('Order: ', orders.orderid, ': ', customers.contactname, ' ', customers.companyname)  AS eventdescription 
FROM Orders Orders
	 INNER JOIN Customers Customers
		 ON  Orders.CustomerID = Customers.CustomerID
%sql%

defn.startDate = year(startDate) + "-" + month(startDate) + "-" + day(startDate)
defn.endDate = year(endDate) + "-" + month(endDate) + "-" + day(endDate)
defn.eventDate = "orderDate"
defn.eventId = "orderId"
defn.eventName = "eventName"
defn.eventDescription = "eventdescription"  

jsonData = a5_GetCalendarEventDataJSON(defn)
dim js as c  = ""

js = js + "var _cal = {dialog.object}.getControl('DT1');" + crlf()
js = js + "_cal._data = " + jsonData + ";" + crlf()
js = js + "_cal.refresh();" 
getEvents = js 

end function]]></example>
                  <figure><link>images/de19.png</link></figure>
                 
              </step>
              
          </steps>
          
          
      </section>
      <section>
        <title>Run the Component</title>
     
            <description>Run the component in Live Preview. The events from the SQL Table should be displayed 
              in the calendar on the day when they occurred.
            </description>
            <figure><link>images/de20.png</link></figure>
         
      </section>
      
      
      
      
       <section>
           <title>Line by Line Javascript Explanation</title>
       <description>In the Calendars 'Has events' properties two events were defined. These were the onItemDraw event, that 
         was tied to the calendarDrawItem() function, and the onMonthNavigate event, that was tied to the calendarMonthNavigate(). 
         
         </description>
         
          
          
      </section>
      <section>
        <description>*[calendarMonthNavigate()]*</description>
        <example><![CDATA[function calendarMonthNavigate(date) {
	var calObj = {dialog.object}.getControl('DT1');

	delete calObj._menuItems;
	var menuName = '_CalendarDetailsMenu';
	if(typeof calObj[menuName] != 'undefined') {	
		calObj[menuName].hide();
	}
	var data = '_month=' + (calObj._dp._month+1) + '&_year=' +  calObj._dp._year;
	{grid.Object}.ajaxCallback('G','','getEvents','',data);
}]]></example>
        
        
      </section>
      <section>
      <description>The first thing that this function does is to get a pointer to the calendar control.
        This is done using the dialog objects getControl() method. The method takes as an argument the 
        variable name of the calendar control, 'dt1'. This pointer is then assigned to a variable named 'calObj'
      </description>
      <example><![CDATA[var calObj = {dialog.object}.getControl('DT1');]]></example>
      </section>
      <section>
        <description>An if statement then handles the logic that will shut down any pop-up 
          windows that occur in situations where a calendar has more than one event displayed. The 
          pop-up will close when you navigate to a new month.
        </description>
        <example><![CDATA[delete calObj._menuItems;
	var menuName = '_CalendarDetailsMenu';
	if(typeof calObj[menuName] != 'undefined') {	
		calObj[menuName].hide();
	}]]></example>
        
      </section>
      <section>
        <description>A variable named 'data' gets the year and the month that the user navigated to.
          This information is stored in the calendar control's _dp._month and _dp._year properties. 
          The 'data' javascript variable is constructed in the form of a query string. First the variable 
          gets the month value, '_month=', by using the pointer to the calendar control defined earlier, 
          'calObj', to find the _dp._month value. 
          Because the month array is zero based, '+1' must be added to the end of the query in order to get the 
          correct month. After finding which month the user entered the query then finds 
          the year that the user entered.</description>
        <example><![CDATA[var data = '_month=' + (calObj._dp._month+1) + '&_year=' +  calObj._dp._year;
	]]></example>
      </section>
      <section>
        <description> When a user navigates to a new month an Ajax callback is made. This 
          ajax callback calls an Xbasic function called 'getEvents' as well as the 'data' variable.</description>
        <example><![CDATA[{grid.Object}.ajaxCallback('G','','getEvents','',data);]]></example>
        
      </section>
      
      <section>
        <description>*[Handling Days in the Calendar with More than One Event]*</description>
         
          
      </section>
        <section>
          <description>*[Creating the Pop-up Window to Display Each Event]*</description>
         
          
          
      </section>
        <section>
          <description>*[The GetCalendarEventDataJSON() Function]*</description>
         
          
      </section>
  <section>
    <title>Line by Line Xbasic</title>
     
    
    
  </section>
  <section>
    <description>*[getEvents]*</description>
    <example><![CDATA[function getEvents as c (e as p)
dim month as c 
dim year as c 
dim startDate as d 
dim endDate as d 

startDate = date_value(val(e._year),val(e._month),1)
if val(e._month) < 12 then 
	endDate = date_value(val(e._year),val(e._month)+1,1) -1
else
	endDate = date_value(val(e._year)+1,1,1) -1
end if 

dim jsonData as c 
dim def as p
dim defn as p
defn.type = "sql"
defn.connectionString = "::Name::AADemo-Northwind"
defn.tableName = <<%sql%
SELECT Orders.OrderID as OrderId, 
	concatenate(orders.orderid,': ', customers.companyname) as eventName, 
	Orders.OrderDate as orderDate, 
	concatenate('Order: ', orders.orderid, ': ', customers.contactname, ' ', customers.companyname)  AS eventdescription 
FROM Orders Orders
	 INNER JOIN Customers Customers
		 ON  Orders.CustomerID = Customers.CustomerID
%sql%

defn.startDate = year(startDate) + "-" + month(startDate) + "-" + day(startDate)
defn.endDate = year(endDate) + "-" + month(endDate) + "-" + day(endDate)
defn.eventDate = "orderDate"
defn.eventId = "orderId"
defn.eventName = "eventName"
defn.eventDescription = "eventdescription"  

jsonData = a5_GetCalendarEventDataJSON(defn)
dim js as c  = ""

js = js + "var _cal = {dialog.object}.getControl('DT1');" + crlf()
js = js + "_cal._data = " + jsonData + ";" + crlf()
js = js + "_cal.refresh();" 
getEvents = js 

end function]]></example>
  </section>
  <section>
    <description>The values for e._year and e._month are passed into the getEvents() function. 
      These are the variables that were sent back in the ajax callback created at the end of the 
      calendarMonthNavigate() function, on the Javascript functions page. 
      
      Inside the getEvents() function these values are converted into a date value using 
      the Xbasic date_value() expression. The converted values are used to create both a start date, 
      'startDate', and an end date, 'endDate'. These dates represent the start date and end date of the 
      month that contains the events that we want to display on the calendar.
      
      
    </description>
    <example><![CDATA[dim month as c 
dim year as c 
dim startDate as d 
dim endDate as d 

startDate = date_value(val(e._year),val(e._month),1)
if val(e._month) < 12 then 
	endDate = date_value(val(e._year),val(e._month)+1,1) -1
else
	endDate = date_value(val(e._year)+1,1,1) -1
end if ]]></example>
    
  </section>
  <section>
    <description>Next a SQL statement joins the 'OrderId' and 'Customer' table from the Northwinds database 
      together. The built in function a5_GetCalendarEventDataJSON() is then called in order to help retrieve 
      the data.
    </description>
     <example><![CDATA[dim jsonData as c 
dim def as p
dim defn as p
defn.type = "sql"
defn.connectionString = "::Name::AADemo-Northwind"
defn.tableName = <<%sql%
SELECT Orders.OrderID as OrderId, 
	concatenate(orders.orderid,': ', customers.companyname) as eventName, 
	Orders.OrderDate as orderDate, 
	concatenate('Order: ', orders.orderid, ': ', customers.contactname, ' ', customers.companyname)  AS eventdescription 
FROM Orders Orders
	 INNER JOIN Customers Customers
		 ON  Orders.CustomerID = Customers.CustomerID
%sql%

defn.startDate = year(startDate) + "-" + month(startDate) + "-" + day(startDate)
defn.endDate = year(endDate) + "-" + month(endDate) + "-" + day(endDate)
defn.eventDate = "orderDate"
defn.eventId = "orderId"
defn.eventName = "eventName"
defn.eventDescription = "eventdescription"  

jsonData = a5_GetCalendarEventDataJSON(defn)]]></example>
     
     
  </section>
  
  
  </sections>

<links>
     <link href="http://www.ajaxvideotutorials.com/V11Videos/DialogCalendar_DisplayingEvents1.swf">Part 1</link>
    <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_1.swf">Part 2</link>
    <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_2.swf">Part 3</link>
    <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_3.swf">Part 4</link>
    <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_4.swf">Part 5</link>
      <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_5.swf">Part 6</link>
        <link href="http://www.ajaxvideotutorials.com/V11Videos/dialogCalendar_behindscenes_6.swf">Part 7</link>
  
    <link link="UX Properties Other Properties">Other Properties</link>
    <link link="ux properties date format">Date format</link>
    
</links>
</page>