
<html>

<head></head>

<body>

<h1>Node.JS</h1>

			Node.JS is a popular 
						program for writing server side utilities in Javascript. 
						Alpha Anywhere now has tight integration with Node and 
						you can now define your own Node modules that can be 
						called from Xbasic.</p>
		<p>
						<a href="http://www.ajaxvideotutorials.com/V12Videos/xbasic_nodeServices_1.swf">
						Watch Video - Part 1</a><br>
						<a href="http://www.ajaxvideotutorials.com/V12Videos/xbasic_nodeServices_2.swf">
						Watch Video - Part 2</a><br>
						<a href="http://www.ajaxvideotutorials.com/V12Videos/xbasic_nodeServices_3.swf">
						Watch Video - Part 3</a></p>
		<p>
						To create a new 'Node Service' that can be called from 
						Xbaisc, you create a new .js file in the Node_Services 
						folder in the Alpha Anywhere executable folder. The 
						syntax for this .js file is the syntax you would use for 
						any Node module.</p>
		<p>
						To call a Node service from Xbasic, you:</p>
		<ul style="font-family: Tahoma; width: 7in; font-size: 9pt; margin-left: .5in; margin-top: 0px; margin-bottom: 5px">
			<li style="font-family: Tahoma; width: 7in; font-size: 9pt; margin-left: .5in; margin-top: 0px; margin-bottom: 5px">
			dim an instances of the helper::V8 object</li>
			<li style="font-family: Tahoma; width: 7in; font-size: 9pt; margin-left: .5in; margin-top: 0px; margin-bottom: 5px">
			construct a JSON string that defines the Node service you want to 
			call and the parameters you wan to pass to the Node service</li>
			<li style="font-family: Tahoma; width: 7in; font-size: 9pt; margin-left: .5in; margin-top: 0px; margin-bottom: 5px">
			call the .NodeRequest() method of the helper::V8 object instance</li>
		</ul>
		<p>&nbsp;</p>
		<p>In the following example, we have defined a trivial Node service that 
		takes as its input two variables, 'firstname' and 'lastname' and sends 
		back a string showing: <font color="#0000FF" face="Courier New">Hello 
		firstname lastname</font>.</p>
		<p>The Node service in this example is called 'hello'. Therefore the 
		'_command' property of the JSON command object is set to 'hello'</p>
		<p>You must also set an '_id' property in the JSON command object. This 
		can be any value. Using a UUID for this value is convenient.</p>
		<p>The Node service is called using the .NodeRequest() method and the 
		result is returned as a JSON string with properties for the error text 
		(if there was an error) and 'result' - the result of the request. The 
		JSON response can be parsed to get Xbasic varibles, or the json_extract() 
		function can be used to extract the 'result' property.</p>
		<p>
						&nbsp;</p>
		<p>
						&nbsp;</p>
		<p>
						&nbsp;</p>
		<p class="xbasicSmall">
						dim n as helper::V8<br>
						dim p as p</p>
		<p class="xbasicSmall">
						'generate an id for the request we are about to send to 
						Node.</p>
		<p class="xbasicSmall">
						'we just use a GUID for convenience<br>
						p._id = api_uuidcreate()</p>
		<p class="xbasicSmall">
						&nbsp;</p>
		<p class="xbasicSmall">
						'set the _command property. This is the name of the Node 
						service we want to call<br>
						p._command = "hello"<br>
&nbsp;</p>
		<p class="xbasicSmall">
						&nbsp;</p>
		<p class="xbasicSmall">
						'specify any variables you want to pass to the Node 
						service</p>
		<p class="xbasicSmall">
						p.firstname = "Nellie"<br>
						p.lastname = "Jones"<br>
&nbsp;</p>
		<p class="xbasicSmall">
						'convert the Xbasic .dot variable to a JSON string.</p>
		<p class="xbasicSmall">
						dim jsonCommand as c </p>
		<p class="xbasicSmall">
						jsonCommand = json_generate(p)</p>
		<p class="xbasicSmall">
						<br>
						?n.NodeRequest(jsonCommand)<br>
						= {"_id":"id1","error":"","result":"Hello Nellie Joness"}<br>
&nbsp;</p>
		<p>
						&nbsp;</p>
		<p>
						Here is how the corresponding Hello.js file is defined. 
						This file must be in the Node_Services folder in the 
						Alpha Anywhere executable folder. This is a standard 
						Node module. It can 'require' any other Node modules 
						that you have written, or that have been installed using 
						NPM (the Node Package Manager).</p>
		<p>
						&nbsp;</p>
		<p class="xbasicSmall">
						exports.handler = function(packet,response,sendResponse) 
						{<br>
&nbsp;&nbsp;&nbsp; var e;<br>
&nbsp;&nbsp;&nbsp; var attachments = null;</p>
		<p class="xbasicSmall">
						&nbsp;&nbsp;&nbsp; var msg = 'Hello ' + packet.firstname 
						+ ' ' + packet.lastname;<br>
&nbsp;&nbsp;&nbsp; response.result = msg;</p>
		<p class="xbasicSmall">
						&nbsp;&nbsp;&nbsp; sendResponse(response,attachments);<br>
						};<br>
&nbsp;</p>
		<p>
						&nbsp;</p>
		<p>
						If you edit the .js file in the Node_Services folder 
						after having called it, your edits will not be seen 
						until you shutdown the Node service. The next time you 
						call the Node service you will see a short delay as Node 
						starts up.</p>
		<p>
						To shut down the Node service you can all the .NodeShutDown() 
						method on the helper::V8 object instance. For example, 
						in the above example the helper::V8 object instance was 
						called 'n', so the following command will shut Node 
						down.</p>
		<p>
						&nbsp;</p>
		<p class="xbasicSmall">
						n.NodeShutdown()</p>
		<p class="xbasicSmall">
						&nbsp;</p>
		<p class="note">
						<b>NOTE</b>: Node.exe is automatically installed in the 
						Alpha Anywhere executable folder when you install Node. 
						You do not need to install Node yourself.</p>