	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<p class=A3Topic>Creating a Custom Grid Control</p>



<p>A custom control allows you to fully define the content of a grid cell. 
 The content is produced by a function that typically processes a combination 
 of Xbasic and HTML code. Other than the requirement that the function 
 return valid HTML, there are no other important constraints upon what 
 the grid cell can display.</p>



<p class=Note><span class=Note><img src="images/icon_information.gif"
									x-maintain-ratio=TRUE
									style="border: none;
											width: 36px;
											height: 32px;
											float: none;
											border-style: none;
											border-style: none;"
									width=36
									height=32
									border=0>Note</span> : Custom controls 
 cannot be used for data entry to bound table fields.</p>



<p>To create a custom control:</p>



<ol>
	
	<li class=kadov-p-CListNumber><p class=ListNumber>Display the <span 
 class=Screen>Grid Fields</span> page of the <span class=Screen>Grid Builder</span>.</p>

</li>
	
	<li class=kadov-p-CListNumber><p class=ListNumber>Select the control 
 that you want to modify in the <span class=Control>Selected Fields</span> 
 list.</p>

</li>
	
	<li class=kadov-p-CListNumber><p class=ListNumber>Change its <span 
 class=Button>Display Settings > Control Type</span> to "Custom".</p>

</li>
	
	<li class=kadov-p-CListNumber><p class=ListNumber>Click the <img src="images/Web_Properties_button.gif"
	x-maintain-ratio=TRUE
	style="border: none;
			float: none;
			width: 17px;
			height: 18px;
			border-style: none;
			border-style: none;"
	width=17
	height=18
	border=0> button in the <span class=Button>Custom Control Properties 
 > Definition</span> field to display the <span class=Screen>Define 
 Xbasic for Custom Control</span> dialog. This dialog allows you to define 
 the code that produces the return value of a function. The function is 
 named <span class=Code1>fieldname_render()</span>, where <span class=Code1>fieldname</span> 
 is the name of your field.</p>

</li>
</ol>

<p><img src="images/icon_information.gif"
		x-maintain-ratio=TRUE
		style="border: none;
				width: 36px;
				height: 32px;
				float: none;
				border-style: none;
				border-style: none;"
		width=36
		height=32
		border=0>The function will return a value that is composed of <span 
 class=Bolded>quoted HTML</span> and <span class=Bolded>unquoted Xbasic</span>.</p>



<p class=A5><a name=Variables>Variables</a></p>



<p>You may dimension local variables of any type within the <span class=Code1>fieldname_render()</span> 
 function. However, if you want to create variables that have scope beyond 
 the current grid cell, you must define it&nbsp;as&nbsp;an element of either 
 the:</p>



<ul style="list-style: disc;"
	type=disc>
	
	<li class=kadov-p-CBullet1><p class=Bullet1><span class=Code1>args</span> 
 pointer (valid for the grid page)</p>

</li>
	
	<li class=kadov-p-CBullet1><p class=Bullet1><span class=Code1>session</span> 
 pointer (valid for the session)</p>

</li>
</ul>

<p>For example, this code is able to create a running total of the <span 
 class=Code1>Extension</span> field by adding values to <span class=Code1>session.rt</span>.</p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;" valign="top">
<td style="x-cell-content-align: top;
			width: 100%;
			padding-right: 10px;
			padding-left: 10px;" valign="top" width="100%">
<p class=Code>if eval_valid(" session.rt") = .f. then</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;session.rt = Data.EXTENSION</p>


<p class=Code>else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;session.rt = <span class=Code1>session.rt 
 + Data.EXTENSION</span></p>


<p class=Code>end if</td></tr>
</table>

<p class=A5><a name=Current_Row_Values>Current Row Values</a></p>



<p>At any time you can insert the value of any of the fields in the current 
 row into the code by clicking <span class=Button>Insert > Data > 
 FieldName</span>. </p>



<p class=Pix><img src="images/WP_Custom_Control_Data_1.gif"
					x-maintain-ratio=TRUE
					style="border: none;
							width: 633px;
							height: 118px;
							float: none;
							border-style: none;
							border-style: none;"
					width=633
					height=118
					border=0></p>



<p class=A5><a name=Grid_Data_Values>Grid Data Values</a></p>



<p>At any time you can insert the value of any of the fields on any of 
 the rows of the current grid page by clicking <span class=Button>Insert 
 > Args > Data > RowNumber > FieldName</span>. </p>



<p class=Pix><img src="images/WP_Custom_Control_Data_4.gif"
					x-maintain-ratio=TRUE
					style="border: none;
							width: 633px;
							height: 305px;
							float: none;
							border-style: none;
							border-style: none;"
					width=633
					height=305
					border=0></p>



<p class=A5><a name=Summary_Values>Summary Values</a></p>



<p>If the grid has any summary fields, then you can insert any of them 
 by clicking <span class=Button>Insert > Args > Summary > FieldName 
 > SummaryType</span>. </p>



<p class=Pix><img src="images/WP_Custom_Control_Data_2.gif"
					x-maintain-ratio=TRUE
					style="border: none;
							width: 633px;
							height: 169px;
							float: none;
							border-style: none;
							border-style: none;"
					width=633
					height=169
					border=0></p>



<p class=A5><a name=System_Variables>System Variables</a></p>



<p>The <span class=Screen>Define Xbasic for Custom Control</span> dialog 
 provides several system variables that you can use in your calculations. 
 </p>




<div align=center>
<table style="x-cell-content-align: top;
				float: aligncenter;
				border-left-style: none;
				border-right-style: none;
				border-top-style: none;
				border-bottom-style: none;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0">
<col>
<col>
<col>

<tr style="x-cell-content-align: top;" valign="top">
<td class="tableHeader" style="x-cell-content-align: top;" valign="top">
<p class=TableHead>Name</td>
<td class="tableHeader" style="x-cell-content-align: top;" valign="top">
<p class=TableHeadCenter>Type</td>
<td class="tableHeader" style="x-cell-content-align: top;" valign="top">
<p class=TableHead>Description</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.Info.TotalPages</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">
<p class=TableCenter>N</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">The number of grid pages required to display all records.</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.Info.CurrentPage</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">
<p class=TableCenter>N</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">The current grid page.</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.Info.TotalRecords</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">
<p class=TableCenter>N</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">The number of records returned by the current table query.</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.Info.RecordsPerPage</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">
<p class=TableCenter>N</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">The maximum number of records to display in a grid page.</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.Info.Database_type</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">
<p class=TableCenter>C</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">The type of database.</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.Info.HasEmptyRows</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">
<p class=TableCenter>L</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Does the current grid page have an empty row?</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.FirstEmptyRow</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">
<p class=TableCenter>N</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">The row number of the first empty row.</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.IsNewRecord</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">
<p class=TableCenter>L</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Are you processing a newly input record?</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.RowNumber</td>
<td class="TableCell" style="x-cell-content-align: top;
			border-right-style: Solid;
			border-bottom-style: Solid;
			border-right-width: 1px;
			border-bottom-width: 1px;" valign="top">
<p class=TableCenter>N</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">The current row number.</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" style="x-cell-content-align: top;" valign="top">Args.Summary</td>
<td class="TableCell" style="x-cell-content-align: top;
			border-right-style: Solid;
			border-bottom-style: Solid;
			border-right-width: 1px;
			border-bottom-width: 1px;" valign="top">
<p class=TableCenter>P</td>
<td class="TableCell" style="x-cell-content-align: top;" valign="top">The values of various summary calculations.</td></tr>
</table>
</div>
<p class=Pix><img src="images/WP_Custom_Control_Data_3.gif"
					x-maintain-ratio=TRUE
					style="border: none;
							width: 633px;
							height: 217px;
							float: none;
							border-style: none;
							border-style: none;"
					width=633
					height=217
					border=0></p>



<p class=A5><a name=A_Custom_Control_Example>A Custom Control Example</a></p>



<p>A custom control where Xbasic dynamically sets font and background properties, 
 depending on whether the quantity value is above or below the average. 
 </p>



<p class=Pix><img src="images/WP_Custom_Control.gif"
					x-maintain-ratio=TRUE
					style="border: none;
							width: 336px;
							height: 322px;
							float: none;
							border-style: none;
							border-style: none;"
					width=336
					height=322
					border=0></p>



<p>In the following example, the field name is <span class=Code1>Quantity</span>.&nbsp;as&nbsp;a 
 result, the function is named <span class=Code1>Quantity_Render()</span>.</p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;" valign="top">
<td style="x-cell-content-align: top;
			width: 100%;
			padding-right: 10px;
			padding-left: 10px;" valign="top" width="100%">
<p class=Code>function QUANTITY_render&nbsp;as&nbsp;c (data&nbsp;as&nbsp;p, 
 args&nbsp;as&nbsp;p, session&nbsp;as&nbsp;p)</p>


<p class=Code>on error goto xbasicError</p>


<p class=Code>if data.quantity < (.5 * args.summary.quantity.average) 
 then</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;QUANTITY_render = <<%html%</p>


<p class=Code><div style="color: #ffffff; text-align: center; background-color:#ff0000;font-weight:bold;">%html% 
 + data.quantity + "</div>"</p>


<p class=Code>else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if data.quantity > (1.5 * args.summary.quantity.average) 
 then</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QUANTITY_render 
 = <<%html%</p>


<p class=Code><div style="color: #000000; text-align: center; background-color:#00ff00;font-weight:bold;">%html% 
 + data.quantity + "</div>"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QUANTITY_render 
 = <<%html%</p>


<p class=Code><div style="color: #000000; text-align: center; background-color:#ffff00;font-weight:bold;">%html% 
 + data.quantity + "</div>"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end if</p>


<p class=Code>end if</p>


<p class=Code>end</p>


<p class=Code>xbasicError:</p>


<p class=Code>QUANTITY_render = "Error in custom control xbasic: " 
 + error_text_get()</p>


<p class=Code>end function</td></tr>
</table>

<p>In this second example, the field is named <span class=Code1>ext2</span>. 
 It uses a session variable named <span class=Code1>session.rt</span> to 
 accumulate a running total.</p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;" valign="top">
<td style="x-cell-content-align: top;
			width: 100%;
			padding-right: 10px;
			padding-left: 10px;" valign="top" width="100%">
<p class=Code>function ext2_render&nbsp;as&nbsp;c (data&nbsp;as&nbsp;p, 
 args&nbsp;as&nbsp;p, session&nbsp;as&nbsp;p)</p>


<p class=Code>on error goto ext2_xbasicError</p>


<p class=Code>if eval_valid("session.rt") = .f. then</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;session.rt 
 = Data.EXTENSION</p>


<p class=Code>else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;session.rt 
 = session.rt + Data.EXTENSION</p>


<p class=Code>end if</p>


<p class=Code>html = "<div style=\"text-align:right\">" 
 + alltrim(str(session.rt, 250, 2, "$(") ) + "</div>"</p>


<p class=Code>ext2_render = html</p>


<p class=Code>end</p>


<p class=Code>ext2_xbasicError:</p>


<p class=Code>ext2_render = "Error in custom control xbasic: " 
 + error_text_get()</p>


<p class=Code>end function</td></tr>
</table>

<p>In this examples, the <span class=Code1>if</span> and <span class=Code1>else</span> 
 clauses have similar content. Both are character strings that combine 
 HTML coding and a reference to the <span class=Code1>quantity</span> field, 
 using the prefix " <span class=Code1>data.</span> ".</p>



<p>Although not a required technique, embedding the HTML inside the <span 
 class=HTML1><div> ... </div></span> tags simplifies the coding. 
 Likewise, embedding the <span class=HTML1><div></span> tag inside 
 the <span class=Code1><<%html% ... %html</span> string simplifies 
 the coding by removing the requirement to escape special characters.</p>



<p class=A5><a name=Using_a_Custom_Control_on_an_Updateable_Grid>Using 
 a Custom Control on an Updateable Grid</a></p>



<p>If you place a custom control on a grid with editable controls, the 
 function that creates the custom control must exit if you are creating 
 a new record. You would have something like this at the top of the function.</p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;" valign="top">
<td style="x-cell-content-align: top;
			width: 100%;
			padding-right: 10px;
			padding-left: 10px;" valign="top" width="100%">
<p class=Code>function MYFIELD_render&nbsp;as&nbsp;c (data&nbsp;as&nbsp;p, 
 args&nbsp;as&nbsp;p, PageVars&nbsp;as&nbsp;p)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;with 
 PageVars</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on 
 error goto MYFIELD_xbasicError</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
 Args.IsNewRecord = .t. then</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit 
 function</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>... continue with HTML definition</td></tr>
</table>

<p class=A5>See Also</p>



<p><a href="../../Unclassified/Setting Grid Control Properties.html" title="Setting Grid Control Properties" class="wiki">Setting Grid Control Properties</a></p>






<p class=A5>Limitations</p>



<p>Web publishing applications only; not for Ajax grids.</p>
	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:Creating+a+Custom+Grid+Control">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA: {"tags":"web","status":"pending","keywords":"server,design,guide,grid","group":"/Guide/Server/Design/View/Grid/"} --->
</body></html>