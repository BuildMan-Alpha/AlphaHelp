	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<h1 class="showhide_heading" id="Designing_an_Xbasic_Class">Designing an Xbasic Class</h1>
Designing a class well takes a certain amount of art and skill, but is not really that difficult. The basic steps are<br />
<ol><li>Research the problem
</li><li>Identify the objects of interest
</li><li>Identify any necessary specialization to determine the class hierarchy
</li><li>Identify the required member properties and methods
</li><li>Apply the principles of data hiding to assure the integrity of the class, and assign the proper permissions to the properties and methods
</li><li>Create test cases and record their desired outcomes
</li><li>Implement the methods so that the test cases work properly &mdash; <a href="/Server/Guide/Design/Platform/Xbasic/Implementing an Xbasic Class.html" title="Implementing an Xbasic Class V11" class="wiki">see the article on class implementation</a>
</li><li>Revisit any of the previous steps as needed to improve the class
</li></ol><h2 class="showhide_heading" id="Design_Example">Design Example</h2>
Suppose we want to write a class to call stored procedures in databases. This is actually a surprisingly complicated problem. (Aside: If you're familiar with Alpha Five's Portable SQL, you might wonder why a portable way to call stored procedures is not already included in that; it's on the list, but other things have taken higher priority.)<br />
<br />
Back to the problem. To call a stored procedure, you need to know what database you are using, and how stored procedures are called in that database. Alpha Five currently supports quite a few different database APIs, as it will tell you itself:<br />
<br />
<span style="color:blue; background:">dim Cn as SQL::Connection<br />
?cn.ListSupportedAPIs()<br />
= Access<br />
DB2<br />
EnterpriseDB<br />
Excel<br />
MySQL<br />
ODBC<br />
Oracle<br />
OracleLite<br />
Paradox<br />
PostgreSQL<br />
PostgresPlus<br />
QuickBooks<br />
QuickBooksOnline<br />
SQLServer</span><br />
<br />
There are actually more than are listed, because many different databases can be used through ODBC. That doesn't matter to us, though, because ODBC has a standard call mechanism.<br />
<br />
The SQL::Connection object is clearly something that will help us, as we just saw. That should be something our class knows about. We will need a way to pass a Connection object to our class, and it might be convenient to pass the connection string to our class and let it construct the Connection object itself.<br />
<br />
Do we need 14 subclasses, one for each different database API? It's one way to go. But there are only two keywords used to call stored procedures, <strong>CALL</strong> and <strong>EXEC</strong>. There's also a third case, databases that don't support stored procedures at all.<br />
<br />
So if we have a Run method in our class it should be able to figure out whether the current connection wants a <strong>CALL</strong> or <strong>EXEC</strong> keyword to invoke a stored procedure &mdash; or neither.<br />
<br />
We might eventually want to process runtime arguments passed as SQL::Argument objects and use them to construct the proper stored procedure syntax for each database, but let's not go there quite yet.<br />
<br />
So we probably need constructors that take connection strings and Connection objects, methods to set connections and Connection objects, and a Run method. What member properties do we need to support that? At a guess, a property to store the Connection object for the current class instance, and a string to hold the keyword that the Run method will use for constructing the correct SQL statement.<br />
<br />
What about data hiding? We don't want code outside our class to mess with the Connection object behind our backs, so let's make that a <strong>protected</strong> member. We also don't want code outside our class to <em>change</em> the Run keyword string, but it might be convenient if outside code could see what it is, so let's make that member <strong>public read protected write</strong>.<br />
<h2 class="showhide_heading" id="Test_Cases">Test Cases</h2>
<h3 class="showhide_heading" id="SQL_Server"> SQL Server</h3>
The standard Northwind sample for SQL Server includes 7 stored procedures. (These are not present in the Northwind sample for Access.) One of the stored procedures is SalesByCategory, which takes two parameters, @CategoryName and @OrdYear, and returns a resultset of ProductName and TotalPurchase for the given category and year.<br />
<br />
The T-SQL code for SalesByCategory is:<br />
<br />
<div class="plugincode" parse="sql"><pre class="codelisting" data-syntax="sql" dir="ltr" style="overflow:auto;" id="codebox" >ALTER PROCEDURE [dbo].[SalesByCategory]
    @CategoryName nvarchar[15]( @OrdYear nvarchar[4] ) &#39;1998&#39;
AS
IF @OrdYear !) &#39;1996&#39; AND @OrdYear !) &#39;1997&#39; AND @OrdYear !) &#39;1998&#39; 
BEGIN
  SELECT @OrdYear ) &#39;1998&#39;
END
&nbsp;
SELECT ProductName(
  TotalPurchase)ROUND[SUM[CONVERT[DECIMAL[14(2]( OD,Quantity ( [1)OD,Discount] ( OD,UnitPrice]]( 0]
FROM [ORDER Details] OD( Orders O( Products P( Categories C
WHERE OD,OrderID ) O,OrderID 
  AND OD,ProductID ) P,ProductID 
  AND P,CategoryID ) C,CategoryID
  AND C,CategoryName ) @CategoryName
  AND SUBSTRING[CONVERT[nvarchar[22]( O,OrderDate( 111]( 1( 4] ) @OrdYear
GROUP BY ProductName
ORDER BY ProductName</pre></div><br />
Using Microsoft SQL Server Management Studio, we can generate a test call to this stored procedure and see the answer returned. For @CategoryName = 'Produce' and @OrdYear = 1998, the generated query is<br />
<br />
<div class="plugincode" parse="sql"><pre class="codelisting" data-syntax="sql" dir="ltr" style="overflow:auto;" id="codebox1" >EXEC  @return_value ) [dbo],[SalesByCategory]
    @CategoryName ) N&#39;1998&#39;(
    @OrdYear ) 1998</pre></div><br />
The resultset returned is:<br />
<br />
<table class="wikitable"><tr><td class="wikicell" ><strong>ProductName</strong> </td><td class="wikicell" ><strong>TotalPurchase</strong> 
</td></tr><tr><td class="wikicell" >Longlife Tofu  </td><td class="wikicell" >400.00
</td></tr><tr><td class="wikicell" >Manjimup Dried Apples  </td><td class="wikicell" >11090.00
</td></tr><tr><td class="wikicell" >Rï¿½ssle Sauerkraut  </td><td class="wikicell" >6990.00
</td></tr><tr><td class="wikicell" >Tofu  </td><td class="wikicell" >371.00
</td></tr><tr><td class="wikicell" >Uncle Bob's Organic Dried Pears  </td><td class="wikicell" >12306.00</td></tr></table><br />
<h3 class="showhide_heading" id="MySQL">MySQL</h3>
The following basic MySQL stored procedure definition and call (see <a class="wiki external" target="_blank" href="http://oreilly.com/catalog/9780596100896" rel="external nofollow"><em>MySQL Stored Procedure Programming</em></a><img src="images/external_link.gif" alt="(external link)" width="15" height="14" title="(external link)" class="icon" /> by Guy Harrison with Steven Feuerstein) was entered and run in MySQL Workbench:<br />
<br />
<div class="plugincode" parse="sql"><pre class="codelisting" data-syntax="sql" dir="ltr" style="overflow:auto;" id="codebox2" >USE test;
&nbsp;
delimiter $$
DROP PROCEDURE IF EXISTS HelloWorld$$
CREATE PROCEDURE HelloWorld[]
BEGIN
    SELECT &#39;1998&#39;;
END $$
&nbsp;
CALL HelloWorld[]$$</pre></div><br />
It returns:<br />
<br />
<div class="plugincode" ><pre class="codelisting" data-syntax="" dir="ltr" style="overflow:auto;" id="codebox3" >Hello, World!</pre></div><br />
<h2 class="showhide_heading" id="See_also">See also</h2>
<a href="/Server/Guide/Design/Platform/Xbasic/Xbasic with Classes.html" title="Xbasic with Classes V11" class="wiki">Xbasic with Classes </a><br />
<a href="/Server/Guide/Design/Platform/Xbasic/Xbasic Class Syntax.html" title="Xbasic Class Syntax V11" class="wiki">Xbasic Class Syntax </a><br />
<a href="Designing an Xbasic Class.html" title="Designing an Xbasic Class V11" class="wiki">Designing an Xbasic Class </a><br />
<a href="/Server/Guide/Design/Platform/Xbasic/Implementing an Xbasic Class.html" title="Implementing an Xbasic Class V11" class="wiki">Implementing an Xbasic Class </a><br />
<a href="/Server/Guide/Design/Platform/Xbasic/Testing and Using an Xbasic Class V11.html" title="Testing and Using an Xbasic Class V11" class="wiki">Testing and Using an Xbasic Class </a><br />
<a href="/Server/Guide/Design/Platform/Xbasic/Subclasses and Inheritance.html" title="Subclasses and Inheritance V11" class="wiki">Subclasses and Inheritance </a><br />
<a href="/Server/Guide/Design/Platform/Xbasic/Classes in Namespaces.html" title="Classes in Namespaces V11" class="wiki">Classes in Namespaces </a><br />
<br />

	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:Designing+an+Xbasic+Class+V11">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA:{"tags":"desktop, review","status":"pending","notes":"funky symblols","keywords":"desktop,sql"}--->
</body></html>