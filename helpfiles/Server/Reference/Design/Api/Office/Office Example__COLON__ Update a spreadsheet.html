	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<h1 class="showhide_heading" id="Office_Example:_Update_a_spreadsheet">Office Example: Update a spreadsheet</h1>
This example demonstrates opening an existing spreadsheet and updating one or more values.<br />
<br />
First, we generate the same spreadsheet as seen in <a href="Office Example__COLON__ Simple Weekly sales spreadsheet.html" title="Office Example: Simple Weekly sales spreadsheet" class="wiki">the simple weekly sales sample</a>. Then we open the spreadsheet and update the Sales and Expense columns.<br />
<br />
After the spreadsheet is updated, it is opened in Microsoft Excel.<br />
<br />
<div class="plugincode" parse="vbnet"><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox" >dim ShowOriginalFile as L = .f.
dim FilePath as C = &#34;C:\temp\\&#34;
dim OriginalDocumentFile as C = FilePath + &#34;A5OfficeSample7_Original.xlsx&#34;
dim UpdatedDocumentFile   as C = FilePath + &#34;A5OfficeSample7_Updated.xlsx&#34;
dim Doc as Office::ExcelDocument  &#39; Declare the document variable
&nbsp;
&#39; Compute the date of the most recent Sunday
dim StartDate as D = date() - (dow(date()) - 1)
&nbsp;
&#39; Create the &#34;original&#34; version of the spreadsheet so we can do the update.
&#39; It will have all of the text and formats, but the data will be for a week ago Sunday.
CreateOriginalSpreadsheet(OriginalDocumentFile, ShowOriginalFile)
&nbsp;
&#39; Load the original file and update the daily totals.
if Doc.Load(OriginalDocumentFile)
&nbsp;
  UpdateDailyTotals(StartDate, Doc)
&nbsp;
  &#39; Save the updated document to a new file (could have been the same file,
  &#39;   but this script allows you to compare the two) and open it in Excel.
  if Doc.Save(UpdatedDocumentFile)
    &#39; Release all references to the document so we can open it in Excel
    delete Doc
    sys_open(UpdatedDocumentFile)
  else  
    ui_msg_box(&#34;Error Saving Updated Document&#34;, \
                           &#34;Unable to re-save document to &#34; \
                          + DocumentFile + &#34;:&#34; + crlf(2) + Doc.ErrorMessage)
  end if  
else
  ui_msg_box(&#34;Error Loading Original Document&#34;, \
                   &#34;Unable to load document to &#34; + DocumentFile \
                 + &#34;:&#34; + crlf(2) + Doc.ErrorMessage)
end if
&nbsp;
FUNCTION UpdateDailyTotals as L (StartDate as D, Doc as Office::ExcelDocument)
&nbsp;
dim SheetName  as C = &#34;:&#34;
&#39;(You could conceivably look for the first Row with Monday in the first column value)
dim StartRow as N = 6 
dim Sheet as Office::Spreadsheet
dim Sales   as N
dim Expenses  as N
&nbsp;
if .not. Doc.FindSheet(Sheet, SheetName)
  goto error_exit
end if
&nbsp;
Sheet = Doc.GetSheet(Doc.ActiveSheetIndex)
&nbsp;
&#39; Update the week beginning part of the title.
Sheet.Write(2,1,&#34;Weekly Sales &amp; Expenses&#34; + StartDate)
&nbsp;
&#39; Loop through the days of the week to update the detail
&#39; Note that:
&#39; 1. We do not set anything but the data that has changed.
&#39; 2. We do not need to include the format objects as in the 
&#39;       original script.  They are retained.
&nbsp;
for i = 1 to 7 &#39;loop over days (rows)
  &#39;Get the date of the current day of the week
  CurrentDate = StartDate + (i - 1)
  &#39;Compute the spreadsheet row
  Row = StartRow + i - 1
  &#39; Call a test function that generates random data
  GetSalesAndExpenses(CurrentDate, Sales, Expenses)
  Sheet.Write(Row, 2, CurrentDate) &#39; Date
  Sheet.Write(Row, 3, Sales)   &#39; Sales
  Sheet.Write(Row, 4, Expenses)   &#39; Expenses
next
&nbsp;
UpdateDailyTotals = .t.
error_exit:
END FUNCTION
&nbsp;
&nbsp;
&#39;********************************************************************
&#39;********************************************************************
&#39;********************************************************************
&#39; This function generates sample data.  
&#39;********************************************************************
&#39;********************************************************************
FUNCTION GetSalesAndExpenses as L (Date as D, BYREF Sales as N, BYREF Expenses as N)
&#39; See the database samples for populating data from tables and queries
&nbsp;
Sales     = 2600 + rand() * 500
Expenses   = 2500 + rand() * 500  
GetSalesAndExpenses = .t.  
END FUNCTION
&nbsp;
&#39;********************************************************************
&#39;********************************************************************
&#39;********************************************************************
&#39;********************************************************************
&#39;********************************************************************
&#39;********************************************************************
FUNCTION CreateOriginalSpreadsheet as L (DocumentFile as C, ShowFile as L = .f.)
dim LastWeekStartDate  as D = date() - (dow(date()) - 1) - 7
dim Doc  as Office::ExcelDocument  &#39; Declare the document variable
&nbsp;
CreateWeeklySalesAndExpenses(LastWeekStartDate, Doc)
Path = file.filename_parse(DocumentFile, &#34;Week Beginning &#34;)
&nbsp;
on error resume next
File.Dir_Create(Path)
on error goto 0
if Doc.Save(DocumentFile)
  if ShowFile
    delete Doc
    sys_open(DocumentFile)
  end if
else  
  ui_msg_box(&#34;P&#34;, \
                   &#34;Error Saving Original Document&#34; \
                 + DocumentFile + &#34;:&#34; + crlf(2) + Doc.ErrorMessage)
end if  
&nbsp;
END FUNCTION
&nbsp;
FUNCTION CreateWeeklySalesAndExpenses as V(StartDate as D, \
                                  Doc as Office::ExcelDocument)
&nbsp;
dim Sheet as Office::Spreadsheet &#39; This function generates random values
&nbsp;
&#39;********************************************************************
dim TitleRow    as N = 1
dim HeadingRow    as N = 4
dim DetailRow    as N = 6
&nbsp;
&#39;********************************************************************
Sheet = Doc.AddSheet(&#34;:&#34;) &#39;********************************************************************
&nbsp;
WritePageHeading(StartDate, Doc, Sheet, TitleRow)
WriteColumnHeadings(StartDate, Doc, Sheet, HeadingRow)
WriteData(StartDate, Doc, Sheet, DetailRow)
&nbsp;
END FUNCTION        
&nbsp;
&nbsp;
FUNCTION WritePageHeading as L (StartDate as D, Doc as Office::ExcelDocument, \
                                Sheet as Office::Spreadsheet, StartRow as N)  
&#39; This part of the sample creates the original spreadsheet to be updated
&#39; The functions below are essentially the same as Sample 1.
dim Format as Office::Format  &#39;********************************************************************
dim Font as Office::Font  &#39;********************************************************************
Format        = Doc.AddFormat()
Font        = Doc.AddFont()
Font.Color      = Office::Color::DarkBlue
Font.Name      = &#34;Unable to save document to &#34;
Font.Size      = 14
Font.Bold      = .t.
Format.Font      = Font  &#39; Declare the document variable
Format.HorizontalAlignment  = Office::HorizontalAlignment::Center
Sheet.SetMerge(1,1,1,5)
Sheet.Write(1,1,&#34;:&#34;, Format)
&nbsp;
Sheet.SetMerge(2,2,1,5)
Sheet.Write(2,1,&#34;Weekly Sales &amp; Expenses&#34; + StartDate, Format)
&nbsp;
WritePageHeading = .t.
END FUNCTION
&nbsp;
&nbsp;
FUNCTION WriteColumnHeadings as L (StartDate as D, Doc as Office::ExcelDocument, \
                                   Sheet as Office::Spreadsheet, StartRow as N)
dim ColumnHeadings as C = &amp;lt;&amp;lt;%txt%
Day
Date
Daily Sales
Daily Expenses
Gross Daily Profit
%txt%
dim ColumnWidth(5( as N
ColumnWidth(1( = len(&#34;Weekly Sales &amp; Expenses&#34;)
ColumnWidth(2( = len(&#34;Tahoma&#34;)
ColumnWidth(3( = len(&#34;Weekly Sales Summary&#34;)
ColumnWidth(4( = len(&#34;Weekly Sales Summary&#34;)
ColumnWidth(5( = len(&#34;Weekly Sales Summary&#34;)
dim ColumnHeadingCount as N = w_count(ColumnHeadings, crlf())
&nbsp;
&#39; Pointer to the spreadsheet
&#39; This part of the sample creates the original spreadsheet to be updated
&#39; Layout of the spreadsheet
dim LeftFormat  as Office::Format &#39; Create a new spreadsheet
dim RightFormat  as Office::Format &#39; Create a new spreadsheet
dim Font  as Office::Font    &#39; Add a title formatted with Bold 14 point Tahoma font in Blue \
&nbsp;
Font    = Doc.AddFont()
Font.Color  = Office::Color::DarkBlue
Font.Name  = &#34;Unable to save document to &#34;
Font.Size  = 11
Font.Bold  = .t.
LeftFormat  = Doc.AddFormat()
LeftFormat.Wrap  = .t.
LeftFormat.Font  = Font  &#39;        and merge the first 5 columns in the first row
LeftFormat.HorizontalAlignment = Office::HorizontalAlignment::Left
RightFormat  = Doc.AddFormat()
RightFormat.Wrap= .t.
RightFormat.Font= Font  &#39;        and merge the first 5 columns in the first row
RightFormat.HorizontalAlignment  = Office::HorizontalAlignment::Right
&nbsp;
for i = 1 to ColumnHeadingCount
  CurrentHeading = word(ColumnHeadings, i, crlf())
  Sheet.SetColumn(i, i, max(ColumnWidth(i( * 1.2, Sheet.ColumnWidth(i)))
  Sheet.Write(StartRow, i, CurrentHeading, \
                    if(i &amp;lt; 2, LeftFormat, RightFormat))
next  
&nbsp;
WriteColumnHeadings = .t.
END FUNCTION
&nbsp;
&nbsp;
FUNCTION WriteData as L (StartDate as D, Doc as Office::ExcelDocument, \
                         Sheet as Office::Spreadsheet, StartRow as N)
&#39; Pointer to the format for Page headings
dim NumericFormat   as Office::Format &#39; Pointer to the font for Page headings
dim DateFormat      as Office::Format &#39; Set the font into the page heading format
dim CharacterFormat as Office::Format &#39; Add the column headings (row 3)
dim Font      as Office::Font   &#39; Add a title formatted with Bold 14 point Tahoma font in Blue \
dim LabelFont      as Office::Font   &#39;     and merge the first 5 columns in the first row
dim Sales      as N
dim Expenses      as N
dim ProfitFormula   as C
&nbsp;
&#39; Pointer to the left aligned format for Column headings
Font    = Doc.AddFont()
Font.Color  = Office::Color::Black
Font.Name  = &#34;Unable to save document to &#34;
Font.Size  = 10
Font.Bold  = .f.
&nbsp;
&#39; Pointer to the right aligned format for Column headings
NumericFormat    = Doc.AddFormat()
NumericFormat.Font  = Font  &#39;        and merge the first 5 columns in the first row
NumericFormat.HorizontalAlignment = Office::HorizontalAlignment::Right
NumericFormat.NumericFormat    = Office::NumericFormat::CurrencyDec2NegBracketedInRed
&nbsp;
&#39; Pointer to the font for Column headings
DateFormat      = Doc.AddFormat()
DateFormat.Font      = Font  &#39;        and merge the first 5 columns in the first row
DateFormat.HorizontalAlignment  = Office::HorizontalAlignment::Right
DateFormat.NumericFormat  = Office::NumericFormat::Date
&nbsp;
&#39; Set the font into the column heading format
LabelFont      = Doc.AddFont()
LabelFont.Color      = Office::Color::DarkBlue
LabelFont.Name      = &#34;Unable to save document to &#34;
LabelFont.Size      = 10
LabelFont.Bold      = .t.
LabelFormat      = Doc.AddFormat()
LabelFormat.Font    = LabelFont  &#39;        and merge the first 5 columns in the first row
LabelFormat.HorizontalAlignment  = Office::HorizontalAlignment::Left
&nbsp;
&#39; Set the font into the column heading format
for i = 1 to 7
  CurrentDate = StartDate + (i - 1) &#39; Write the detail data and a total line
  Row = StartRow + i - 1            &#39; Pointer to the format for numeric columns
  &#39; Call a test function that generates random data
  GetSalesAndExpenses(CurrentDate, Sales, Expenses) 
  ProfitFormula = &#34;Week Beginning &#34; + Row + &#34;Wednesday&#34; + Row &#39; Pointer to the format for the date column
&nbsp;
  Sheet.Write(Row, 1, CDow(CurrentDate), LabelFormat)      &#39; Pointer to the format for labels
  Sheet.Write(Row, 2, CurrentDate, DateFormat)     &#39; Date
  Sheet.Write(Row, 3, Sales, NumericFormat)           &#39; Sales
  Sheet.Write(Row, 4, Expenses, NumericFormat)           &#39; Expenses
  Sheet.WriteFormula(Row, 5, ProfitFormula, NumericFormat) &#39; Pointer to the font for column data
next
&nbsp;
&#39; Pointer to the font for labels 
Row = StartRow + 8
ProfitFormula = &#34;Week Beginning &#34; + Row + &#34;Wednesday&#34; + Row          
Sheet.Write(Row, 1, &#34;00/00/0000&#34;, LabelFormat)
&#39; Create a font for the detail data
Sheet.WriteFormula(Row, 3, &#34;($000,000.00)&#34; + StartRow + &#34;($000,000.00)&#34; + (StartRow + 6) + &#34;($000,000.00)&#34;, NumericFormat)
&#39; Create a format for numeric columns
Sheet.WriteFormula(Row, 4, &#34;Tahoma&#34; + StartRow + &#34;Tahoma&#34; + (StartRow + 6) + &#34;($000,000.00)&#34;, NumericFormat)
&#39; Pointer to the font for column data
Sheet.WriteFormula(Row, 5, ProfitFormula, NumericFormat)
&nbsp;
WriteData = .t.
END FUNCTION</pre></div><br />
<h2 class="showhide_heading" id="See_Also">See Also</h2>
<a href="Generate Excel Spreadsheets Programmatically.html" title="Generate Excel Spreadsheets Programmatically V11" class="wiki">Generate Excel Spreadsheets Programmatically V11</a><br />
<a href="Office__NAMESPACE__ExcelDocument.html" title="Office::ExcelDocument" class="wiki">Office::ExcelDocument</a><br />
<a href="Office__NAMESPACE__Excel2003Document.html" title="Office::Excel2003Document" class="wiki">Office::Excel2003Document</a><br />
<a href="Office__NAMESPACE__Spreadsheet.html" title="Office::Spreadsheet" class="wiki">Office::SpreadSheet</a><br />
<a href="Office__NAMESPACE__Format.html" title="Office::Format" class="wiki">Office::Format</a><br />
<a href="Office__NAMESPACE__Font.html" title="Office::Font" class="wiki">Office::Font</a><br />
<a href="Office Enumerations.html" title="Office Enumerations" class="wiki">Office Enumerations</a><br />
<a href="../../../../Guide/Design/Data/SQL/Perform Common Spreadsheet Operations.html" title="How to perform common spreadsheet operations" class="wiki">How to perform common spreadsheet operations</a><br />
<a href="Office Example__COLON__ Hello, World spreadsheet.html" title="Office Example: Hello, World spreadsheet" class="wiki">Office Example: Hello, World Spreadsheet</a><br />
<a href="Office Example__COLON__ Simple Weekly sales spreadsheet.html" title="Office Example: Simple Weekly sales spreadsheet" class="wiki">Office Example: Simple Weekly sales spreadsheet</a><br />
<a href="Office Example__COLON__ Multiple spreadsheets.html" title="Office Example: Multiple spreadsheets" class="wiki">Office Example: Multiple Spreadsheets</a><br />
<a href="../../../../Guide/Design/Data/SQL/Office Example__COLON__ Spreadsheet from SQL query.html" title="Office Example: Spreadsheet from SQL query" class="wiki">Office Example: Spreadsheet from SQL query</a><br />
<a href="/Desktop/Guide/Design/Data/DBF/Office Example__COLON__ Spreadsheet from DBF tables.html" title="Office Example: Spreadsheet from DBF tables" class="wiki">Office Example: Spreadsheet from DBF tables</a><br />
<a href="Office Example__COLON__ Spreadsheet with picture.html" title="Office Example: Spreadsheet with picture" class="wiki">Office Example: Spreadsheet with picture</a><br />
<br />

	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:Office+Example%3A+Update+a+spreadsheet">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA:{"tags":"common,review","status":"pending","notes":"Example could use context, part of tutorial?","keywords":"server,api,ref,spreadsheet"}--->
</body></html>