<!DOCTYPE html>
<html>
<head>
<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
<link rel="stylesheet" type="text/css" href="theme.css" />
</head>
<body>
<div id="tiki-clean">
	<div id="tiki-mid">
	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">
<span id="description"></span>
		</div>
	</div>
</div>

<article id="top" class="wikitext clearfix nopagetitle">

<h1 class="showhide_heading" id="Storing_Files_in_Sessions">Storing Files in Sessions</h1>
	<p class="showhide_heading">&nbsp;</p>
<br />
	Session storage is able to deliver robust and scalable server solutions. In order to enable this 
	feature, data  intended to be stored on disk at the session level should use <strong>Session.SaveDataAsFile()</strong>. This stored file can then be linked to using <strong>Session.FormatFileDataURL()</strong>.<br />
<br />
<strong>Session.SaveDataToFile()</strong> is a method that takes a key and data, then saves that data somewhere using the key you supplied. The key is typically a filename without a path but with an extension, for instance as MyFile.txt. The storage location is not significant to the application developer because you will not be directly coding to the physical location.<br />
<br />
When you want to link to a file that has been stored using <strong>Session.SaveDataToFile()</strong>, you use <strong>Session.FormatFileDataURL()</strong> to create the URL by passing in the key you used when storing the data.<br />
<br />
<div class="plugincode" parse="vbnet"><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox" >&lt;%a5
dim FileKey as c = &#34;MyFile.txt&#34;
Session.SaveDataAsFile(FileKey,&#34;Hello World, this is a session file&#34;)
Response.Redirect(Session.FormatFileDataURL(FileKey))
%&gt;</pre></div><br />
<div class="clearfix rbox note"><img src="images/close.png" alt="Close" width="16" height="16" class="rbox-close" onclick="$(this).parent().fadeOut();" title="Close" /><div class="rbox-title"><img src="images/information.png" alt="note" width="16" height="16" title="note" class="icon" /><span>Note</span></div><div class="rbox-data">The file extension of the filename used as a key in <strong>Session.SaveDataAsFile(Key, data)</strong> and <strong>Session.FormatFileDataURL(Key)</strong> matters, because the extension is used for MIME type parsing. For example, in order to have Excel data treated as such when it is sent to the browser, use an extension of .XLS. The above example uses a file extension of .TXT.</div></div><br />
<h3 class="showhide_heading" id="Legacy_Compatibility">Legacy Compatibility</h3>Prior to Version 11, developers often used the <strong>Session.Session_Folder</strong> property as a location in which to save session files and <strong>Session.Session_URL</strong> as a base URL to then link to the session file. Both of these properties 
	were removed in Version 11, which means legacy code which uses them <em>must </em>be updated.<br />
<br />
<strong>Session.SaveDataToFile()</strong> saves data directly to the session storage as opposed to being a string value like <strong>Session.Session_Folder</strong> which could be used as part of a file path.<br />
<br />
<strong>Session.FormatFileDataURL()</strong> is similar to using <strong>Session.Session_URL</strong>.<br />
<br />
Typically, these two properties have been used in a pattern such as that shown below. This legacy code can be directly replaced by the example code above.<br />
<div class="plugincode" parse="vbnet"><div class="codecaption">Legacy Example</div><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox1" >&lt;%a5
dim Filename as c = &#34;MyFile.txt&#34;
save_to_file(&#34;Hello World, this is a session file&#34;,Session.Session_Folder + Filename)
Response.Redirect(Session.Session_Url + Filename)
%&gt;</pre></div><br />
<br />
Another common usage of these properties prior to Version 11 is for generation of reports as a session file:<br />
<div class="plugincode" parse="vbnet"><div class="codecaption">Legacy Code</div><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox2" >&lt;%a5
dim filter as c = &#34;MyFile.txt&#34;
dim order as c = &#34;MyFile.txt&#34;
Dim filename as c = Session.Session_Folder + &#34;Hello World, this is a session file&#34;
filename = report.saveas(&#34;&#34;,&#34;&#34;,filter,order,filename,.f.)
if file.exists(filename)
    Response.Redirect(Session.Session_URL + &#34;Hello World, this is a session file&#34;)
end if
%&gt;</pre></div><br />
<br />
This example is a bit more involved to replace because there is no direct replacement for the Session.Session_Folder property in order to build a file name to be used by Report.SaveAs(). Because of this, <a href="Server Programming Changes V11.html#Request_3" title="Server Programming Changes V11" class="wiki">Request.GetRequestTempFileName(</a>) should be used to provide a temporary file location for the report generation, and then the file's contents can be moved into session storage.<br />
<div class="plugincode" parse="vbnet"><div class="codecaption">Replacement Code</div><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox3" >&lt;%a5
dim filter as c = &#34;MyFile.txt&#34;
dim order as c = &#34;MyFile.txt&#34;
Dim filename as c = Request.GetRequestTempFileName()
filename = report.saveas(&#34;&#34;,&#34;&#34;,filter,order,filename,.f.)
if file.exists(filename)
    Session.SaveDataAsFile(&#34;Hello World, this is a session file&#34;,file.to_blob(filename))
    Response.Redirect( Session.FormatFileDataURL(&#34;Hello World, this is a session file&#34;) )
end if
%&gt;</pre></div><br />

<div class="clearfix rbox note">
	<img src="images/close.png" alt="Close" width="16" height="16" class="rbox-close" onclick="$(this).parent().fadeOut();" title="Close" />
	<div class="rbox-title">
		<img src="images/information.png" alt="note" width="16" height="16" title="note" class="icon" /><span>Note</span>
	</div>
	<div class="rbox-data">The code above uses Session.SaveDataAsFile() and Response.Redirect() in order to demonstrate the usage of those methods. However, this is NOT the most efficient way of sending the PDF contents back to the browser. <strong>Using <a href="" title="Response.SendFile()" class="wiki">Response.SendFile()</a> is a Best Practice and is strongly recommended instead.</strong>
	<br />
	<br />
	<div class="plugincode" parse="vbnet">
		<div class="codecaption">Replacement Code</div>
		<pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox3" >&lt;%a5
	dim filter as c = &#34;MyFile.txt&#34;
	dim order as c = &#34;MyFile.txt&#34;
	Dim filename as c = Request.GetRequestTempFileName()
	filename = report.saveas(&#34;&#34;,&#34;&#34;,filter,order,filename,.f.)
	if file.exists(filename)
		Response.SendFile(
	end if
	%&gt;</pre></div><br />
	</div>
</div><br />


<h3 class="showhide_heading" id="See_Also">See Also</h3>
<a href="Server Programming Changes V11.html#Request_3" title="Server Programming Changes V11" class="wiki">Request.GetRequestTempFileName()</a><br />
<a href="" title="Response.SendFile()" class="wiki">Response.SendFile()</a><br />
<br />


<hr class="hrwikibottom" />
</article>

<!-- WIKIPATH:Storing+Files+In+Sessions+V11">-->

<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
		<div class="wikiinfo" style="float: left">
			<span id="description"></span>
		</div>
	</div>
</div>
			</div>
		</div>

<!-- Put JS at the end -->

<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA:{"tags":"web,review","status":"pending","notes":"funky characters","keywords":"server,guide"}--->
</body></html>