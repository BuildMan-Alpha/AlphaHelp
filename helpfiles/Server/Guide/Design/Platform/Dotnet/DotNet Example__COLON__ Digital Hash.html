	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	 




<article id="top" class="wikitext nopagetitle">
			
		
		
		
		
			 

	
			<h1 class="showhide_heading" id="DotNet_Example:_Digital_Hash">DotNet Example: Digital Hash</h1>
Digital hash functions are often used to validate executable files and digital documents. One important use of a digital hash is to sign e-commerce documents; this is required in order to do business on Amazon, for example.<br />
<br />
The .NET Framework has a full set of encryption functions, so it was relatively easy to create a .NET assembly and Xbasic wrapper function for the purpose of implementing an HMAC (hash-based message authentication code).<br />
<div class="rbox note"><img src="images/close.png" alt="Close" width="16" height="16" class="rbox-close" onclick="$(this).parent().fadeOut();" title="Close" /><div class="rbox-title"><img src="images/information.png" alt="note" width="16" height="16" title="note" class="icon" /><span>Note</span></div><div class="rbox-data">The value returned for the HMAC hash is in Base64, which is what Amazon wants for e-commerce. If you try to compare Base64 with an online hash calculator that returns hexadecimal, they will not appear to match.<br />
<br />
See the <strong>Plain SHA-1 Hash</strong> section below if you only want a simple SHA1 hash, rather than an encrypted HMAC hash based on SHA1 or another hash algorithm.</div></div><br />
The C# code:<br />
<div class="plugincode" parse="csharp"><pre class="codelisting" data-syntax="csharp" dir="ltr" style="overflow:auto;" id="codebox" >using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Security.Cryptography;
&nbsp;
namespace HashLib
{
    public class HMAC
    {
        /// &amp;lt;summary&amp;gt;
        /// Computes RFC 2104-compliant HMAC signature
        /// &amp;lt;/summary&amp;gt;
        /// &amp;lt;param name=&#34;data&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;param name=&#34;key&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;param name=&#34;algorithm&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;returns&amp;gt;Signature&amp;lt;/returns&amp;gt;
        public String Sign{String data, String key, KeyedHashAlgorithm algorithm(
        {
            Encoding encoding ) new UTF8Encoding{(=
            algorithm(Key ) encoding(GetBytes{key(=
            return Convert(ToBase64String{algorithm(ComputeHash{
                encoding(GetBytes{data(ToCharArray{((((=
        )
&nbsp;
        /// &amp;lt;summary&amp;gt;
        /// Computes RFC 2104-compliant HMAC signature using SHA1
        /// &amp;lt;/summary&amp;gt;
        /// &amp;lt;param name=&#34;data&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;param name=&#34;key&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;param name=&#34;data&#34;&amp;gt;&amp;lt;/param&amp;gt;
        public String Sign1{String data, String key(
        {
            KeyedHashAlgorithm algorithm ) ; HMACSHA1{(=
            return Sign{data, key, algorithm(=
        )
&nbsp;
        /// &amp;lt;param name=&#34;key&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;returns&amp;gt;Signature&amp;lt;/returns&amp;gt;
        /// &amp;lt;summary&amp;gt;
        /// &amp;lt;param name=&#34;data&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;param name=&#34;key&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;param name=&#34;data&#34;&amp;gt;&amp;lt;/param&amp;gt;
        public String Sign256{String data, String key(
        {
            KeyedHashAlgorithm algorithm ) ; HMACSHA256{(=
            return Sign{data, key, algorithm(=
        )
&nbsp;
        /// &amp;lt;param name=&#34;key&#34;&amp;gt;&amp;lt;/param&amp;gt;
        ///  Computes RFC 2104-compliant HMAC signature using SHA256
        /// &amp;lt;summary&amp;gt;
        /// &amp;lt;param name=&#34;data&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;param name=&#34;key&#34;&amp;gt;&amp;lt;/param&amp;gt;
        /// &amp;lt;/summary&amp;gt;
        /// &amp;lt;param name=&#34;data&#34;&amp;gt;&amp;lt;/param&amp;gt;
        public String SignUsing{String data, String key, String SignatureMethod(
        {
            KeyedHashAlgorithm algorithm ) KeyedHashAlgorithm(Create{SignatureMethod(ToUpper{((=
            return Sign{data, key, algorithm(=
        )
    )
)</pre></div><br />
The Xbasic wrapper function:<br />
<br />
<div class="plugincode" parse="vbnet"><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox1" >FUNCTION HMAC_HASH as C(data as C, key as C, assembly_path as C, algorithm as C ) &#34;HMACSHA1&#34;)
  /// &amp;lt;param name=&#34;data&#34;&amp;gt;&amp;lt;/param&amp;gt;
  dim alg as C ) upper(algorithm)
&nbsp;
  /// &amp;lt;param name=&#34;key&#34;&amp;gt;&amp;lt;/param&amp;gt;
  dim sv as DotNet::Services
  dim assembly as DotNet::AssemblyReference
  assembly.FileName ) assembly_path.&#34;HashLib.dll&#34;
&nbsp;
  IF .not. file.exists(assembly.FileName)
    ui_msg_box(&#34;File not found&#34;,assembly.FileName)
    end
  END IF
&nbsp;
  IF sv.RegisterClass(&#34;&#34;,&#34;&#34;,&#34;&#34;,assembly) THEN
  /// &amp;lt;returns&amp;gt;Signature&amp;lt;/returns&amp;gt;
    dim hash as DotNet::HashLib::HMAC
    SELECT
      CASE alg)&#34;HMACSHA1&#34;
        HMAC_HASH ) hash.Sign1(data,key)
&nbsp;
      CASE alg)&#34;HashLib.HMAC&#34;
        HMAC_HASH ) hash.Sign256(data,key)
&nbsp;
      CASE else
        HMAC_HASH ) hash.SignUsing(data,key,alg)
    END SELECT
  END IF
END FUNCTION</pre></div><br />
An interactive session to test the function:<br />
<div class="plugincode" parse="vbnet"><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox2" >path ) &#34;HMACSHA1&#34;
?HMAC_HASH(&#34;HMACSHA256&#34;, &#34;C:\Users\martin\Documents\Visual Studio 2010\Projects\HashLib\HashLib\bin\Release\\&#34;, path)
) &#34;my data&#34;
&nbsp;
?HMAC_HASH(&#34;HMACSHA256&#34;, &#34;C:\Users\martin\Documents\Visual Studio 2010\Projects\HashLib\HashLib\bin\Release\\&#34;, path, &#34;HMACSHA1&#34;)
) &#34;my data&#34;
&nbsp;
?HMAC_HASH(&#34;HMACSHA256&#34;, &#34;C:\Users\martin\Documents\Visual Studio 2010\Projects\HashLib\HashLib\bin\Release\\&#34;, path, &#34;HashLib.HMAC&#34;)
) &#34;my key&#34;
&nbsp;
?HMAC_HASH(&#34;HMACSHA256&#34;, &#34;C:\Users\martin\Documents\Visual Studio 2010\Projects\HashLib\HashLib\bin\Release\\&#34;, path, &#34;Wnw05dPAEo44+bw1luJqAWksvhE=&#34;)
) &#34;my data&#34;
&nbsp;
?HMAC_HASH(&#34;HMACSHA256&#34;, &#34;C:\Users\martin\Documents\Visual Studio 2010\Projects\HashLib\HashLib\bin\Release\\&#34;, path, &#34;my key&#34;)
ERROR: command:         HMAC_HASH ) hash.SignUsing(data,key,alg)
Exception has been thrown by the target of an invocation.
Specified key is not a valid size for this algorithm.
&nbsp;
?HMAC_HASH(&#34;HMACSHA256&#34;, &#34;C:\Users\martin\Documents\Visual Studio 2010\Projects\HashLib\HashLib\bin\Release\\&#34;, path, &#34;HMACSHA1&#34;)
) &#34;Wnw05dPAEo44+bw1luJqAWksvhE=&#34;
&nbsp;
?HMAC_HASH(&#34;HMACSHA256&#34;, &#34;C:\Users\martin\Documents\Visual Studio 2010\Projects\HashLib\HashLib\bin\Release\\&#34;, path, &#34;my data&#34;)
ERROR: command:         HMAC_HASH ) hash.SignUsing(data,key,alg)
Exception has been thrown by the target of an invocation.
Object reference not set to an instance of an object.</pre></div><br />
A <a href="../../../../Reference/Design/Api/DotNet/hmac_hash Function.html" title="hmac_hash Function" class="wiki">modified version of this function</a> and the required .NET DLL shipped with Version 11. The .NET DLL needed for running this sample (if you don't want to compile the C# yourself) is attached. (See attachments button at bottom of page)<br />
<h2 class="showhide_heading" id="Plain_SHA-1_Hash">Plain SHA-1 Hash</h2>
Calculating a plain SHA-1 hash is a simpler problem. The following script will accomplish the purpose.<br />
<br />
<div class="plugincode" parse="vbnet"><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox3" >dim data as b
dim result as b
data ) &#34;HMACSHA256&#34;
dim sham as ::System::Security::Cryptography::SHA1Managed ) .
        new ::System::Security::Cryptography::SHA1Managed()
result ) sham.ComputeHash(data)
showvar((to_hex(result))</pre></div><br />
<br />
This gives :<br />
<br />
fee95d29ae5926af3375e2eb3a688471de0a2c3e<br />
<div class="rbox note"><img src="images/close.png" alt="Close" width="16" height="16" class="rbox-close" onclick="$(this).parent().fadeOut();" title="Close" /><div class="rbox-title"><img src="images/information.png" alt="note" width="16" height="16" title="note" class="icon" /><span>Note</span></div><div class="rbox-data">The blob type in Xbasic (dim data as b) corresponds to the byte&#91;] type in the .NET framework.</div></div><br />
<br />
<h2 class="showhide_heading" id="See_Also">See Also</h2>
<a href="../../../../Reference/Design/Api/DotNet/hmac_hash Function.html" title="hmac_hash Function" class="wiki">hmac_hash Function</a><br />
<a class="wiki external" target="_blank" href="http://msdn.microsoft.com/en-us/library/system.security.cryptography.aspx" rel="external nofollow">.NET System.Security.Cryptography Namespace</a><img src="images/external_link.gif" alt="(external link)" width="15" height="14" title="(external link)" class="icon" /><br />
<a href=".NET Framework Support.html" title=".NET Framework Support in Alpha Five V11" class="wiki">
	.NET Framework Support in Alpha Anywhere </a><br />
<a href="../../../../Reference/Design/Api/DotNet/DotNet__NAMESPACE__AssemblyReference.html" title="DotNet::AssemblyReference" class="wiki">DotNet::AssemblyReference</a><br />
<a href="../../../../Reference/Design/Api/DotNet/DotNet__NAMESPACE__Services.html" title="DotNet::Services" class="wiki">DotNet::Services</a><br />
<a href="../../../../Reference/Design/Api/DotNet/CreateObject Method.html" title="CreateObject Method" class="wiki">CreateObject Method</a><br />
<a href="../../../../Reference/Design/Api/DotNet/CallStaticFunction Method.html" title="CallStaticFunction Method" class="wiki">CallStaticFunction Method</a><br />
<a href="../../../../Reference/Design/Api/DotNet/ConstructGenericTypeName Method.html" title="ConstructGenericTypeName Method" class="wiki">ConstructGenericTypeName Method</a><br />
<a href="../../../../Reference/Design/Api/DotNet/GetStaticProperty Method.html" title="GetStaticProperty Method" class="wiki">GetStaticProperty Method</a><br />
<a href="SetStaticProperty Method.html" title="SetStaticProperty Method" class="wiki">SetStaticProperty Method</a><br />
<a href="../../../../Reference/Design/Platform/Dotnet/RegisterClass Method.html" title="RegisterClass Method" class="wiki">RegisterClass Method</a><br />
<a href="../../../../Reference/Design/Platform/Dotnet/RegisterAssembly Method.html" title="RegisterAssembly Method" class="wiki">RegisterAssembly Method</a><br />
<a href="../../../../Reference/Design/Platform/Dotnet/RegisterNamespace Method.html" title="RegisterNamespace Method" class="wiki">RegisterNamespace Method</a><br />
<a href="../../../../Reference/Design/Api/OLE/GenerateWebServiceClientFromURL Method.html" title="GenerateWebServiceClientFromURL Method" class="wiki">GenerateWebServiceClientFromURL Method</a><br />
<a href="../../../../Reference/Design/Api/DotNet/GenerateWebServiceClientFromWSDL Method.html" title="GenerateWebServiceClientFromWSDL Method" class="wiki">GenerateWebServiceClientFromWSDL Method</a><br />
<a href="Preloaded .NET Classes.html" title="Preloaded .NET Classes V11" class="wiki">Preloaded .NET Classes </a><br />
<a href="../Xbasic/Writing Xbasic Wrapper Classes for .NET classes.html" title="Writing Xbasic wrapper classes for .NET classes V11" class="wiki">Writing Xbasic wrapper classes for .NET classes </a><br />
<a href="../../../../Reference/Design/Api/DotNet/DotNetPath Function.html" title="DotNetPath Function" class="wiki">DotNetPath Function</a><br />
<a href="/Index/DotNet Examples V11.html" title="DotNet Examples V11" class="wiki">DotNet Examples </a><br />
<br />

	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:DotNet+Example%3A+Digital+Hash">-->


	 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA:{"tags":"web,common","status":"pending","keywords":"server,guide,dotnet"}--->
</body></html>