	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	 




<article id="top" class="wikitext nopagetitle">
			
		
		
		
		
			 

	
			
<p class=A3Topic>Using Threads</p>



<p>Suppose you start a new thread but put a <a href="/Api/Functions/Xbasic/Script Functions/SLEEP Function.xml" title="SLEEP Function" class="wiki">SLEEP(</a>) 
 command in it such as:</p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;" valign="top">
<td style="x-cell-content-align: top;
			width: 100%;
			padding-right: 10px;
			padding-left: 10px;" valign="top" width="100%">
<p class=Code>thread_create("myThread",<<%code%</p>


<p class=Code>dim vFlag&nbsp;as&nbsp;L = .t.</p>


<p class=Code>while vFlag</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;'do some stuff</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;sleep(20)</p>


<p class=Code>end while</p>


<p class=Code>%code%</td></tr>
</table>

<p>Does this thread consume CPU time even though it is "asleep"? 
 Would it be better to terminate the thread and start a new thread 20 seconds 
 later, or 5 minutes later, depending on the processing cycle?</p>



<p>A sleeping thread consumes no CPU time. If you run <a href="/Api/Functions/System/Thread Functions/THREADMON Function.xml" title="THREADMON Function" class="wiki">THREADMON(</a>) 
 from the <span class=Screen>Interactive</span> window you will see something 
 similar to the <span class=Screen>Windows Task Manager</span> which shows 
 all of the threads and their CPU usage. You can use this to verify the 
 CPU usage of any of your threads.</p>



<p>For most applications it will make no difference whether you kill and 
 restart your threads or put them to sleep. It is usually easier to have 
 them sleep so that you don't need another process to periodically restart 
 them.</p>



<p>However, there are a 2 main points to consider in an application where 
 you will be running many threads and need to optimize performance:</p>



<ul style="list-style: disc;"
	type=disc>
	
	<li class=kadov-p-CBullet1><p class=Bullet1>Whatever memory a thread 
 is using to store variables, etc will stay in use while the thread is 
 asleep. This memory use can be minimized by deleting variables you don't 
 need to keep around before using the SLEEP() function. But if you have 
 a large number of idle or sleeping threads, the resource usage will build 
 up and become noticeable.</p>

</li>
	
	<li class=kadov-p-CBullet1><p class=Bullet1>There is some overhead 
 to creating and exiting threads, which is not significant for a small 
 application. Letting a thread exit cleanly does a cleanup that is desirable 
 (freeing table handles, clearing memory, etc). However, in an application 
 where you really need to maximize performance and responsiveness, it is 
 better to keep your threads around with a short sleep period between "waking 
 up" and checking for work to do.</p>

</li>
</ul>

<p>The <span class=Screen>Application Server</span> is a good example of 
 a multi-threaded application that needs to perform&nbsp;as&nbsp;well&nbsp;as&nbsp;possible. 
 Alpha Five has implemented a technique known&nbsp;as&nbsp;thread pooling 
 to maximize performance. When you start the <span class=Screen>Application 
 Server</span>, at least two threads are created - a main thread ( <span 
 class=Code1>httpd_main</span> ) which essentially acts&nbsp;as&nbsp;a 
 traffic director and at least one "worker" thread ( <span class=Code1>httpd_Client*</span> 
 ).</p>



<p>The main thread does all of the required initialization, opens the port 
 that the server accepts requests on, then waits for an incoming request. 
 When a request comes in from a client, it checks all of the worker threads 
 to see if one is available to handle the request.</p>



<p>If a worker is available, the main thread passes the request along and 
 then waits for the next incoming request. If a worker thread is not available, 
 the main thread creates a new worker thread, up to the maximum number 
 defined in the <span class=Screen>Application Server Control Panel</span>, 
 and gives the newly created worker the request to process.</p>



<p>When each worker thread finishes processing a request and sends the 
 output back to the client, it notifies the main thread that it is no longer 
 busy. The main thread then checks the number of spare worker threads that 
 should be kept around (also set in the <span class=Screen>Application 
 Server Control Panel</span> ) and either lets the worker go to sleep until 
 another request comes in or it stops the worker.</p>



<p>The intent of this technique is to have a worker thread pre-created 
 and available when a request is received, yet not to have more idle workers 
 than necessary. This minimizes the response time of the server by not 
 having to create a new thread&nbsp;as&nbsp;a request is received, minimizes 
 the CPU overhead of starting and stopping threads, and minimizes the memory 
 footprint of idle threads.</p>



<p class=A5>See Also</p>



<p><a href="../../../Reference/Design/Api/Functions/Thread Functions/Thread Functions and Methods.html" title="Thread Functions and Methods" class="wiki">Thread Functions and Methods</a>, <a href="../What's New/What's New in Version 11/New Xbasic Functions and Methods V11/THREAD.traceMapping Property.html" title="THREAD.traceMapping Property" class="wiki">THREAD.traceMapping Property</a></p>



<p class=A5>Limitations</p>



<p>Web publishing applications only.</p>
	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:Using+Threads">-->


	 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA: {"status":"accept","tags":"web","keywords":"server,api,guide"} --->
</body></html>