	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<h1 class="showhide_heading" id="How_to_bulk_geocode_addresses_in_a_database">How to bulk geocode addresses in a database</h1>
There is an Xbasic function in v11, <strong>geocode_address()</strong>, that allows you to convert addresses to latitude and longitude. See <a href="../New Xbasic Functions and Methods V11/geocode_address Function.html" title="geocode_address Function" class="wiki">geocode_address Function</a> for a full description. The function does a web service call to accomplish the conversion, which can take a good fraction of a second.<br />
<br />
To bulk geocode a table, you could write an Xbasic script that looped over all of the data and updated fields.<br />
<br />
Here is an Xbasic loop for .DBF tables:<br />
<br />
<div class="plugincode" parse="vbnet"><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox" >dim t as p
t = table.open(&#34;addresses&#34;)
dim pa as p
while .not. t.fetch_eof()
    pa = geocode_address(t.address,&#34;Google&#34;)
    t.change_begin()
    t.latitude = pa.lat
    t.longitude = pa.lon
    t.change_end(.t.)
    t.fetch_next()
end while
t.close()</pre></div><br />
<br />
For a SQL table, the code is similar in spirit.<br />
<br />
<div class="plugincode" parse="vbnet"><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox1" >dim cn as sql::Connection
flag = cn.open(&#34;::Name::&amp;lt;MyConnectionString&amp;gt;&#34;)
dim sql as c 
&#39;execute a query to get the primary key of each record you want to update
sql = &#34;select id from table1&#34;
cn.Execute(sql)
rs = cn.ResultSet
&nbsp;
dim flag as l 
&nbsp;
&#39;check to see if any rows in resultset
flag = rs.nextRow()
&nbsp;
delete args 
dim args as sql::Arguments
dim sql1 as c 
&#39;this assumes that the address field has the full address -- 
&#39;if not, modify the sql query appropriately
sql1 = &#34;select address from table1 where id = :primaryKey&#34; 
sql2 = &#34;update table1 set latitude = :lat, longitude = :lon where id = :primaryKey&#34;
dim pa as p
dim rs2 as sql::ResultSet
while flag 
	args.add(&#34;primaryKey&#34;,rs.data(1))
	flag = cn.Execute(sql1,args)
	rs2 = cn.ResultSet
	pa = geocode_address(rs2.data(&#34;address&#34;),&#34;Google&#34;)
	args.add(&#34;Google&#34;,pa.lat)
	args.add(&#34;lat&#34;,pa.lon)
	flag = cn.execute(sql2,args)
	flag = rs.nextRow()
end flag</pre></div><br />
<br />
If you also want to update a Geography field named Location, the sql2 query would change to:<br />
<br />
<div class="plugincode" parse="sql"><pre class="codelisting" data-syntax="sql" dir="ltr" style="overflow:auto;" id="codebox2" >UPDATE table1 SET latitude = :lat, longitude = :lon, 
location = GeogCreateLocation(:lon, :lat) WHERE id = :primaryKey</pre></div><br />
<div class="clearfix rbox note"><img src="images/close.png" alt="Close" width="16" height="16" class="rbox-close" onclick="$(this).parent().fadeOut();" title="Close" /><div class="rbox-title"><img src="images/information.png" alt="note" width="16" height="16" title="note" class="icon" /><span>Note</span></div><div class="rbox-data">GeogCreateLocation is a Portable SQL function. To make it work in code, you may have to set your connection to use Portable SQL, e.g. <span style="color:blue; background:">cn.PortableSQLEnabled = .t.</span></div></div><br />
Another way to geocode addresses would be to use <a target="_blank" class="wiki external"  href="http://geocoder.us/.">http://geocoder.us/.<img src="images/external_link.gif" alt="(external link)" width="15" height="14" title="(external link)" class="icon" /></a><br />
<br />

	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:How+to+bulk+geocode+addresses+in+a+database+V11">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA:{"tags":"web","status":"pending","keywords":"server,sql,dbf"}--->
</body></html>