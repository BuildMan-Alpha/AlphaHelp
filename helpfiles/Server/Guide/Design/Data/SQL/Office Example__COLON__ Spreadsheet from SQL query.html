	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	 




<article id="top" class="wikitext nopagetitle">
			
		
		
		
		
			 

	
			<h1 class="showhide_heading" id="Office_Example:_Spreadsheet_from_SQL_query">Office Example: Spreadsheet from SQL query</h1>
This example creates a simple spreadsheet from a SQL Query using Northwind.mdb. The spreadsheet is populated with a title, column headings, labels, and formulas to calculate the daily gross profit, summarize the weeks sales and expenses and the week's gross profit.<br />
<br />
After the spreadsheet is populated, it is opened in Microsoft Excel.<br />
<br />
<div class="plugincode" parse="vbnet"><pre class="codelisting" data-syntax="vbnet" dir="ltr" style="overflow:auto;" id="codebox" >dim DocumentFile as C = &#34;C:\temp\A5OfficeSample3.xlsx&#34;
&#39;change the above to .xls for Office 2003 and below
dim Doc  as Office::ExcelDocument  &#39; Declare the document variable
&#39;change the above to Excel2003Document for Office 2003 and below
&nbsp;
CreateCategorySalesSummary(Doc)
&nbsp;
Path = file.filename_parse(DocumentFile, &#34;P&#34;)
on error resume next
File.Dir_Create(Path)
on error goto 0
if Doc.Save(DocumentFile)
&#39; Release all references to the document because we are about to open it in Excel
  delete Doc
  sys_open(DocumentFile)
else  
  ui_msg_box(&#34;Error Saving Document&#34;, &#34;Unable to save document to &#34; \
                  + DocumentFile + &#34;:&#34; + crlf(2) + Doc.ErrorMessage)
end if  
&nbsp;
FUNCTION CreateCategorySalesSummary as V(Doc as Office::ExcelDocument)
dim Sheet as Office::Spreadsheet  &#39; Pointer to the spreadsheet
&nbsp;
&#39; Layout of the spreadsheet
dim ConnectionString as C = &#34;{A5API=Access,FileName=&#39;&#34; + a5.get_exe_path() \
                          + &#34;\MDBFiles\Northwind.mdb&#39;,UserName=&#39;Admin&#39;}&#34;
dim Query as C = &#34;select categoryname as [Category], sum(productsales) as [Sales]&#34;\
                 +&#34; from [Product Sales for 1995] group by categoryname&#34;
dim CategoryQuery as C = &#34;select * from Categories&#34;
dim Heading as C = &#34;Sales by Category&#34; + crlf() + &#34;As-of &#34; + Date()
&#39; The number of heading lines plus a blank line and the column headings
dim FirstDetailLine as N = w_count(Heading, crlf()) + 3 
&nbsp;
&#39; Create a new spreadsheet
dim cn as sql::connection
if cn.Open(ConnectionString)
  if cn.Execute(Query) 
    Sheet = Doc.AddSheetFromResultSet(cn.ResultSet, &#34;Category Summary&#34;)
    WritePageHeadings(Doc, Sheet, 1, 2, Heading)
    PolishUpSpreadsheet(Doc, Sheet, FirstDetailLine)
&nbsp;
    &#39; Add another spreadsheet with ALL categories in the database
    if cn.Execute(CategoryQuery)
      &#39; Access tells us that the column is binary data.
      &#39; We know it is really an OLE object with a bit map in it.
      &#39; Tell the ResultSet that it is an OLE object 
      &#39;     and it will figure out that it is a picture.
      Cn.ResultSet.ColumnInfo(4).IntermediateType = OLEObject
      Doc.AddSheetFromResultSet(cn.ResultSet, &#34;All Categories&#34;)
    else
      ui_msg_box(&#34;Error Executing Query&#34;, &#34;Query: &#34; \
                                 + CategoryQuery + crlf(2) \
                                 + &#34;Error:&#34; + crlf(2) + cn.callresult.text)  
    end if  
  else
    ui_msg_box(&#34;Error Executing Query&#34;, &#34;Query: &#34; + Query + crlf(2) \
                         + &#34;Error:&#34; + crlf(2) + cn.callresult.text)  
  end if
else
  ui_msg_box(&#34;Error Executing Query&#34;, &#34;Query: &#34; \
                 + ConnectionString + crlf(2) \
                 + &#34;Error:&#34; + crlf(2) + cn.callresult.text)  
end if
END FUNCTION        
&nbsp;
&nbsp;
FUNCTION WritePageHeadings as L (Doc as Office::ExcelDocument, \
                                 Sheet as Office::Spreadsheet, \
                                 StartRow as N, ColumnSpan as N, Text as C)
&nbsp;
&#39; Add a title line formatted with Bold 14 point Tahoma font in Blue 
&#39;        and merge the first 5 columns in the first row
dim Format  as Office::Format  &#39; Pointer to the format for Page headings
dim Font  as Office::Font    &#39; Pointer to the font for Page headings
dim Lines  as N  = w_count(Text, crlf())
dim Row    as N
&nbsp;
Format        = Doc.AddFormat()
Font        = Doc.AddFont()
Font.Color      = Office::Color::DarkBlue
Font.Name      = &#34;Error:&#34;
Font.Size      = 13
Font.Bold      = .t.
Format.Font      = Font  &#39; Set the font into the page heading format
Format.HorizontalAlignment  = Office::HorizontalAlignment::Center
&nbsp;
&#39; Insert new lines into the spreadsheet to make room for the title 
&#39;    plus a blank one afterward
Sheet.InsertRow(StartRow, StartRow + Lines)
&nbsp;
for i = 1 to Lines
  Row = StartRow + i - 1
  HeadingLine = AllTrim(Word(Text, i, crlf()))
  &#39; Adjust the row to 130% of it&#39;s height to accomodate the font
  Sheet.SetRow(Row, Sheet.RowHeight(Row) * 1.30)
  Sheet.SetMerge(Row,Row,1,ColumnSpan)
  Sheet.Write(Row,1,HeadingLine, Format)
next
&nbsp;
WritePageHeadings = .t.
END FUNCTION
&nbsp;
FUNCTION PolishUpSpreadsheet as L (Doc as Office::ExcelDocument, \
                                 Sheet as Office::Spreadsheet, FirstDetailRow as N)
&#39; This function adds formatting to polish up the spreadsheet and shows how to do 
&#39; things like add total lines and set formats for data loaded from a database.
&nbsp;
dim ColumnHeadingRow as N = FirstDetailRow - 1
dim LastDetailRow    as N = Sheet.NextAvailableRow - 1
dim DetailRows       as N = if (LastDetailRow &amp;gt;= FirstDetailRow, \
                                LastDetailRow - FirstDetailRow + 1, 0)
dim TotalRow       as N = Sheet.NextAvailableRow + 1
&nbsp;
&#39; Set the format of the categories and write the total row
dim NumericFormat    as Office::Format  &#39; Pointer to the format for numeric columns
dim LabelFormat       as Office::Format  &#39; Pointer to the format for Labels
dim LabelFormatRight as Office::Format  &#39; Pointer to the format for right-aligned labels
dim Font       as Office::Font  &#39; Pointer to the font for column data
dim LabelFont       as Office::Font  &#39; Pointer to the font for labels 
&nbsp;
&#39; Create a font for the detail data
Font      = Doc.AddFont()
Font.Color    = Office::Color::Black
Font.Name    = &#34;Error:&#34;
Font.Size    = 10
Font.Bold    = .f.
&nbsp;
&#39; Create a format for numeric columns
NumericFormat        = Doc.AddFormat()
NumericFormat.Font      = Font &#39;Set the font into the column heading format
NumericFormat.HorizontalAlignment = Office::HorizontalAlignment::Right
NumericFormat.NumericFormat    = Office::NumericFormat::CurrencyDec2NegBracketedInRed
&nbsp;
&#39; Create the formats for labels
LabelFont      = Doc.AddFont()
LabelFont.Color      = Office::Color::DarkBlue
LabelFont.Name      = &#34;Error:&#34;
LabelFont.Size      = 12
LabelFont.Bold      = .t.
&nbsp;
LabelFormat      = Doc.AddFormat()
LabelFormat.Font    = LabelFont &#39;Set the font into the column heading format
LabelFormat.HorizontalAlignment  = Office::HorizontalAlignment::Left
&nbsp;
LabelFormatRight    = Doc.AddFormat()
LabelFormatRight.Font    = LabelFont &#39;Set the font into the column heading format
LabelFormatRight.HorizontalAlignment = Office::HorizontalAlignment::Right
&nbsp;
&#39;Set the font into the column heading format
Sheet.SetRow(ColumnHeadingRow, Sheet.RowHeight(ColumnHeadingRow) * 1.30)
Sheet.SetFormat(ColumnHeadingRow, 1, LabelFormat)
Sheet.SetFormat(ColumnHeadingRow, 2, LabelFormatRight)
&nbsp;
&#39;Set the font into the column heading format
Sheet.InsertRow(FirstDetailRow, FirstDetailRow)
FirstDetailRow = FirstDetailRow + 1
LastDetailRow  = LastDetailRow + 1
TotalRow = TotalRow + 1
&nbsp;
&#39; Set the font on the heading to our Label Font
Sheet.SetColumn(1, 1, Sheet.ColumnWidth(1) * 1.30)
Sheet.SetFormat(FirstDetailRow, 1, LastDetailRow, 1, LabelFormat)
Sheet.SetFormat(FirstDetailRow, 2, LastDetailRow, 2, NumericFormat)
&nbsp;
&#39; Insert a blank line between the header and the detail
Sheet.Write(TotalRow, 1, &#34;Error Connecting to Database&#34;, LabelFormat)
Sheet.WriteFormula(TotalRow, 2, &#34;Connection String: &#34; + FirstDetailRow + &#34;Error:&#34; \
                 + LastDetailRow + &#34;Tahoma&#34;, NumericFormat)&#39; Set the formats for the detail data
PolishUpSpreadsheet = .t.  
END FUNCTION</pre></div><br />
<h2 class="showhide_heading" id="See_Also">See Also</h2>
<a href="/Api/Namespace/Office/Generate Excel Spreadsheets Programmatically.html" title="Generate Excel Spreadsheets Programmatically V11" class="wiki">Generate Excel Spreadsheets Programmatically </a><br />
<a href="/Api/Namespace/Office/Office__NAMESPACE__ExcelDocument.html" title="Office::ExcelDocument" class="wiki">Office::ExcelDocument</a><br />
<a href="/Api/Namespace/Office/Office__NAMESPACE__Excel2003Document.html" title="Office::Excel2003Document" class="wiki">Office::Excel2003Document</a><br />
<a href="/Api/Namespace/Office/Office__NAMESPACE__Spreadsheet.html" title="Office::Spreadsheet" class="wiki">Office::SpreadSheet</a><br />
<a href="/Api/Namespace/Office/Office__NAMESPACE__Format.html" title="Office::Format" class="wiki">Office::Format</a><br />
<a href="/Api/Namespace/Office/Office__NAMESPACE__Font.html" title="Office::Font" class="wiki">Office::Font</a><br />
<a href="/Api/Namespace/Office/Office Enumerations.html" title="Office Enumerations" class="wiki">Office Enumerations</a><br />
<a href="Perform Common Spreadsheet Operations.html" title="How to perform common spreadsheet operations" class="wiki">How to perform common spreadsheet operations</a><br />
<a href="/Api/Namespace/Office/Office Example__COLON__ Hello, World spreadsheet.xml" title="Office Example: Hello, World spreadsheet" class="wiki">Office Example: Hello, World Spreadsheet</a><br />
<a href="/Api/Namespace/Office/Office Example__COLON__ Simple Weekly sales spreadsheet.xml" title="Office Example: Simple Weekly sales spreadsheet" class="wiki">Office Example: Simple Weekly sales spreadsheet</a><br />
<a href="/Api/Namespace/Office/Office Example__COLON__ Multiple spreadsheets.xml" title="Office Example: Multiple spreadsheets" class="wiki">Office Example: Multiple Spreadsheets</a><br />
<a href="/Desktop/Guide/Design/Data/DBF/Office Example__COLON__ Spreadsheet from DBF tables.html" title="Office Example: Spreadsheet from DBF tables" class="wiki">Office Example: Spreadsheet from DBF tables</a><br />
<a href="/Api/Namespace/Office/Office Example__COLON__ Spreadsheet with picture.xml" title="Office Example: Spreadsheet with picture" class="wiki">Office Example: Spreadsheet with picture</a><br />
<a href="/Api/Namespace/Office/Office Example__COLON__ Update a spreadsheet.xml" title="Office Example: Update a spreadsheet" class="wiki">Office Example: Update a spreadsheet</a><br />
<a href="../Schema/SQL Example__COLON__ Spreadsheets from SQL schema.html" title="SQL Example: Spreadsheets from SQL schema" class="wiki">SQL Example: Spreadsheets from SQL schema</a><br />
<br />

	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:Office+Example%3A+Spreadsheet+from+SQL+query">-->


	 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA:{"tags":"common,review","status":"pending","notes":"Example needs more context","keywords":"sql"}--->
</body></html>