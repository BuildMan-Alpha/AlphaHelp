<page>
    <topic>Image Upload</topic>
    <description>Upload an image file to the server.</description>
    <sections>
        <section>
            <description>Used with the Grid and UX components. First it is necessary to add an image to the component.</description>
        </section>
        <section>
            <title>Application type</title>
        <list>
            <item>
                <name>Application type</name>
                <description>Specify where the application will be running.</description>
            </item>
            
        </list>
        
        </section>
          <section>
            <title>Image File Upload</title>
        <list>
            <item>
                <name>Image field</name>
                <description>Specify the name of the field in the component that will display the uploaded image.</description>
            </item>
             <item>
                <name>Scale image</name>
                <description>You can optionally scale the image before it is saved on the server, or embedded in a component field.</description>
            </item>
             <item>
                <name>Allowed image filename extensions</name>
                <description>Specify a comma delimited list of allowed filename extensions. If the user uploads 
                    a file that does not match an allowed extension, the operation is aborted.
                </description>
            </item>
             <item>
                <name>Invalid extension error message</name>
                <description>The message to display when the selected file is not an allowed file type.</description>
            </item>
             <item>
                <name>Upload target</name>
                <description>Specify if the image should be uploaded to the Alpha Anywhere server, or to a cloud storage provider (e.g. Amazon S3). </description>
            </item>
             <item>
                <name>Upload folder</name>
                <description>Specify the name of the folder where the uploaded image file will be stored. 
                    You can use aliases in the name. If you enter a folder without a drive letter, the folder 
                    is assumed to be in the webroot. Important: The folder that you specify here is a folder on the machine 
                    where your Application Server is running, not a folder on this machine. VERY IMPORTANT: If you have 
                    the Security Framework turned on and the upload folder is in the webroot, be sure to set the appropriate 
                    permissions for this upload folder and the files that it contains. You can use a session variable to specify 
                    the uploaded folder.
                </description>
            </item>
             <item>
                <name>File exists action</name>
                <description>If the file that was uploaded already exists in the Upload folder, what action should be taken. 
                    You can either overwrite the existing file, or rename the uploaded file.
                </description>
            </item>
             <item>
                <name>Embedded Image format</name>
                <description>Specify the image format to use for the embedded image. All embedded images must be stored 
                    in the same format. So, for example, if the user uploads a .bmp image and the Embedded Image Format is 
                    JPG, the image will be converted to JPG before it is stored in the database.
                </description>
            </item>
             <item>
                <name>Stored filename transformation expression</name>
                <description>Specify what value to store in the image field. This is typically some transformation of the 
                    uploaded image filename. If you leave this blank, the fully qualified filename is stored in the image 
                    field.
                </description>
            </item>
             <item>
                <name>On Stored filename compute Xbasic function</name>
                <description>(Optional) If you want complete control over the filename of the uploaded image, you can 
                    call an Xbasic function to compute the filename.
                </description>
            </item>
             <item>
                <name>Maximum file size</name>
                <description>Specify the maximum file size that can be uploaded. Specify value in bytes. Specify 0 if you do not want to restrict 
                    the size of the file that can be uploaded. IMPORTANT: Regardless of this setting, the server also specifies 
                    a maximum POST body size. The lower of this setting and your setting for this property will apply.
                </description>
            </item>
             <item>
                <name>Maximum file size exceeded message</name>
                <description>Specify the message to display to the user if the uploaded file exceeds the maximum allowed file size.</description>
            </item>
             <item>
                <name>Create image thumbnails</name>
                <description>Specify if the image thumbnails should be created from the uploaded image? You can create 
                    multiple thumbnails in different sizes.
                </description>
            </item>
             <item>
                <name>Show progress/ allow cancel</name>
                <description>On certain browsers it is possible to show progress while files are being uploaded and to allow the user to cancel the operation. 
                    IE9 and earlier does not support this feature.
                </description>
            </item>
             <item>
                <name></name>
                <description></description>
            </item>
             <item>
                <name></name>
                <description></description>
            </item>
             <item>
                <name></name>
                <description></description>
            </item>
             <item>
                <name></name>
                <description></description>
            </item>
             <item>
                <name></name>
                <description></description>
            </item>
             <item>
                <name></name>
                <description></description>
            </item>
            
        </list>
        
        </section>
          <section>
            <title></title>
        <list>
            <item>
                <name></name>
                <description></description>
            </item>
            
        </list>
        
        </section>
          <section>
            <title></title>
        <list>
            <item>
                <name></name>
                <description></description>
            </item>
            
        </list>
        
        </section>
          <section>
            <title></title>
        <list>
            <item>
                <name></name>
                <description></description>
            </item>
            
        </list>
        
        </section>
        
        <section>
            <title>Thumbnails</title>
            <description>The Action Javascript builder has an option in the Thumbnail Definition Builder that allows you to specify if the thumbnail file that is created should overwrite an existing file, or be renamed, so as not to conflict with existing files.</description>
        </section>
        <section>
            <description>When you define how thumbnails are to be created, you can specify if the thumbnail is to be stored as a file on disk, or as binary data in a record. In the case where you specify a file on disk, the builder allows you to specify a 'suffix' that is automatically added to the filename. For example if the suffix is 'thumb1', then the file on disk might called 'image_thumb1.jpg'. However, there may be situations where you don't want the suffix. If you set the suffix to a blank value, the file on disk has no suffix at all (e.g. 'image.jpg').</description>
            <note>Prior to Alpha Five Version 12, setting the suffix to a blank value would result in the file on disk being created as 'image_.jpg'.</note>
        </section>
        <section>
            <description>Of course, if you set the suffix to a blank value, the upload folder for the thumbnails needs to be different than the upload folder for the main image you are uploading, or else when the thumbnail is created, it will overwrite the main image.</description>
        </section>
        <section>
            <title>Filename for Uploaded File</title>
            <description>
                <p>When you upload an image or a file to a target character field (rather than a binary field), the uploaded file is saved in a file in the UploadFolder (defined in the builder) and the filename of the file is saved in the target character field. The filename is derived from the filename of the file on the client machine.</p>
                <p>A property in the builder allows you to define an Xbasic function in which you can compute the filename to use for the uploaded file.</p>
                <p> As shown in the screenshot below, the new 'OnStoredFilename Compute Xbasic Function' property allows you to define the name of an Xbasic function. The Xbasic function exposes the 'e' object which has these properties:</p>
            </description>
            <list>
                <item>
                    <name-title>Property</name-title>
                    <description-title>Description</description-title>
                </item>
                <item>
                    <name>e.targetFileName</name>
                    <description>the filename for the uploaded file (computed based on the setting for the UploadFolder and the name of the file on the client machine</description>
                </item>
                <item>
                    <name>e.imageBinaryData</name>
                    <description>binary data that was uploaded</description>
                </item>
            </list>
        </section>
        <section>
            <description>You Xbasic function can change the value in the e.targetFileName property. If you do change this value, the uploaded flle will be stored in the filename specified by the new value in e.targetFileName</description>
            <important>The transformation expression (defined in Action Javascript at design time) will be applied to whatever value is in e.targetFilename. So, if your event handler changes the value in e.targetFilename, the transformation expression is applied to this new value.</important>
        </section>
        <section>
            <description>Your code can optionally set a value for e.storedValue property in the e object. If you set the e.storedValue property, this value will be stored in the target field in the record (and the transformation expression will be ignored).</description>
            <figure>
                <link>images/storedfilenamecompute.jpg</link>
            </figure>
        </section>

        <section>
            <title>File Rename</title>
            <description>When you upload images or files and store the uploaded images or files in a filename on a server, there is an option to rename the file if there is an existing file with the same name on the server. Here is how the algorithm that computes the filename in the case of a conflict works. If a filed called "c:\myimages\image1.jpg" exists and you want to create a new file called 'image1.jpg', the new file will be called "c:\myimages\myimage1_1.jpg".</description>
        </section>
        <section>
            <title>Xbasic Event Handlers - Control Values</title>
            <description>In a UX component, when the server-side Xbasic events defined in the Action Javascript builder fire, the control values for all of the controls on the UX are available to the Xbasic code. For example, assume that the UX had a control called 'FIELD1'. In the Xbasic event handlers, you can reference this value as follows</description>
            <example><![CDATA[request.variables.v.r1.field1]]></example>
        </section>
        <section>
            <title>Image Upload in a UX Component</title>
            <description>
                <p>You can upload to an Image control on the component that is, or is not, data bound.</p>
                <p>If you upload to a 'data bound' image, then when you submit the UX component, the image field in the table is updated. Watch the video below to learn more.</p>
            </description>
            <videos>
                <video>
                    <name>Watch Video</name>
                    <link>http://www.ajaxvideotutorials.com/V12Videos/UX_ImageUpload.swf</link>
                </video>
            </videos>
        </section>
        <section>
            <description>
                <p>If you upload to a 'non-data-bound' image control, then when you submit the UX component, your event handler can choose what to do with the uploaded image. Watch the videos below to learn more.</p>
            </description>
            <videos>
                <video>
                    <name>Watch Video - Part 1</name>
                    <link>http://www.ajaxvideotutorials.com/V12Videos/UXComponent_UploadingImagesToNonDataBoundControls.swf</link>
                </video>
                <video>
                    <name>Watch Video - Part 2</name>
                    <link>http://www.ajaxvideotutorials.com/V12Videos/UXComponent_UploadingImagesToNonDataBoundControls_part2.swf</link>
                </video>
            </videos>
        </section>
        <section>
            <description>
                <p>In the case where you upload an image to a non-data bound image control, the afterDialogValidate event needs to load the image from its saved location and store the image in its final destination on the server - either on disk or in a database.</p>
                <p>The code example below demonstrates how to get the uploaded image. This example assumes the image was uploaded for an Image control called 'MYIMAGE':</p>
            </description>
            <example><![CDATA[dim blobKey as c
'Every image control has an associated control with a '_hiddena5fn' name.
'After the image has been uploaded, it is stored in temporary session storage
'The 'key' for the data in session storage is stored in this hidden field.

blobKey = e.dataSubmitted.myimage_hiddena5fn
blobKey = word(blobKey,1,":")

dim blobUploaded as b
Session.GetDataFromFile(blobUploaded,blobKey)
Session.DeleteSessionFile(blobKey)

'You now have the uploaded image data in a variable called 'blobUploaded'
'Your event handler can process this data.]]></example>
        </section>
        <section>
            <description>
                <p>You can also upload images to image controls in Repeating Sections. Watch the video below to learn more.</p>
            </description>
            <videos>
                <video>
                    <name>Watch Video</name>
                    <link>http://www.ajaxvideotutorials.com/V12Videos/UXComponent_DataBoundImagesInRepeatingSection.swf</link>
                </video>
            </videos>
        </section>
    </sections>
</page>