<page>
<group>JSON Functions</group>
<topic>a5_sql_nested_query_to_json_document()</topic>
<syntax>
P result = a5_sql_nested_query_to_json_document( P options, SQL::Arguments Args)
</syntax>
<arguments>
	<argument>
		<name>hasError</name>
		<description>.t. or .f. depending on whether the function returns an error.</description>
	</argument>
	<argument>
		<name>errorText</name>
		<description>the error text if hasError is .t.</description>
	</argument>
	<argument>
		<name>data </name>
		<description>the JSON data returned by the function</description>
	</argument>
	<argument>
		<name>options</name>
		<description>The options object that is passed into the function has these properties:
</description>
		<list>
			<item>
				<name>options.connectionString</name>
				<description>The connection string for the query. This is an optional property. You can also specify a query string to use for each nested query. If you do not specify options.connectionString, then you MUST specify a connection string for each query. Typically, you will querying against a single database, and so it is most efficient to specify the options.connectionString parameter and NOT specify a connection string for each SQL statement.</description>
			</item>
				<item>
				<name>options.SQL</name>
				<description>a CRLF delimited list of SQL statements to execute. The indentation in the parameter indicates the hierarchy of the query. See below for more details.</description>
			</item>
				<item>
				<name>options.flagUseSubSelects </name>
				<description>Indicates if child SQL queries use a SQL Sub-select in the WHERE clause. If you are querying against a single database then this is the most efficient option. If each query specifies its own connection string, then this flag must be set to .f.. </description>
			</item>
			
		</list>
	</argument>
	
	
</arguments>


<description>
The a5_sql_nested_query_to_json_document() Function queries one or more SQL databases and returns a JSON document with the query result. 
</description>
<discussion>
This function is inspired by NoSQL databases that return a JSON document with a query result. The JSON document return by such a query often contains nested JSON documents. For example for each customer, show orders for that customer, and for each order, show order details for that order.
</discussion>
<sections>
<section>
	<title>Example</title>
<description>
	For example, here is a sample JSON document returned by this function showing customers, nested orders, and nested order details:
</description>
<example><![CDATA[
{
    "customer": [
        {
            "customerId": "HUNGO",
            "companyName": "Hungry Owl All-Night Grocers",
            "orders": [
                {
                    "orderid": "10298",
                    "customerid": "HUNGO",
                    "value": "10298",
                    "orderDetails": [
                        {
                            "OrderID": "10298",
                            "ProductID": "2",
                            "UnitPrice": "15.2",
                            "Quantity": "40",
                            "Discount": "0"
                        }
                    ]
                },
                {
                    "orderid": "10309",
                    "customerid": "HUNGO",
                    "value": "10309",
                    "orderDetails": [
                        {
                            "OrderID": "10309",
                            "ProductID": "4",
                            "UnitPrice": "17.6",
                            "Quantity": "20",
                            "Discount": "0"
                        },
                        truncated for brevity....
	
]]></example>
</section>
</sections>
<see>
	<ref href="/Api/Functions/Document Types/JSON Functions/a5_merge_json_into_template().xml">a5_merge_json_into_template()</ref>
	<ref href="/Api/Functions/Document Types/JSON Functions/a5_url_from_storagejsonformat().xml">a5_url_from_storagejsonformat()</ref>
	<ref href="/Server/Guide/Design/Api/JSON Data.xml">JSON Data</ref>
</see>


<terms>JSON,a5,contains,database,function,nosql,query,sql</terms>



</page>