	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<h1 class="showhide_heading" id="SQL_Database_Snapshots">SQL Database Snapshots</h1>
With databases being central to any business application, it is inevitable that the design will change many times before delivering a software solution; adding a good deal of time and cost to the development cycle.  Test data, sample data, and initial values for published databases all take time to create and maintain.  For test suites to behave properly, the database may need to be reset to some consistent state.  Sample databases often need to be restored to a pristine condition, ready for the next demonstration.  When a customer installs your application’s database, they will need to define the tables and populate initial values; and that customer’s database may be Microsoft SQL Server, Oracle, DB2, MySQL, or any one of a number of other databases.<br />
<br />
This article discusses the SQL Snapshot objects in Alpha Five.  Snapshots store database definitions and data in a single object that can be created from a live database, persisted to and read back from XML, and can be used to create or re-load a database on any supported target of Alpha Five Data Access Objects (AlphaDAO).<br />
<br />
<div class="clearfix rbox note"><img src="images/close.png" alt="Close" width="16" height="16" class="rbox-close" onclick="$(this).parent().fadeOut();" title="Close" /><div class="rbox-title"><img src="images/information.png" alt="note" width="16" height="16" title="note" class="icon" /><span>Note</span></div><div class="rbox-data">The examples presented here assume that you are familiar with XBasic scripting of SQL objects in Alpha Five.  For brevity, we will emphasize the specific tasks required to manage snapshots.</div></div><br />
<h2 class="showhide_heading" id="A_Quick_XBasic_Example">A Quick XBasic Example</h2>
Let's start with a quick example.  Suppose that you have been creating the next great Contact Management software application.  The database for your application has tables named Contact, Address, Appointment and Meeting Notes; pretty basic, but you need to get a proof of concept to your investors.<br />
<br />
The first thing to do is to create a snapshot of the existing state of your database.  The script below connects to your database, extracts a complete snapshot of all tables and saves the snapshot to a disk file.  As with all of the samples shown here, error checking is omitted for readability.<br />
<br />
<div class="plugincode" ><pre class="codelisting" data-syntax="" dir="ltr" style="overflow:auto;" id="codebox" >dim cn as SQL::Connection
dim sn as SQL::DatabaseSnapshot
cn.open("::Named::MyDatabase")			'Open the source database
sn.load(cn)					'Take a snapshot of user tables
file.from_string("&lt;MyFile&gt;", sn.XML) 		'Save the snapshot as XML</pre></div><br />
<br />
The snapshot data is stored in a database neutral format, so we can take our snapshot and load it into a new database with a script like the one below.<br />
<br />
<div class="plugincode" ><pre class="codelisting" data-syntax="" dir="ltr" style="overflow:auto;" id="codebox1" >Dim cn2 as SQL::Connection
Dim sn2 as SQL::DatabaseSnapshot
cn2.open("::Named::TargetDatabase")		'Open the target database
sn2.XML = file.to_string("&lt;MyFile&gt;")		'Load the XML file into the snapshot
sn2.Store(cn2)					'Create the tables and load the data</pre></div><br />
<br />
<div class="clearfix rbox note"><img src="images/close.png" alt="Close" width="16" height="16" class="rbox-close" onclick="$(this).parent().fadeOut();" title="Close" /><div class="rbox-title"><img src="images/information.png" alt="note" width="16" height="16" title="note" class="icon" /><span>Note</span></div><div class="rbox-data">A snapshot is an in-memory object.  It is intended for test, initial and sample databases.  If your data size exceeds the amount of memory available to Alpha Five, the snapshot may still load, but the performance will be severely degraded and you can expect the process to take a very long time and to result in a very large text file.</div></div><br />
<h2 class="showhide_heading" id="The_Objects_Behind_Snapshots">The Objects Behind Snapshots</h2>
If creating that snapshot all seemed just a little too easy; you are right.  There is a lot of work that the snapshot is doing for you automatically.  The script above may be all you ever need, but we are going to take a little deeper look at the way the snapshot works and explore some other options that may be helpful.<br />
<br />
<a href="javascript:void(0)" class="internal" onmouseover="return convertOverlib(this,'&nbsp;',['WIDTH=396','HEIGHT=370','BACKGROUND=img/wiki_up/sql_database_snapshot_schema.png']);">	<img src="images/sql_database_snapshot_schema.png" height="185" width="198" alt="Image" /></a><br />
<br />
As you have already seen, there is an object called <strong>SQL::DatabaseSnapshot</strong>.  A DatabaseSnapshot can hold both the definition and the data for a complete schema (set of tables) in a database.  The schema includes primary and foreign key references as well as additional indexes.<br />
<br />
In the first example, we asked the DatabaseSnapshot object to load the entire set of tables on a specific database connection into the snapshot object.  We can also choose a subset of tables to include in the snapshot by constructing a schema object and passing the schema to the load function.<br />
<br />
In addition to a complete copy of the schema and the relationships between the tables, the DatabaseSnapshot object manages a collection of <strong>SQL::TableSnapshot</strong> objects that each contain a copy of the definition of the table they represent and the data from that single table.  There is one instance of SQL::TableSnapshot for each table loaded into the DatabaseSnapshot.<br />
<br />
The data for each TableSnapshot is managed as a collection of <strong>SQL::RowSnapshot</strong> objects.  Each RowSnapshot object contains a collection of <strong>SQL::ColumnValue</strong> objects with name, value and is-null properties for individual columns in the row.<br />
<br />
Although a single call to Load or Store on a DatabaseSnapshot is sufficient in most cases, you can take complete control at any level and read or populate a snapshot or modify the definitions and data using XBasic scripting.<br />
<h2 class="showhide_heading" id="Examples_and_References">Examples and References</h2>
<!--depth: 0-->
<ul class="toc">

	<li class="toclevel"><a href="SQL Database Snapshots V11/SQL__NAMESPACE__DatabaseSnapshot Example__COLON__ Selected Tables.html" class="link" title="">SQL::DatabaseSnapshot Example: Selected Tables</a>
	</li>

	<li class="toclevel"><a href="SQL Database Snapshots V11/SQL__NAMESPACE__TableSnapshot Example__COLON__ A Single Table.html" class="link" title="">SQL::TableSnapshot Example: A Single Table</a>
	</li>

	<li class="toclevel"><a href="SQL Database Snapshots V11/SQL__NAMESPACE__TableSnapshot Example__COLON__ Scripting the Load.html" class="link" title="">SQL::TableSnapshot Example: Scripting the Load</a>
	</li>

	<li class="toclevel"><a href="SQL Database Snapshots V11/SQL__NAMESPACE__DatabaseSnapshot Object.html" class="link" title="">SQL::DatabaseSnapshot Object</a>
	</li>

	<li class="toclevel"><a href="SQL Database Snapshots V11/SQL__NAMESPACE__TableSnapshot Object.html" class="link" title="">SQL::TableSnapshot Object</a>
	</li>

	<li class="toclevel"><a href="SQL Database Snapshots V11/SQL__NAMESPACE__RowSnapshot Object.html" class="link" title="">SQL::RowSnapshot Object</a>
	</li>

	<li class="toclevel"><a href="SQL Database Snapshots V11/SQL__NAMESPACE__ColumnValue Object.html" class="link" title="">SQL::ColumnValue Object</a>
	</li>

	<li class="toclevel"><a href="SQL Database Snapshots V11/SQL__NAMESPACE__DatabaseSnapshot Event Scripts and Snapshot Functions.html" class="link" title="">SQL::DatabaseSnapshot Event Scripts and Snapshot Functions</a>
	</li>
</ul>

<br />
<br />

	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:SQL+Database+Snapshots+V11">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 --></body></html>