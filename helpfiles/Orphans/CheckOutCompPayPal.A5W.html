	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<p class=A3Topic>CheckOutCompPayPal.A5W</p>



<p class=A5>Purpose</p>



<p>The CheckOutCompPayPal.A5W page is a variation of the <a href="CHECKOUTCOMP.A5W.html" title="CHECKOUTCOMP.A5W" class="wiki">CHECKOUTCOMP.A5W</a> 
 page that illustrates a technique for using <span class=Screen>PayPal</span> 
 for electronic payments.</p>



<p class=A5>Description</p>



<p>We built the CheckOutCompPayPal.A5W page using an HTML editing program. 
 The page illustrates what you can do without using a component to display 
 data. The values in various fields are populated with session variables. 
 The page includes an optional section to require a password if the customer 
 information indicates this is a new customer. The page has client side 
 validation using JavaScript, using the standard Alpha Five <span class=Code1>a5_html_csv.js</span> 
 JavaScript file.</p>



<p>CheckOutCompPayPal.A5W contains the <a href="NAV_MAIN Navigation Component.html" title="NAV_MAIN Navigation Component" class="wiki">NAV_MAIN</a> 
 navigation component.</p>



<p class=A5>Links</p>



<p>The <a href="CHECKOUTUSER.A5W.html" title="CHECKOUTUSER.A5W" class="wiki">CHECKOUTUSER.A5W</a> page displays 
 the CheckOutCompPayPal.A5W page.</p>



<p class=Pix><img src="images/ASW_CHECKOUTCOMPPAYPAL_A5W.gif"
					x-maintain-ratio=TRUE
					style="border-left-style: Solid;
							border-left-width: 1px;
							border-right-style: Solid;
							border-right-width: 1px;
							border-top-style: Solid;
							border-top-width: 1px;
							border-bottom-style: Solid;
							border-bottom-width: 1px;
							width: 608px;
							height: 667px;
							float: none;"
					width=608
					height=667
					border=1></p>



<p class=PixCaption>CheckOutCompPayPal.A5W in the WYSIWYG tab of the HTML 
 Editor </p>



<p class=Pix><img src="images/ASW_CHECKOUTCOMPPAYPAL_A5W_2.gif"
					x-maintain-ratio=TRUE
					style="border-left-style: Solid;
							border-left-width: 1px;
							border-right-style: Solid;
							border-right-width: 1px;
							border-top-style: Solid;
							border-top-width: 1px;
							border-bottom-style: Solid;
							border-bottom-width: 1px;
							float: none;
							width: 608px;
							height: 381px;"
					width=608
					height=381
					border=1></p>



<p class=PixCaption>CheckOutCompPayPal.A5W in the Browser </p>



<p class=A5>Page Source</p>



<p>The page script begins by checking the status of several protected variables. 
 If <span class=Code1>session.<strong>protected</strong>chkoutprogress</span> does not 
 exist, it means that the first checkout page was not completed. If <span 
 class=Code1>session.<strong>protected</strong>chkoutprogress</span> is less than 2, 
 it means that the second checkout page was not completed. In both cases, 
 the user is redirected to <a href="CHECKOUTCART.A5W.html" title="CHECKOUTCART.A5W" class="wiki">CHECKOUTCART.A5W</a>.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if eval_valid("session.<strong>protected</strong>chkoutprogress") 
 = .F.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>elseif session.<strong>protected</strong>chkoutprogress &lt 2</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>end if</td></tr>
</table>

<p>If <span class=Code1>session.<strong>protected</strong>chkout</span> is FALSE (.F.), 
 it means there were no values passed from page 2. If <span class=Code1>session.<strong>protected</strong>chkout.first_name</span> 
 is NULL, the required first_name field was not entered. In both cases, 
 the user is redirected to <a href="CHECKOUTCART.A5W.html" title="CHECKOUTCART.A5W" class="wiki">CHECKOUTCART.A5W</a>.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if eval_valid("session.<strong>protected</strong>chkout") = 
 .F. 'no values passed from page 2</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>elseif session.<strong>protected</strong>chkout.first_name = "" 
 'no values passed from page 2 (first_name was required)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>end if</td></tr>
</table>
<p>The <span class=Code1>a5w_include("loggedinvalues.a5w")</span> statement runs the code on the <a href="LOGGEDINVALUES.A5W.html" title="LOGGEDINVALUES.A5W" class="wiki">LOGGEDINVALUES.A5W</a> 
 page. This page creates and sets the values of <span class="Code1">session.<strong>protected</strong>pUser.userid, session.<strong>protected</strong>pUser.type</span>,  and <span class="Code1">session.<strong>protected</strong>pUser.name</span>.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>a5w_include("<span class="Code1">loggedinvalues</span>.a5w")</td></tr>
</table>

<p>After the user clicks the submit button ("Complete and Ship Order"), 
 the following code checks to see if each variable that should be returned 
 from the page exists. The names of the variables are listed in <span class=Code1>page_vars</span>. 
 The <a href="../References/Xbasic/FOR EACH __ELLIPSES__ NEXT.html" title="FOR EACH ... NEXT" class="wiki">FOR EACH ... NEXT</a> 
 loop goes through this list and appends the variables that exist to the 
 <span class=Code1>session.<strong>protected</strong>chkout</span> dot variable.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>page_vars = &lt&lt%text%</p>


<p class=Code>total</p>


<p class=Code>delivery_by</p>


<p class=Code>print_inv</p>


<p class=Code>%text%</p>


<p class=Code>for each var in page_vars</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if 
 eval_valid(var) = .T. &nbsp;&nbsp;'variable 
 value was returned to page on submit</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval("session.<strong>protected</strong>chkout." 
 + var) = eval(var)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval("session.<strong>protected</strong>chkout." 
 + var) = "" ' no value passed to page, set blank</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>next</td></tr>
</table>

<p>If the confirm variable does not exist, this code creates it and assigns 
 it a NULL value.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if eval_valid("confirm") = .F.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;confirm 
 = ""</p>


<p class=Code>end if</td></tr>
</table>

<p>This code determines whether to display the PayPal button. If the customer 
 ID is NULL, the script must show the submit button first in order to enter a new user record. Otherwise, no submit button is needed.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if session.<strong>protected</strong>chkout.customerid = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;show_paypal 
 = .F.</p>


<p class=Code>else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;show_paypal 
 = .T.</p>


<p class=Code>end if</td></tr>
</table>

<p>The following code creates a blank error message in <span class=Code1>error_msg</span>, 
 then evaluates the values placed into <span class=Code1>session.<strong>protected</strong>chkout</span>. 
 If the submit button was pressed and if the <span class=Code1>customerid</span> 
 variable is NULL, this is a new customer. The user will be redirected to the <a href="CHECKOUTREGISTER.A5W.html" title="CHECKOUTREGISTER.A5W" class="wiki">CHECKOUTREGISTER.A5W</a> page to enter their userid and password to register into the system. </p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>error_msg = "&nbsp;"</p>


<p class=Code>if eval_valid("submit")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if session.<strong>protected</strong>chkout.customerid = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("checkoutregister.a5w?pg="+substr(request.script_name,at("/",request.script_name,-1)+1) ) 'redirect to page to check user registration</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</td></tr>
</table>

<p>If there is no error, the PayPal button may appear.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if 
 error_msg = "&nbsp;" ' no errors detected, ok to show PayPal 
 button</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;show_paypal 
 = .T.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>end if</td></tr>
</table>

<p>The script then checks the value of <span class=Code1>show_paypal</span> 
 and <span class=Code1>session.<strong>protected</strong>chkoutprogress</span> 
 to determine whether to go to the next page. It then sets the values of 
 the <span class=Code1>paypal_acct</span> (your email address from your 
 <span class=Screen>PayPal</span> merchant account), <span class=Code1>paypal_this</span> 
 (the current page), and <span class=Code1>paypal_next</span> (the next 
 page) variables. If it is not prepared to display the PayPal button, it 
 redirects the user to <a href="../Unclassified/PROCESSING.HTM.html" title="PROCESSING.HTM" class="wiki">PROCESSING.HTM</a>.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if show_paypal = .T.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;session.<strong>protected</strong>chkoutprogress 
 = 3</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;paypal_acct 
 = "company@email.com"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;paypal_this 
 = "http://" + request.host + request.script_name</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;paypal_next 
 = "http://" + request.host + substr(request.script_name, 1, 
 at("/", request.script_name, -1) ) + "processing.htm"</p>


<p class=Code>else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;paypal_acct 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;paypal_this 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;paypal_next 
 = ""</p>


<p class=Code>end if</td></tr>
</table>

<p>The current "cart" (or order) is identified 
 by the session cookie that contains cart_id</span>. 
 This code prepares the shopping cart data for display on the page. It 
 retrieves order items from the shop_cart_values</span> 
 set, which links the product</span> and specials</span> 
 tables to the shop_cart</span> table with the product_id</span> linking key. Each invoice line item total 
 requires a selling price. This selling price can come from either the 
 product</span> or specials</span> 
 table. If the item is on "special", the price come from the 
 linked record in the specials</span> table. Otherwise, 
 it comes from the product</span> table.</span></p>



<p>First, get the records for this order. If there are 
 no items, return to <a href="CHECKOUTCART.A5W.html" title="CHECKOUTCART.A5W" class="wiki">CHECKOUTCART.A5W</a>.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>query.filter = "Cart_Id = \"" + cart_id + 
 "\" .and. Quantity > 0"</p>


<p class=Code>query.order = ""</p>


<p class=Code>tbl = table.open("<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\shop_cart_values.set")</p>


<p class=Code>qdx = tbl.query_create()</p>


<p class=Code>if qdx.records_get()= 0 ' no items in cart, go back to page 
 1 of check out</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.close()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>end if</td></tr>
</table>

<p>If the query found records, the following code computes 
 totals. The script steps through the records, placing a count of records 
 into <span class="Code1">cart_kount</span></span>. The script determines where 
 to get the price by examining the values of the Sale_Price</span> 
 and Sale_Until</span> fields in the specials</span> 
 table. If Sale_Price</span> is not zero and Sale_Until</span> 
 contains a NULL value or a date in the future, the item is on special. 
 Otherwise, the price will come from the product</span> 
 table.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>tbl1 = table.get("shop_cart") ' get pointer to 
 parent</p>


<p class=Code>tbl2 = table.get("product") ' get pointer to child</p>


<p class=Code>tbl3 = table.get("specials") ' get pointer to child</p>


<p class=Code>cart_kount = 0 ' counter for number of records</p>


<p class=Code>cart_total = 0 ' total value in cart</p>


<p class=Code>while .not. tbl.fetch_eof()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;cart_kount 
 = cart_kount + 1</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if 
 (tbl3.Sale_Price > 0) .and. (tbl3.Sale_Until >= date().or. cdate(tbl3.Sale_Until) 
 = "") ' product is on special</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cart_total 
 = cart_total + (tbl3.Sale_Price * tbl1.Quantity)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cart_total 
 = cart_total + (tbl2.Retail * tbl1.Quantity)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl.fetch_next()</p>


<p class=Code>end while</p>


<p class=Code>tbl.close()</td></tr>
</table>

<p>The code computes the text ( item_kount</span> 
 ) that says how many items are in the order.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if cart_kount = 1</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;item_kount 
 = "1 Item"</p>


<p class=Code>else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;item_kount 
 = alltrim( str(cart_kount) )+" Items"</p>


<p class=Code>end if</td></tr>
</table>

<p>Next, the script determines the customer's choice 
 of shipping method. The ship_list</span> variable will 
 contain the list of shipping alternatives. Each entry is composed of two 
 strings: ship_code</span> and delivery_by</span> 
 separated by a pipe (|) character.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>ship_list = table.external_record_content_get("<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\shipping_types", 
 "alltrim(ship_code) + \"|\" + alltrim(delivery_by)", 
 "sort_ord")</p>


<p class=Code>if session.<strong>protected</strong>chkout.delivery_by = "" 
 ' no value set / passed from page</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;session.<strong>protected</strong>chkout.delivery_by 
 = "0008" ' current default is 'UPS Ground'</p>


<p class=Code>end if</td></tr>
</table>

<p>The <a href="../References/Functions/A5_HTML_LIST_POPULATE Function.html" title="A5_HTML_LIST_POPULATE Function" class="wiki">A5_HTML_LIST_POPULATE(</a>) 
 converts ship_list</span> into the format required for 
 a drop-down list on the page and stores the result in ship_drop</span>.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>ship_drop = a5_html_list_populate(ship_list, session.<strong>protected</strong>chkout.delivery_by, 
 3)</td></tr>
</table>

<p>This code calculates the shipping cost with a lookup 
 into the shipping_types</span> table. It composes a 
 filter using ship_code</span> and session.<strong>protected</strong>chkout.delivery_by</span> 
 and returns the base_price</span> field.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>ship_cost = val(table.external_record_content_get("<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\shipping_types", 
 "base_price", "", "ship_code = \"" 
 + session.<strong>protected</strong>chkout.delivery_by + "\"") )
<p class=Code>session.<strong>protected</strong>chkout.ship_cost = ship_cost</td></tr>
</table>

<p>There is no tax table available, therefore the tax 
 is set to 0. A developer could use a technique comparable to the shipping 
 cost lookup to return a tax value.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>sales_tax = 0</td></tr>
</table>

<p>The script computes the total_sale</span> 
 value.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>total_sale = cart_total + ship_cost + sales_tax</td></tr>
</table>

<p>This code prepares some values for display using the 
 current values in the session variables.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>bill_address = alltrim(session.<strong>protected</strong>chkout.addr1) 
 + if(session.<strong>protected</strong>chkout.addr2 = "", "", "&ltbr>" 
 + alltrim(session.<strong>protected</strong>chkout.addr2) )</p>


<p class=Code>ship_address = alltrim(session.<strong>protected</strong>chkout.ship_to_address) 
 + if(session.<strong>protected</strong>chkout.saddr2 = "", "", 
 "&ltbr>" + alltrim(session.<strong>protected</strong>chkout.saddr2) )</p>


<p class=Code>bill_city_state = alltrim(session.<strong>protected</strong>chkout.city) 
 + "&nbsp;" + alltrim(session.<strong>protected</strong>chkout.state) 
 + "&nbsp;"+alltrim(session.<strong>protected</strong>chkout.zip)</p>


<p class=Code>ship_city_state = alltrim(session.<strong>protected</strong>chkout.ship_to_city) 
 + "&nbsp;" + alltrim(session.<strong>protected</strong>chkout.ship_to_state) 
 + "&nbsp;" + alltrim(session.<strong>protected</strong>chkout.ship_to_zip)</p>


<p class=Code>print_inv_chked = if(session.<strong>protected</strong>chkout.print_inv="true", 
 "checked=\"checked\"", "")</td></tr>
</table>

<p>The location = ""</span> 
 statement clears any highlighted selection on the menu. The style_name 
 = "shopcart"</span> statement sets the style of the navigation 
 component. The pgstyle = tmpl_NAV_MAIN.style_name</span> 
 statement saves the style of the navigation component in pgstyle</span>.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>with tmpl_NAV_MAIN</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;location 
 = "" 'could set current tab HERE</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;style_name 
 = "shopcart" 'could override style HERE</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;componentName 
 = "NAV_MAIN"</p>


<p class=Code>end with</p>


<p class=Code>pgstyle = tmpl_NAV_MAIN.style_name</td></tr>
</table>

<p>When you click the Complete Order button, this code 
 displays a confirmation message.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>&lt%a5 if show_paypal = .T. %></p>


<p class=Code>&nbsp;&nbsp;<span class=HTML1>&lttr></span></span></p>


<p class=Code><span class=HTML1><span class=HTML1>&nbsp;&nbsp;&nbsp;&nbsp;&lttd>&lt/td></span></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;
  
  &lttd>&nbsp;&lt/td></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;
  
  &lttd 
 align="left" valign="top">&lttable width="100%" 
 border="0" cellspacing="0" cellpadding="0"></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &lttr></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &lttd 
 width="55%">&nbsp;&lt/td></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &lttd>&lt!-- 
 Uncomment this section to activate PayPal</span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltform 
 action="https://www.paypal.com/cgi-bin/webscr" method="post"></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltinput 
 type="hidden" name="cmd" value="_cart" /></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltinput 
 type="hidden" name="upload" value="1" /></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltinput 
 type="hidden" name="business" value=" 
 &lt%a5 ?paypal_acct %> " /></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltinput 
 type="hidden" name="amount_1" value=" 
 &lt%a5 ?alltrim(str(cart_total,12,2) )%> " /></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltinput 
 type="hidden" name="item_name_1" value="Web Sale" 
 /></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltinput 
 type="hidden" name="shipping_1" value=" 
 &lt%a5 ?alltrim( str(ship_cost,12,2) )%> " /></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltinput 
 type="hidden" name="return" value=" &lt%a5 
 ?paypal_next %> " /></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltinput 
 type="hidden" name="cancel_return" value=" 
 &lt%a5 ?paypal_this %> " /></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  --></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &ltinput 
 type="image" src="http://www.paypal.com/en_US/i/btn/x-click-but01.gif" 
 name="submit" alt="Make payments with PayPal - it's fast, 
 free and secure!" /></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &lt!-- 
 Uncomment this section to activate PayPal</span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &lt/form></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  --></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &lt/td></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &lt/tr></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  
  &lt/table>&lt/td></span></p>


<p class=Code><span class=HTML1>
  
  &nbsp;&nbsp;
  
  &lt/tr></span></p>


<p class=Code><span class=HTML1>&lt%a5 end if %></span></td></tr>
</table>

<p class=Pix><img src="images/ASW_CHECKOUTCOMPPAYPAL_A5W_3.gif"
									x-maintain-ratio=TRUE
									style="border-left-style: Solid;
											border-left-width: 1px;
											border-right-style: Solid;
											border-right-width: 1px;
											border-top-style: Solid;
											border-top-width: 1px;
											border-bottom-style: Solid;
											border-bottom-width: 1px;
											width: 608px;
											height: 356px;
											float: none;"
									width=608
									height=356
									border=1></span></p>



<p class=PixCaption>The Confirmation page of CheckOutCompPayPal.A5W 
 in the Browser </span></p>



<p class=A5>Page Security Information</p>



<p>Always Allowed</p>



<p class=A5>See Also</span></p>



<p><a href="../Tutorials/AlphaSportsWeb Explained (Non-Ajax Web)/AlphaSportsWeb Web Pages.html" title="AlphaSportsWeb Web Pages" class="wiki">Web Pages</a></span></p>






<p class=A5></span></p>
	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:CheckOutCompPayPal.A5W">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA: {"tags":"web","group":"/References/Server/Pages"} --->
</body></html>