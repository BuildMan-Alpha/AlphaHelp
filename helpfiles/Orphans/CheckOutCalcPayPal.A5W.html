	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<p class=A3Topic>CheckOutCalcPayPal.A5W</p>



<p class=A5>Purpose</p>



<p>The CheckOutCalcPayPal.A5W page is a variation of the <a href="CHECKOUTCALC.A5W.html" title="CHECKOUTCALC.A5W" class="wiki">CHECKOUTCALC.A5W</a> 
 page that illustrates a technique for using <span class=Screen>PayPal</span> 
 for electronic payments.</p>



<p class=A5>Description</p>



<p>The CheckOutCalcPayPal.A5W page does all of the processing to complete 
 a sale. It runs in the MainFrame or body section of a frameset. The top 
 section of the frameset loads first and shows a message that the page 
 is processing.</p>



<p>If the customer checkout process is complete and there are no errors, 
 CheckOutCalcPayPal.A5W page does the processing to read the data from 
 the shopping cart and complete a sale.</p>



<p>CheckOutCalcPayPal.A5W includes Xbasic code to save data to the <span 
 class=Code1>customer</span>, <span class=Code1>invoice_header</span>, 
 and <span class=Code1>invoice_items</span> tables. It also includes code 
 to post the quantity sold to the <span class=Code1>product</span> table 
 to update the quantity in stock.</p>



<p>CheckOutCalcPayPal.A5W will create and send an email message if that 
 option is selected. (deactivated in demo). Another option is to pre-build 
 an invoice report and save it. If a report is saved, a button appears 
 that allows the user to open the report in a separate browser window.</p>



<p class=Note><span class=Note><img src="images/icon_information.gif"
									x-maintain-ratio=TRUE
									style="border: none;
											width: 36px;
											height: 32px;
											float: none;
											border-style: none;
											border-style: none;"
									width=36
									height=32
									border=0>Note</span> : Since this page 
 opens within a frameset, any normal <a href="../References/Methods/RESPONSE.REDIRECT Method.html" title="RESPONSE.REDIRECT Method" class="wiki">RESPONSE.REDIRECT(</a>) 
 will just open the page defined in the body section of the frameset. Any 
 redirect must be sent to a special page <a href="FRAMEEXIT.A5W.html" title="FRAMEEXIT.A5W" class="wiki">FRAMEEXIT.A5W</a> 
 that will 'break out' of the frameset. The name of the page to open after 
 the 'break out' must be in the <span class=Code1>pg</span> parameter.</p>



<p class=A5>Links</p>



<p>The <a href="CheckOutCompPayPal.A5W.html" title="CheckOutCompPayPal.A5W" class="wiki">CheckOutCompPayPal.A5W</a> 
 page displays the <a href="../Unclassified/PROCESSING.HTM.html" title="PROCESSING.HTM" class="wiki">PROCESSING.HTM</a> page, 
 which replaces the CHECKOUTCALC.A5W page in the <span class=Code1>MainFrame</span> 
 section of its frameset.</p>



<p class=Pix><img src="images/ASW_CHECKOUTCALC_A5W.gif"
					x-maintain-ratio=TRUE
					style="width: 728px;
							height: 89px;
							border-left-style: Solid;
							border-left-width: 1px;
							border-right-style: Solid;
							border-right-width: 1px;
							border-top-style: Solid;
							border-top-width: 1px;
							border-bottom-style: Solid;
							border-bottom-width: 1px;
							float: none;"
					width=728
					height=89
					border=1></p>



<p class=PixCaption>CheckOutCalcPayPal.A5W in the WYSIWYG tab of the HTML 
 Editor </p>



<p class=pixcaption><img src="images/ASW_CHECKOUTCALC_A5W_2.gif"
						x-maintain-ratio=TRUE
						style="border-left-style: Solid;
								border-left-width: 1px;
								border-right-style: Solid;
								border-right-width: 1px;
								border-top-style: Solid;
								border-top-width: 1px;
								border-bottom-style: Solid;
								border-bottom-width: 1px;
								width: 655px;
								height: 75px;
								float: none;"
						width=655
						height=75
						border=1></p>



<p class=PixCaption>CheckOutCalcPayPal.A5W in the Browser </p>



<p class=A5>Edits to the Page Source</p>



<p>Initially, the page runs the <span class=Code1>sleep(.5)</span> command, 
 which pauses for .5 seconds to give the top frame time to display.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>sleep(.5)</td></tr>
</table>

<p>Next, the page script tests to see if it has received proper values 
 in the calling URL. If the <span class=Code1>cart_id</span> argument is 
 missing or is NULL, control goes back to <a href="CHECKOUTCART.A5W.html" title="CHECKOUTCART.A5W" class="wiki">CHECKOUTCART.A5W</a>.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if eval_valid("cart_id") = .F.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("frameexit.a5w?pg=checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>elseif cart_id = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("frameexit.a5w?pg=checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>end if</td></tr>
</table>

<p>Next, the script evaluates the protected variable <span class=Code1>session.<strong>protected</strong>chkoutprogress</span>. 
 If it does not exist, the first checkout page was not completed and control 
 goes back to <a href="CHECKOUTCART.A5W.html" title="CHECKOUTCART.A5W" class="wiki">CHECKOUTCART.A5W</a>. If <span 
 class=Code1>session.<strong>protected</strong>chkoutprogress</span> is less than 3 
 (the last page of checkout), then control goes back to CHECKOUTCART.A5W.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if eval_valid("session.<strong>protected</strong>chkoutprogress") 
 = .F.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("frameexit.a5w?pg=checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>elseif session.<strong>protected</strong>chkoutprogress &lt 3</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("frameexit.a5w?pg=checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>end if</td></tr>
</table>

<p>If <span class=Code1>session.<strong>protected</strong>chkout</span> is FALSE (.F.), 
 then no values were passed from page 3 of the checkout and control goes 
 back to CHECKOUTCART.A5W. If <span class=Code1>session.<strong>protected</strong>chkout.first_name</span> 
 is NULL, then the first name field is empty and control goes back to CHECKOUTCART.A5W.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if eval_valid("session.<strong>protected</strong>chkout") = 
 .F. 'no values passed from page 3</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("frameexit.a5w?pg=checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>elseif session.<strong>protected</strong>chkout.first_name = "" 
 'no values passed from page 3 (first_name was required)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("frameexit.a5w?pg=checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>end if</td></tr>
</table>

<p>The code also moves the protected <span class=Code1>session.<strong>protected</strong>chkout</span> 
 variable to <span class=Code1>chkout_vars</span> before any data processing 
 takes place, such&nbsp;as&nbsp;saving a new customer. Afterwards, it deletes 
 <span class=Code1>session.<strong>protected</strong>chkout</span>.</p>



<p>If the user presses the back button <span class=Bolded>after the protected 
 session variable is deleted</span>, no session variables will exist. If 
 the user clicks submit at this point, he or she will be sent back to the 
 beginning of the check out process.</p>



<p>Next, the page script verifies the user's input. If the customer is 
 new, it saves a new customer record. Then, the code creates an <span class=Code1>invoice_header</span> 
 table record. The items in the shopping cart become records in the <span 
 class=Code1>invoice_items</span> table. Finally, the script sends a confirmation 
 email and/or prints an invoice.</p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>dim chkout_vars&nbsp;as&nbsp;P</p>


<p class=Code>property_recurse_assign(chkout_vars, session.<strong>protected</strong>chkout)</p>


<p class=Code>delete session.<strong>protected</strong>chkout 'delete session variable</td></tr>
</table>


<p>The next step is to create a new record in the <span class=Code1>invoice_header</span> 
 table. The <span class=Code1>delivery_by</span> value is determined by 
 looking into the <span class=Code1>shipping_types</span> table and filtering 
 on the delivery code stored in <span class=Code1>chkout_vars.delivery_by</span> 
 variable.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>delivery_by = table.external_record_content_get("<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\shipping_types", 
 "alltrim(delivery_by)", "", "ship_code =\"" 
 + alltrim(chkout_vars.delivery_by) + "\"")</p>


<p class=Code>tbl2 = table.open("<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\invoice_header.dbf")</p>


<p class=Code>tbl2.enter_begin()</p>


<p class=Code>tbl2.Customer_id = alltrim(chkout_vars.customerid)</p>


<p class=Code>tbl2.Date = date()</p>


<p class=Code>tbl2.Sales_rep = "Web Sale"</p>


<p class=Code>tbl2.Delivery_by = delivery_by</p>


<p class=Code>tbl2.Pay_method = "PayPal" </p>


<p class=Code>tbl2.Sales_tax = 0 ' could populate from table</p>


<p class=Code>tbl2.Discount = 0 ' no discount from web</p>


<p class=Code>tbl2.Type = "Web"</p>


<p class=Code>tbl2.Shipping  = chkout_vars.ship_cost</p>


<p class=Code>tbl2.enter_end()</p>


<p class=Code>chkout_vars.invoice_no = tbl2.Invoice_number</p>


<p class=Code>tbl2.close()</td></tr>
</table>

<p>Next, the page script creates invoice lines from the 
 shopping cart and erases entries to indicate that the cart has been used. 
 The current shopping cart is identified by <span class=Code1>cart_id</span> 
 stored in a session cookie.</span></p>



<p>The invoice lines are saved using a special set definition. 
 This set links the product</span> and specials</span> 
 tables to the shop_cart</span> table records with product_id</span>. The invoice_items</span> 
 table requires a selling price, which can come from either the product</span> 
 or specials</span> tables. If the item is on "special", 
 the price will come from the linked record in the specials</span> 
 table. Otherwise, it comes from the linked record in the product</span> 
 table.</span></p>



<p>First, search for records in this cart by defining 
 query.filter</span> and query.order</span>.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>query.filter = "Cart_Id = \"" + cart_id + 
 "\".and. Quantity > 0"</p>


<p class=Code>query.order = ""</td></tr>
</table>

<p>Open the shop_cart_values</span> 
 set and see how many records there are. If there are no items, return 
 control back to CHECKOUTCART.A5W.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>tbl3 = table.open("<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\shop_cart_values.set")</p>


<p class=Code>qdx = tbl3.query_create()</p>


<p class=Code>if qdx.records_get()= 0</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl3.close()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("frameexit.a5w?pg=checkoutcart.a5w")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>


<p class=Code>end if</td></tr>
</table>

<p>Otherwise, open the shop_cart</span>, 
 product</span>, specials</span>, and 
 invoice_items</span> tables.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>tbl4 = table.get("shop_cart")</p>


<p class=Code>tbl5 = table.get("product")</p>


<p class=Code>tbl6 = table.get("specials")</p>


<p class=Code>tbl7 = table.open("<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\invoice_items.dbf")</td></tr>
</table>

<p>Step through the records of the shop_cart_values</span> 
 set and add values to the invoice_items</span> table.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>while .not. tbl3.fetch_eof()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl7.enter_begin()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl7.Invoice_number 
 = chkout_vars.invoice_no</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl7.Product_id 
 = tbl4.Prod_Id</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl7.Quantity 
 = tbl4.quantity</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if 
 tbl6.Sale_Price > 0 .and. (tbl6.Sale_Until >=date().or. cdate(tbl6.Sale_Until) 
 = "") ' product is on special</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl7.Price 
 = tbl6.Sale_Price</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl7.Price 
 = tbl5.Retail</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl7.enter_end()</td></tr>
</table>

<p>Erase the shop_cart_values</span> 
 fields after they are transferred.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl3.change_begin()'empty 
 values in cart to 'delete' cart</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl3.cart_id 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl3.session_id 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl3.open 
 = .F.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl3.Owner_Id 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl3.change_end()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;tbl3.fetch_next()</p>


<p class=Code>end while</p>


<p class=Code>tbl3.close()</p>


<p class=Code>tbl7.close()</td></tr>
</table>

<p>Post item sold quantities to the product</span> 
 table with a posting operation. We copied the code from the Post_Sales_Quantities</span> 
 operation and modified it.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>a_tbl = table.open("<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\product.dbf")</p>


<p class=Code>post.t_db = "<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\invoice_items.DBF"</p>


<p class=Code>post.m_key = "PRODUCT_ID"</p>


<p class=Code>post.t_key = "PRODUCT_ID"</p>


<p class=Code>post.m_filter = ""</p>


<p class=Code>post.t_filter = "Invoice_Number =\""+alltrim(chkout_vars.invoice_no)+"\""</p>


<p class=Code>post.m_count = 1</p>


<p class=Code>post.m_field1 = "Qty_In_Sto"</p>


<p class=Code>post.m_exp1 = "Qty_In_Sto-@Invoice_Items->Quantity"</p>


<p class=Code>post.t_count = 0</p>


<p class=Code>a_tbl.post()</p>


<p class=Code>a_tbl.close()</td></tr>
</table>

<p>Next, create the body of the email ( email_body</span> 
 ). Note the placeholders "<a class="wiki"  href="invoice_number" rel="">invoice_number</a>" and "<a class="wiki"  href="shipping" rel="">shipping</a>", 
 which will be replaced later.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>email_body = &lt&lt%text%</p>


<p class=Code>Thank you for shopping at Alpha Sports!</p>


<p class=Code>The order below has been charged to your credit card and 
 has been shipped.</p>


<p class=Code>Invoice Number: <a class="wiki"  href="invoice_number" rel="">invoice_number</a></p>


<p class=Code>Shipping Information:</p>


<p class=Code><a class="wiki"  href="shipping" rel="">shipping</a></p>


<p class=Code>For more detail, log in to Alpha Sports and view your Order 
 History.</p>


<p class=Code>%text%</td></tr>
</table>

<p>Prepare a printed invoice (actually a PDF file). Define 
 the PrintTarget</span>, filter</span>, 
 order</span>, and filename</span> 
 variables. Create the PDF with the <a href="../References/Methods/OBJECT.SAVEAS Method.html" title="OBJECT.SAVEAS Method" class="wiki">REPORT.SAVEAS(</a>) 
 method and save the resulting URL in PrintTarget</span>.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>PrintTarget = "" 'target 'page' for report</p>


<p class=Code>if chkout_vars.print_inv = "true"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;dim 
 filter&nbsp;as&nbsp;C</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;dim 
 order&nbsp;as&nbsp;C</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;Filter 
 = "Invoice_Number = " + quote(alltrim(chkout_vars.invoice_no) )</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;Order 
 = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;dim 
 filename&nbsp;as&nbsp;C</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;filename 
 = session.session_folder + chr(92) + "tempreport.pdf"</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;filename 
 = report.saveas("Invoice@<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\invoice.set", 
 "pdf", filter, order, filename, .f.)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if 
 file.exists(filename)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintTarget 
 = session.session_url + "tempreport.pdf?" + time("hms3")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end 
 if</p>


<p class=Code>end if</p>


<p class=Code>redirect_page = "index.a5w"</td></tr>
</table>

<p>After the processing is complete and the page displays, 
 a button appears with the label "Print Your Invoice". Clicking 
 this label opens the PDF file. Another button with the label "Click 
 Here to Continue" exits from the page and loads <a href="INDEX.A5W.html" title="INDEX.A5W" class="wiki">INDEX.A5W</a>.</span></p>




<table class="htmlTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>&lt%a5 if PrintTarget &lt> "" %></p>


<p class=Code><span class=HTML1>&nbsp;&nbsp;&nbsp;&nbsp;&ltinput 
 name="print_inv" type="button" id="print_inv" 
 value="&nbsp;&nbsp;Print Your Invoice&nbsp;&nbsp;" 
 on<x>click="window.open('</span> &lt%a5 ?PrintTarget %> <span class=HTML1>', 
 '', 'status=0, toolbar=0, location=0, menubar=1, resizable=1, scrollbars=1')">&nbsp;&nbsp;</span></p>


<p class=Code>&lt%a5 end if %></p>


<p class=Code><span class=HTML1>&ltinput name="continue" type="button" 
 id="continue" value="Click Here to Continue" on<x>click="window.location='frameexit.a5w?pg=</span> 
 &lt%a5 ?redirect_page %> <span class=HTML1>'"></span></td></tr>
</table>

<p class=A5>Page Security Information</p>



<p>Always Allowed</p>




<p class=A5>See Also</span></p>



<p><a href="../Tutorials/AlphaSportsWeb Explained (Non-Ajax Web)/AlphaSportsWeb Web Pages.html" title="AlphaSportsWeb Web Pages" class="wiki">Web Pages</a></span></p>



<p class=A5>Supported By</span></p>



<p>Alpha Five Version 8 Professional Edition and Above</p>



<p class=A5></span></p>
	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:CheckOutCalcPayPal.A5W">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 --></body></html>