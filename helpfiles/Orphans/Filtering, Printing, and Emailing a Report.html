	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<p class=A3Topic>Filtering, Printing, and Emailing a Report</p>

<p>This topic describes how to create a dialog component that accepts an email address, start date, and end date, uses the dates to create a filter, prints the filtered report to a PDF file, and then emails the PDF file.</p>

<p class=A5>Create the Dialog</p>

<ol> <li class=kadov-p-CListNumber><p class=ListNumber>The first step is to create a dialog component with a TextBox control named <span class=Code1>email_address</span> and two Calendar controls named <span class=Code1>from_date</span> and <span class=Code1>to_date</span>.</p>

</li> <li class=kadov-p-CListNumber><p class=ListNumber>Place this control on a page. In this example I used the <span class=Screen>HTML Editor</span> to add a heading above the component. Your component might look like this. </p>

</li> </ol><p class=Pix><img src="images/WPT_Filter_and_Email_Report.gif" x-maintain-ratio=TRUE style="border: none; width: 343px; height: 460px; float: none; border-style: none; border-style: none;" width=343 height=460 border=0></p>

<ol start=3 style="list-style: decimal;" type=1> <li class=kadov-p-CListNumber><p class=ListNumber>The next step is to display the component's <span class=Screen>Form > Properties</span> page.</p>

</li> <li class=kadov-p-CListNumber><p class=ListNumber>Click <img src="images/Web_Properties_button.gif" x-maintain-ratio=TRUE style="border: none; width: 17px; height: 18px; float: none; border-style: none; border-style: none;" width=17 height=18 border=0> in the <span class=Button>Server Events > AfterValidate</span> property to display the <span class=Screen>Form Events</span> dialog. Enter the script (without the intervening comments).</p>

</li> </ol><p>This section of the script uses <a href="../References/Functions/EVAL_VALID Function.html" title="EVAL_VALID Function" class="wiki">EVAL_VALID(</a>) to check that <span class=Code1>email_address</span>, <span class=Code1>from_date</span>, and <span class=Code1>to_date</span> have values. If any them do not have a value, the script exits by jumping to <span class=Code1>skip_report:</span> .</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>IF eval_valid("email_address") = .f. Then</p>

<p class=Code></p>

<p class=Code>goto skip_report</p>

<p class=Code>end if</p>

<p class=Code>IF eval_valid("from_date") = .f. Then</p>

<p class=Code></p>

<p class=Code>goto skip_report</p>

<p class=Code>end if</p>

<p class=Code>if eval_valid("to_date") = .f. Then</p>

<p class=Code></p>

<p class=Code>goto skip_report</p>

<p class=Code>end if</td></tr> </table><p>Next, the script checks that <span class=Code1>from_date</span> and <span class=Code1>to_date</span> have meaningful values. Note, while <span class=Code1>from_date</span> and <span class=Code1>to_date</span> are defined&nbsp;as&nbsp;date variables on the dialog, they return <span class=Bolded>character</span> values.</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>if (from_date = "") then</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;from_date = dtoc( date() )</p>

<p class=Code>end if</p>

<p class=Code>if (to_date = "") then</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;to_date = dtoc( date() )</p>

<p class=Code>end if</p>

<p class=Code>if ( ctod(from_date) > ctod(to_date) ) then</p>

<p class=Code></p>

<p class=Code>goto skip_report</p>

<p class=Code>end if</td></tr> </table><p>This section of the script generates a report containing the records selected by <span class=Code1>from_date</span> and <span class=Code1>to_date</span>. It saves the report to a temporary file in a session folder. Note, the Application Server automatically creates the session folder and then deletes the folder and its contents when your session ends. Also note how the filter expression converts the character date values into proper date values using <a href="../References/Functions/CTOD Function.html" title="CTOD Function" class="wiki">CTOD(</a>) and then quotes them using <a href="../References/Functions/S_QUOTE Function.html" title="S_QUOTE Function" class="wiki">S_QUOTE(</a>).</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>dim filter&nbsp;as&nbsp;C</p>

<p class=Code>dim order&nbsp;as&nbsp;C</p>

<p class=Code>dim filename&nbsp;as&nbsp;C</p>

<p class=Code>dim message&nbsp;as&nbsp;P</p>

<p class=Code>filter = "invoice_header->date >= " + s_quote( ctod(from_date) ) + " .and. invoice_header->date <= " + s_quote( ctod(to_date) )</p>

<p class=Code>order = "invoice_header->date"</p>

<p class=Code>filename = session.session_folder + "tempreport.pdf"</p>

<p class=Code>filename = report.saveas("Invoice", "pdf", filter, order, filename, .f.)</td></tr> </table><p>This section of the script sends the report created above. Note, the use of <a href="../References/Functions/EMAIL_SEND2 Function.html" title="EMAIL_SEND2 Function" class="wiki">EMAIL_SEND2(</a>), which is appropriate for use in web applications. The <span class=Code1>message</span> dot variable has many optional parameters, but this code sample illustrates the minimum required.</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>message.to = email_address</p>

<p class=Code>message.from = "alpha@alphasoftware.com"</p>

<p class=Code>message.subject = "Invoice Report for " + to_date + " to " + from_date</p>

<p class=Code>message.Attachments = filename</p>

<p class=Code>message.message = "Invoice report is attached"</p>

<p class=Code>email_send2(message, "Default")</p>

<p class=Code>skip_report:</td></tr> </table><p class=Note><span class=Note><img src="images/icon_information.gif" x-maintain-ratio=TRUE style="border: none; width: 36px; height: 32px; float: none; border-style: none; border-style: none;" width=36 height=32 border=0>Note</span> : The second parameter of the <a href="../References/Functions/EMAIL_SEND2 Function.html" title="EMAIL_SEND2 Function" class="wiki">EMAIL_SEND2(</a>) function references a profile named "Default". This is the actual name of a profile defined by going to <span class=Button>View > Settings > Email</span> and defining and saving a profile. This profile does not assume that you are using the Alpha Five email client. Rather, it defines the information needed to connect with your email server and send a message without user interaction.</p>

<p class=A5>See Also</p>

<p><a href="Contents - Web Publishing Tutorial.html" title="Contents - Web Publishing Tutorial" class="wiki">Contents</a></p>

	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:Filtering%2C+Printing%2C+and+Emailing+a+Report">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA: {"group":"/Guide/Desktop/","status":"pending","keywords":"desktop,guide","tags":"desktop"} --->
</body></html>