	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			
<p class=A3Topic>DLG_CUSTSEC Dialog Component</p>



<p class=A5>Purpose</p>



<p>The DLG_CUSTSEC dialog component is used by administrators to edit customer security information.</p>



<p class=Pix><img src="images/ASW_dlg_custsec.gif"
					x-maintain-ratio=TRUE
					style="border: none;
							float: none;
							width: 402px;
							height: 182px;
							border-style: none;
							border-style: none;"
					width=402
					height=182
					border=1> </p>



<p class=A5>Description</p>



<p>The DLG_CUSTSEC dialog component contains the text controls necessary 
 to edit a security record for a customer. </p>


<p>Control names for fields that contain data for the <span class="Code1">customer</span> table are the field names in the table preceeded with "c_". The name of each security control in the dialog must exactly match the name of the field in the user table. A list of valid security field names can be found by using the <a href="http://support.alphasoftware.com/alphafivehelpv8/Functions/A5WS_User_File_Field_List%28%29.htm">A5WS_User_File_Field_List()</a> function. Two other fields are recognized by the security functions used in this component, <span class="Code1">confirm_password</span> and <span class="Code1">groups</span>. <span class="Code1">Confirm_password</span> is used to confirm a password entry, and <span class="Code1">groups</span> saves the security group assignments for this user. </p>


<p>There are seven controls that have the <span class="Button">control type</span> set to "hidden". These controls are <span class="Code1">c_email, c_firstname, c_lastname, c_customer_id, guid, groups</span>, and <span class="Code1">ulink</span>. These controls are required and hold values used in the events to create labels and find and save the correct records in the tables. The <span class="Code1">guid</span> control is empty if there is no security record found for the user.  </p>


<p>There are two email fields on the dialog. One is <span class="Code1">c_email </span>and holds the email saved in the customer table to show as a label. The other is <span class="Code1">email</span> that is a validation email saved in the security table used to validate the users identity. These may have the same value or they may be different. The <span class="Code1">userid </span>in this configuration is also an email address and it may match the values in the other email fields. </p>


<p>If no matching customer record if found in the  <span class=Code1>Initialize</span> event, the <span class="Code1">ulink</span> value will be a null value and all of the security fields will be hidden. A message will display in the name label indicating no record was found.</p>


<p class=A5>Containers</p>



<p><a href="ASWCUSTSEC.A5W.html" title="ASWCUSTSEC.A5W" class="wiki">ASWCUSTSEC.A5W</a></p>



<p class=A5>Notable Grid Control Property Settings</p>




<table style="x-cell-content-align: top;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0">
<col>
<col>
<col>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableHeader" colspan="1" rowspan="1">
<p class=TableHead>Control</td>
<td class="TableHeader">
<p class=TableHead>Property</td>
<td class="TableHeader">
<p class=TableHead>Description</td></tr>


<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" rowspan="1" colspan="1">
<p class=TableLeft>Label_Email</td>
<td class="TableCell">
<p class=TableLeft><span class=Button>Row  Properties > Bubble help text </span></td>
<td class="TableCell">
<p class=TableLeft>Set to "E-mail address in customer file".</td></tr>


<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" rowspan="1" colspan="1">
<p class=TableLeft>Security Label </td>

<td class="TableCell">
<p class=TableLeft><span class=Button>Row Properties > Row label</span> </td>
<td class="TableCell">
<p class=TableLeft><span class="HTML1"> <strong><font color=#ff0000>Security Section</font></strong></span>.</p>

</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" rowspan="1" colspan="1">
<p class=TableLeft>Userid</td>
<td class="TableCell">
<p class=TableLeft><span class="Button">Control Settings > Show/Hide Expression </span></td>
<td class="TableCell">
<p class=TableLeft><span class="Code1">ulink!= ""</span></p>

</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" rowspan="3" colspan="1">
<p class=TableLeft>Password</td>
<td class="TableCell">
<p class=TableLeft><span class="Button">Control Settings > Show/Hide Expression </span></td>
<td class="TableCell">
<p class=TableLeft><span class="Code1">ulink!= ""</span></p>

</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td_null>
<td class="TableCell">
<p class=TableLeft><span class="Button">Textbox  Properties > MaxLength  </span> </td>
<td class="TableCell">
<p class=TableLeft>Set to "60" Must large enough to hold encrypted password. </p>

</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td_null>
<td class="TableCell">
<p class=TableLeft><span class="Button">Textbox  Properties > Is a password field </span> </td>
<td class="TableCell">
<p class=TableLeft>Set to TRUE. </p>

</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" rowspan="2" colspan="1">
<p class=TableLeft>Confirm_Password</td>
<td class="TableCell">
<p class=TableLeft><span class=Button>Control Settings > Show/Hide Expression </span></td>
<td class="TableCell">
<p class=TableLeft><span class="Code1">password!=""</span></p>

</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td_null>
<td class="TableCell">
<p class=TableLeft><span class="Button">Textbox  Properties > Is a password field </span> </td>
<td class="TableCell">
<p class=TableLeft>Set to TRUE. </p>

</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell" rowspan="2" colspan="1">
<p class=TableLeft>email</td>
<td class="TableCell">
<p class=TableLeft><span class=Button>Control Settings > Show/Hide Expression </span></td>
<td class="TableCell">
<p class=TableLeft><span class="Code1">ulink!=""</span></p>

</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td_null>
<td class="TableCell">
<p class=TableLeft><span class="Button">Row  Properties > Bubble help text</span></td>
<td class="TableCell">
<p class=TableLeft>Set to "Validation E-mail. Used to validate user and send lost data to user.".</p>

</td></tr>
</table>

<p class=A5>Notable Component Property Settings</p>




<table style="x-cell-content-align: top;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0">
<col>
<col>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableHeader">
<p class=TableHead>Property</td>
<td class="TableHeader">
<p class=TableHead>Description</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell">
<p class=TableLeft><span class=Button>Layout Options   > Layout Calculation Mode</span></td>
<td class="TableCell">
<p class=TableLeft>Changed to "Precalculate Layout.</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell">
<p class=TableLeft><span class=Button>Dialog Footer Layout > Freeform 
 layout</span></td>
<td class="TableCell">
<p class=TableLeft>Changed to TRUE.</td></tr>

<tr style="x-cell-content-align: top;" valign="top">
<td class="TableCell">
<p class=TableLeft><span class=Button>Dialog Footer Layout > Dialog 
 footer template</span></td>
<td class="TableCell">
<p class=TableLeft>Changed to " <span class=HTML1><p align=center>{SubmitButton}{ResetButton} </p></span> 
 ".</td></tr>
</table>

<p class=A5>Event Code</p>


<p>The <span class=Code1>Initialize</span> event code finds user records from the <span class="Code1">customer</span> table and security data and populates the controls. The events starts by setting a default value for the <span class="Code1">groups</span> control that holds the value of security group for a customer user. </p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>'set default group value to proper guid for 'customers' group</p>

	
<p class=Code>CurrentForm.Controls.groups.value = a5ws_get_guid_from_group("customers",request)</td></tr>
</table>

<p>If the <span class=Code1>Request.variables.c_customer_id</span> variable has a non-null value, 
 the script uses this value to retrieve the corresponding record from the 
 <span class=Code1>customer</span> table. The variable value was passed form the previous page. </p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>If eval_valid("Request.variables.c_customer_id ") ' Value passed to page - also used in 'ulink' </p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;
  if Request.variables.c_customer_id <> ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.filter  = "customer_id = \""+Request.variables.c_customer_id+"\"" )
 ' find the record</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;query.order  = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl = table.open("<a class="wiki"  href="PathAlias.ADB_Path" rel="">PathAlias.ADB_Path</a>\customer.dbf")</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;qdx = tbl.query_create()</td></tr>
</table>


<p>If the query finds a single record, the script writes the values from the fields of the customer record to the hidden fields <span class="Code1">c_email, c_firstname, c_lastname </span>and <span class="Code1">c_customer_id</span>. It begins by getting a list of controls that begin with "c_", which indicate they are fields from the <span class="Code1">customer</span> table. </p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if qdx.records_get() = 1 ' got one match</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dim controls as c</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;controls = properties_enum(CurrentForm.Controls)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for each foo in controls</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if eval_valid( "tbl."+substr(foo,3) )</p>



<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval("CurrentForm.Controls."+foo+".value") = alltrim( eval( "tbl."+substr(foo,3) ) )</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next</td></tr>
</table>

<p>The event code then re-populates the <span class="Code1">ulink</span> control with the <span class="Code1">customer_id</span> from the record found and uses that value to find a security record for the user. The value is placed in a request variable to pass to the ((A5WS_Get_User_Values Function|A5WS_GET_USER_VALUES() )) function. </p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CurrentForm.Controls.ulink.value = alltrim(tbl.Customer_id)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.close()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;request.variables.ulink = alltrim(CurrentForm.Controls.ulink.value)	'find security record by 'ulink' as we don't have a 'GUID'</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a5ws_get_user_values(CurrentForm,request)
</td></tr>
</table>

<p>Finally, If  the validation <span class="Code1">email</span> control is empty, the userid may be placed in the control as a default value. If no record was found, the <span class="Code1">ulink</span> control set to null value. </p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'set validation email address to same as userid as default if empty</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if alltrim(CurrentForm.Controls.userid.value) <> "" </p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if alltrim(CurrentForm.Controls.email.value) = "" </p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CurrentForm.Controls.email.value = alltrim(CurrentForm.Controls.userid.value)</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end if


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.close()</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CurrentForm.Controls.ulink.value = "" ' set empty if no customer record found. This will hide secutity fields </p>



<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end if</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end if</p>


<p class=Code>end if</p>


</td></tr>
</table>

<p>&nbsp;</p>


<p>The <span class=Code1>Validate</span> event code validates the security data entered, if any, and saves it if there are no errors. If the field ulink is empty, the event returns an error. The function ((A5WS_Save_User_Values Function|A5WS_SAVE_USER_VALUES() ))will return <span class="Code1">CurrentForm.Has_error = .t.</span> if the data does not meet the security validation rules. </p>




<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>if CurrentForm.Controls.ulink.value = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;CurrentForm.Has_Error = .T.</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;CurrentForm.Error_Message = "Nothing to Save - Close"</p>


<p class=Code>else</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;a5ws_save_user_values(CurrentForm,request) ' validate and save</p>


<p class=Code>end if</p>

  </td></tr>
</table>


<p>&nbsp;</p>


<p>The <span class=Code1>AfterValidate</span> event code reloads the security values using the function ((A5WS_Get_User_Values Function|A5WS_GET_USER_VALUES() )) to show the latest changes. </p>



<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>a5ws_get_user_values(CurrentForm,request)</td></tr>
</table>
<p>&nbsp;</p>


<p>The <span class=Code1>Activate</span> event code is used to add the values  for <span class="Code1">label_name</span> and <span class="Code1">label_email</span>. The dialog uses a precalculated layout. When the layout is created, no values exist for the labels. The labels must be filled every time the form runs. The  <span class="Code1">Activate</span> event will fill the values for the labels from the values in the hidden fields <span class="Code1">c_email, c_firstname,</span> and <span class="Code1">c_lastname</span>. If the fields are empty, a message will show indicating a customer record was not found. </p>



<table class="codeTable" style="x-cell-content-align: top;
				border-left-style: None;
				border-right-style: None;
				border-top-style: None;
				border-bottom-style: None;
				width: 100%;
				border-spacing: 0px;
				border-spacing: 0px;" cellspacing="0" width="100%">
<col style="width: 100%;">

<tr style="x-cell-content-align: top;
			width: 100%;
			border-spacing: 0px;
			border-left-style: None;
			border-right-style: None;
			border-top-style: None;
			border-bottom-style: None;" valign="top">
<td style="width: 100%;
			padding-right: 10px;
			padding-left: 10px;" width="100%">
<p class=Code>CurrentForm.Controls.label_name = alltrim(CurrentForm.Controls.c_firstname)+" "+alltrim(CurrentForm.Controls.c_lastname)</p>


<p class=Code>if alltrim(CurrentForm.Controls.label_name) = ""</p>


<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;CurrentForm.Controls.label_name = "Customer Record Not Found"</p>


<p class=Code>end if </p>


<p class=Code>CurrentForm.Controls.label_email = alltrim(CurrentForm.Controls.c_email)</p>

</td></tr>
</table>


<p class=A5>See Also</p>



<p><a href="../Tutorials/AlphaSportsWeb Explained (Non-Ajax Web)/Web Publishing Components.html" title="Web Publishing Components" class="wiki">Web Publishing Components</a></p>


	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:DLG_CUSTSEC+Dialog+Component">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA: {"group":"/Reference/Server/Design/View/Component/","tags":"web","status":"pending","keywords":"server,design,ref,component"} --->
</body></html>