	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<p class=A3Topic>Creating a Login Page</p>

<p class=Note><span class=Note><img src="images/icon_information.gif" x-maintain-ratio=TRUE style="border: none; width: 36px; height: 32px; float: none; border-style: none; border-style: none;" width=36 height=32 border=0>Note</span> : With the support of <a href="../Tutorials/Web Application Security Framework/Creating Login Components.html" title="Creating Login Components" class="wiki">Login components</a> and <a href="../Tutorials/AlphaSportsWeb Explained (Non-Ajax Web)/Configure Web Security/Defining Security Settings.html" title="Defining Security Settings" class="wiki">page security</a>, this topic describes a technique that is no longer required.</p>

<p class=A5>How the Login Feature Works</p>

<p>All of the pages (except the Main Menu page) in the sample application shipped with the <span class=Screen>Web Component Builder</span> require that you be logged in before you can view the page. This is done by putting the following Xbasic in the page at the first command in the header (i.e. after the opening <span class=Code1>&lthead></span> tag) of each page:</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>&lt%A5</p>

<p class=Code>a5w_include("logintest.a5w")</p>

<p class=Code>%></td></tr> </table><p>The <span class=Code1>Logintest.A5W</span> file contains the following Xbasic code:</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>&lt%A5</p>

<p class=Code>if eval_valid("session.<strong>protected</strong>FlagIsLoggedIn") = .f. then</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;session.targetURL = request.request_uri</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;response.redirect("login.a5w")</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end</p>

<p class=Code>end if</p>

<p class=Code>%></td></tr> </table><p class=Note><span class=Note><img src="images/icon_information.gif" x-maintain-ratio=TRUE style="border: none; width: 36px; height: 32px; float: none; border-style: none; border-style: none;" width=36 height=32 border=0>Important note</span> : This file does not contain any HTML tags such&nbsp;as&nbsp; <span class=Code1>&lthtml></span>, <span class=Code1>&lthead></span>, or <span class=Code1>&ltbody></span>. In order to create an .A5W page without any tags, you must edit the file in the <span class=Screen>Source</span> view of the <span class=Screen>HTML Editor</span> or use a program like <span class=Screen>Notepad</span>.</p>

<p>The <a href="../References/Functions/A5W_INCLUDE Function.html" title="A5W_INCLUDE Function" class="wiki">A5W_INCLUDE(</a>) function merges the text in the include file into the page being processed. It is just&nbsp;as&nbsp;if the text in the include file was in the page, rather than in the <span class=Code1>Logintest.A5W</span> file.</p>

<p>The login test does this:</p>

<ol> <li class=kadov-p-CListNumber><p class=ListNumber>Checks to see if a <a href="../Unclassified/Protected Variables.html" title="Protected Variables" class="wiki">protected</a> session variable called <span class=Code1><strong>protected</strong>FlagIsLoggedIn</span> is valid.</p>

</li> <li class=kadov-p-CListNumber><p class=ListNumber>If it is not valid, then the user has not logged in, so it redirects the browser to display the page called <span class=Code1>login.a5w</span>. However, before redirecting to the login.a5w page, it stores the URL of the page that the user was attempting to visit in a session variable. We do this so that we can take them back to that page after they have logged in.</p>

</li> </ol><p class=A5>Notes about the Logintest.a5w script</p>

<p>Every page that runs in a session can see <a href="../Unclassified/Sessions.html#Session_Variables" title="Sessions" class="wiki">session variables</a>. The <span class=Screen>Application Server</span> creates a <span class=Bolded>session</span> when you access your first page, and end it after a set period of no activity, or if you stop the <span class=Screen>Application Server</span>. You can think of a session variable&nbsp;as&nbsp;being similar to a global variable in a traditional Alpha Five application.</p>

<p>If the user has not yet logged in, the <span class=Code1><strong>protected</strong>FlagIsLoggedIn</span> variable will not exist, and so <span class=Code1>eval_valid("session.<strong>protected</strong>FlagIsLoggedIn")</span> will return <span class=Code1>.F.</span> .</p>

<p><span class=Code1>Request.request_uri</span> is the URL that the user originally called. It is one of several variables that the Alpha Five <span class=Screen>Application Server</span> automatically maintains when pages are run. For example, if you entered this in the address bar of your browser:</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>http://&ltMyMachineName>/DemoApp/Page1.a5w?page=3</td></tr> </table><p>then, <span class=Code1>Request.request_uri</span> would contain:</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>/DemoApp/Page1.a5w?page=3</td></tr> </table><p class=A5>Inside the Login.a5w Page</p>

<p>The <span class=Code1>login.a5w</span> page is nothing more than a container for the <span class=Code1>LoginDialog</span> dialog component. The <span class=Code1>LoginDialog</span> displays a dialog box that prompts for the user name and password. This component has code in the <span class=Code1>Validate</span> and <span class=Code1>AfterValidate</span> events.</p>

<p class=A5>The Validate Event</p>

<p>The <span class=Code1>LoginDialog</span> component has the following Xbasic in its <span class=Code1>Validate</span> event:</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>if (user_name = "") .or. (password = "") then</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;currentform.has_error = .t.</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;currentform.error_message = "User name or password cannot be blank."</p>

<p class=Code>else</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;dim correct_password&nbsp;as&nbsp;C</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;correct_password = lookup("&ltADB_Path>\user_names", "user_name="+quote(user_name), "password")</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if (correct_password &lt> password) then</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentform.has_error = .t.</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentform.error_message = "Invalid user name or password."</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end if</p>

<p class=Code>end if</td></tr> </table><p class=A5>Understanding the Code in the Validate Event</p>

<p>The first part of the <span class=Code1>Validate</span> event checks to see if either the <span class=Code1>user_name</span> or the <span class=Code1>password</span> variable is blank.</p>

<p>If either of these variables is blank, the code sets the <span class=Code1>currentform.has_error</span> and <span class=Code1>currentform.error_message</span> properties of the dialog component. These are special properties of the dialog component. If the <span class=Code1>currentform.has_error</span> property is set to <span class=Code1>.T.</span>, then the software re-displays the page containing the dialog component to the user. The error message set in the <span class=Code1>currentform.error_message</span> property appears on the page.</p>

<p>If both <span class=Code1>user_name</span> and <span class=Code1>password</span> are not blank, the script uses the Xbasic <a href="../References/Functions/LOOKUP Function.html" title="LOOKUP Function" class="wiki">LOOKUP(</a>) function to retrieve the correct password for the specified <span class=Code1>user_name</span>. The script then looks up the <span class=Code1>password</span> in the <span class=Code1>user_names</span> table. If the <span class=Code1>correct_password</span> does not match the value entered by the user into the password field, the software reports an error. However, if the passwords do match, then nothing further is done is this script, and the <span class=Code1>AfterValidate</span> event will execute (see below for explanation).</p>

<p>It is very important to note that the table name is prefixed with <span class=Code1>&ltADB_Path>\</span>. <span class=Code1>&ltADB_Path>\</span> is a special placeholder that the software replaces with the path to the database at the time that a Web Project is published (i.e. copied to a folder in the Web Root). By default, when you publish the project, the software replaces <span class=Code1>&ltADB_Path></span> with the value returned by <a href="../References/Methods/A5.GET_PATH Method.html" title="A5.GET_PATH Method" class="wiki">A5.GET_PATH(</a>), which is the path of the currently open .ADB database file.</p>

<p class=Note><span class=Note><img src="images/icon_information.gif" x-maintain-ratio=TRUE style="border: none; width: 36px; height: 32px; float: none; border-style: none; border-style: none;" width=36 height=32 border=0>Technical Note</span> : The Xbasic command: <span class=Code1>lookup("user_names","user_name = 'ed' ", "password")</span> only works if <span class=Code1>user_names</span> is a table that is a member of the currently open database (i.e. .adb file). However, when a <span class=Screen>Application Server</span> application is running, there may be no open .adb file, or there may be a different .adb file that is open. So, we must use fully qualified table names in all of our Xbasic code. The &ltADB_Path> placeholder is a way to fully qualify the table name with the correct drive and path prefix at the time that the project is published.</p>

<p class=A5>The <span class=Code1>AfterValidate</span> Event</p>

<p>The <span class=Code1>LoginDialog</span> component has the following Xbasic in its <span class=Code1>AfterValidate</span> event:</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top;" valign="top"> <td style="x-cell-content-align: top; width: 100%; padding-right: 10px; padding-left: 10px;" valign="top" width="100%"><p class=Code>if eval_valid("session.targetUrl") then</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;if session.targetURL &lt> "" then</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Currentform.RedirectTarget = session.targetURL</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;else</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;currentform.redirectTarget = "Mainmenu.a5w"</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;end if</p>

<p class=Code>else</p>

<p class=Code>&nbsp;&nbsp;&nbsp;&nbsp;currentform.redirectTarget = "Mainmenu.a5w"</p>

<p class=Code>end if</p>

<p class=Code>session.FlagIsLoggedIn = .t.</td></tr> </table><p class=A5>Understanding the Code in the 'AfterValidate' Event</p>

<p>The <span class=Code1>AfterValidate</span> event will only fire if the user entered a valid <span class=Code1>user_name</span> and <span class=Code1>password</span> combination.</p>

<p>The code checks to see if the <span class=Code1>targetUrl</span> session variable is valid. You make a reference to a session variable by simply prefixing the variable name with "session.". Recall that the code in <span class=Code1>logintest.a5w</span> set the value in <span class=Code1>session.targetURL</span> '. It contains the address of the page that the user was attempting to visit before we "hijacked" his request, and took him to the login page. Now that the user has successfully logged in, we can take him to the page that he originally intended to visit.</p>

<p>This is done by setting the <span class=Code1>currentform.redirectTarget</span> property of the dialog component. If the <span class=Code1>session.TargetUrl</span> property has not been set, or is blank, then we redirect to the <span class=Code1>MainMenu.a5w</span> page. Finally, we set the <span class=Code1><strong>protected</strong>FlagIsLoggedIn</span> session variable to <span class=Code1>.T.</span> . This means that the user will not be asked to log in on all subsequent pages.</p>

<p class=A5>See Also</p>

<p><a href="Contents - Web Publishing Tutorial.html" title="Contents - Web Publishing Tutorial" class="wiki">Contents</a>, <a href="../Unclassified/Sessions.html" title="Sessions" class="wiki">Sessions</a>, <a href="../Unclassified/Protected Variables.html" title="Protected Variables" class="wiki">Protected Variables</a></p>

	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:Creating+a+Login+Page">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 -->
<!---HELPMETADATA: {"group":"/Guides","status":"pending","keywords":"server,guide"} --->
</body></html>