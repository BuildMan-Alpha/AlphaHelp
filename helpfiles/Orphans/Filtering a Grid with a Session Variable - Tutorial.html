	<!DOCTYPE html>
	<html>
	<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\" />
	<link rel="stylesheet" type="text/css" href="theme.css" />
	</head>
	<body>
	<div id="tiki-clean">
			<div id="tiki-mid">
	
 



 

	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 




<article id="top" class="wikitext clearfix nopagetitle">
			
		
		
		
		
			 

	
			<p class=A3Topic>Filtering a Grid with a Session Variable - Tutorial</p>

<p>Many web application developers want to filter the records that they display, so that a user sees only the records that belong to him or her. This topic explains the technique to use.</p>

<p>The following grid component displays all the records of the <span class=Code1>invoice_items</span> table. The check boxes in the Search Part, the radio buttons in the Quick Search, and the drop down list box in the Payment column display all the payment methods found in the <span class=Code1>invoice_header</span> table. </p>

<p class=Pix><img src="images/WPT_Unfiltered_Invoice_Items.gif" x-maintain-ratio=TRUE style="border: none; float: none; width: 494px; height: 365px; border-style: none; border-style: none;" width=494 height=365 border=0></p>

<p>The <span class=Code1>user_names</span> and <span class=Code1>invoice_items</span> tables havean eight character field named <span class=Code1>userid</span>. </p>

<p class=Pix><img src="images/WPT_User_Names_UserID.gif" x-maintain-ratio=TRUE style="border: none; width: 464px; height: 151px; float: none; border-style: none; border-style: none;" width=464 height=151 border=0></p>

<p class=Pix><img src="images/WPT_Invoice_Items_UserID.gif" x-maintain-ratio=TRUE style="border: none; width: 458px; height: 176px; float: none; border-style: none; border-style: none;" width=458 height=176 border=0></p>

<p>When you log into this application, the <span class=Code1>logindialog</span> component on the <span class=Code1>login.a5w</span> page runs the following code in its <span class=Code1>validate</span> event.</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top; width: 100%; border-spacing: 0px; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None;" valign="top"> <td style="width: 100%; padding-right: 10px; padding-left: 10px;" width="100%"><p class=Code>if user_name = "" .or. password = ""</p>

<p class=Code></p>

<p class=Code>then</p>

<p class=Code></p>

<p class=Code>currentform.has_error = .t.</p>

<p class=Code></p>

<p class=Code>currentform.error_message = "User name or password cannot be blank."</p>

<p class=Code>else</p>

<p class=Code></p>

<p class=Code>dim correct_password&nbsp;as&nbsp;c</p>

<p class=Code></p>

<p class=Code>DIM level&nbsp;as&nbsp;N</p>

<p class=Code></p>

<p class=Code>correct_password = lookup("[PathAlias.ADB_Path]\user_names", "user_name=" + quote(user_name), "password")</p>

<p class=Code></p>

<p class=Code>if correct_password = password then</p>

<p class=Code>&nbsp;&nbsp;&nbsp;</p>

<p class=Code>level = lookup("[PathAlias.ADB_Path]\user_names", "user_name=" + quote(user_name), "level")</p>

<p class=Code>&nbsp;&nbsp;&nbsp;</p>

<p class=Code>session.<strong>protected</strong>SecurityLevel = level</p>

<p class=Code>&nbsp;&nbsp;&nbsp;</p>

<p class=Code>session.<strong>protected</strong>UserID = lookup("[PathAlias.ADB_Path]\user_names", "user_name=" + quote(user_name), "UserID")</p>

<p class=Code>&nbsp;&nbsp;&nbsp;</p>

<p class=Code>session.WASDemo.UserName = user_name</p>

<p class=Code></p>

<p class=Code>else</p>

<p class=Code>&nbsp;&nbsp;&nbsp;</p>

<p class=Code>currentform.has_error = .t.</p>

<p class=Code>&nbsp;&nbsp;&nbsp;</p>

<p class=Code>currentform.error_message = "Invalid user name or password."</p>

<p class=Code></p>

<p class=Code>end if</p>

<p class=Code></p>

<p class=Code>end if</td></tr> </table><p>The interesting part of this code is this line. This line creates the protected session variable <span class=Code1>session.<strong>protected</strong>UserID</span> and assigns it the value it reads from the <span class=Code1>user_names</span> table.</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top; width: 100%; border-spacing: 0px; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None;" valign="top"> <td style="width: 100%; padding-right: 10px; padding-left: 10px;" width="100%"><p class=Code>session.<strong>protected</strong>UserID = lookup("[PathAlias.ADB_Path]\user_names", "user_name=" + quote(user_name), "UserID")</td></tr> </table><p>The A5W page that contains the filtered grid component shown above initially has the following code.</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top; width: 100%; border-spacing: 0px; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None;" valign="top"> <td style="width: 100%; padding-right: 10px; padding-left: 10px;" width="100%"><p class=Code>with tmpl_Selected_Invoic</p>

<p class=Code></p>

<p class=Code>componentName = "Selected_Invoic"</p>

<p class=Code>end with</td></tr> </table><p>After editing, it looks like this.</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top; width: 100%; border-spacing: 0px; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None;" valign="top"> <td style="width: 100%; padding-right: 10px; padding-left: 10px;" width="100%"><p class=Code>with tmpl_Selected_Invoic</p>

<p class=Code></p>

<p class=Code>componentName = "Selected_Invoic"</p>

<p class=Code></p>

<p class=Code>DBF.filter = "userID = " + quote(session.<strong>protected</strong>UserID)</p>

<p class=Code></p>

<p class=Code>SearchField_Info[1].CheckBox.Filter = "userID = " + quote(session.<strong>protected</strong>UserID)</p>

<p class=Code></p>

<p class=Code>field_info[7].DropDownBox.Filter = "userID = " + quote(session.<strong>protected</strong>UserID)</p>

<p class=Code></p>

<p class=Code>QuickSearch.Radiobutton.Filter = "userID = " + quote(session.<strong>protected</strong>UserID)</p>

<p class=Code>end with</p>

<p class=Code>&nbsp;</td></tr> </table><p>The following line sets the <span class=Code1>DBF.filter</span> property of the grid, which selects the records it displays. The records must have a <span class=Code1>userid</span> value that matches the <span class=Code1>session.<strong>protected</strong>UserID</span> set at logon.</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top; width: 100%; border-spacing: 0px; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None;" valign="top"> <td style="width: 100%; padding-right: 10px; padding-left: 10px;" width="100%"><p class=Code>DBF.filter = "userID = " + quote(session.<strong>protected</strong>UserID)</td></tr> </table><p>This line sets the <span class=Code1>CheckBox.Filter</span> property of the check boxes in the Search part control, which displays only the user's allowed payment methods. The records must have a <span class=Code1>userid</span> value that matches the <span class=Code1>session.<strong>protected</strong>UserID</span> set at logon.</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top; width: 100%; border-spacing: 0px; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None;" valign="top"> <td style="width: 100%; padding-right: 10px; padding-left: 10px;" width="100%"><p class=Code>SearchField_Info[1]. <span class=Code1>CheckBox</span>.Filter = "userID = " + quote(session.<strong>protected</strong>UserID)</td></tr> </table><p>The next two lines use the same techniques to set the <span class=Code1>DropDownBox.filter</span> property of the seventh control, which is a drop down list box, and the radio buttons of the Quick Search.</p>

 <table class="codeTable" style="x-cell-content-align: top; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None; width: 100%; border-spacing: 0px; border-spacing: 0px;" cellspacing="0" width="100%"> <col style="width: 100%;"> <tr style="x-cell-content-align: top; width: 100%; border-spacing: 0px; border-left-style: None; border-right-style: None; border-top-style: None; border-bottom-style: None;" valign="top"> <td style="width: 100%; padding-right: 10px; padding-left: 10px;" width="100%"><p class=Code>field_info[7].DropDownBox.Filter = "userID = " + quote(session.<strong>protected</strong>UserID)</p>

<p class=Code>QuickSearch.Radiobutton.Filter = "userID = " + quote(session.<strong>protected</strong>UserID)</td></tr> </table><p>This version of the same grid displays only the records for the user whose <span class=Code1>userid</span> from the <span class=Code1>user_names</span> table matches the eight character <span class=Code1>userid</span> value in these <span class=Code1>invoice_items</span> table records. In addition, the check boxes in the Search Part, the radio buttons in the Quick Search, and the drop down list box in the Payment column display only the payment methods allowed for the current user. This information is retrieved from the <span class=Code1>payment_methods</span> table. </p>

<p class=Pix><img src="images/WPT_Filtered_Invoice_Items.gif" x-maintain-ratio=TRUE style="border: none; float: none; width: 476px; height: 365px; border-style: none; border-style: none;" width=476 height=365 border=0></p>

<p class=A5>See Also</p>

<p><a href="Contents - Web Publishing Tutorial.html" title="Contents - Web Publishing Tutorial" class="wiki">Contents</a></p>


<p class=A5><img src="images/comments.gif" style="border: none; width: 93px; height: 16px; border-style: none; border-style: none;" width=93 height=16 border=0></p>
	
	
	<hr class="hrwikibottom" /> 

	
	</article> 




	<!-- WIKIPATH:Filtering+a+Grid+with+a+Session+Variable+-+Tutorial">-->


	<div class="wikitopline clearfix" style="clear: both;">
	<div class="content">
				<div class="wikiinfo" style="float: left">



<span id="description"></span>

		</div>

	 
 
	</div> 
</div> 

			</div>
		</div>


	
	
<!-- Put JS at the end -->
	
<!-- jsfile external -->


<!-- jsfile dynamic -->
<!-- jsfile 0 --></body></html>